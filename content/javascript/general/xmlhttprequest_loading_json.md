## Загрузка JSON с помощью XMLHttpRequest

В современном вебе JSON (JavaScript Object Notation) стал стандартом для обмена данными между сервером и клиентом. JavaScript предоставляет удобные инструменты для работы с ним, а XMLHttpRequest (XHR) - это мощный API для выполнения HTTP-запросов, который позволяет загружать данные в формате JSON.

### Основы XMLHttpRequest

Прежде чем переходить к загрузке JSON, давайте рассмотрим основы работы с XMLHttpRequest. 

1. **Создание объекта XHR:**

   ```javascript
   const xhr = new XMLHttpRequest();
   ```

   Этот код создает новый объект XMLHttpRequest, который будет использоваться для выполнения HTTP-запроса.

2. **Открытие соединения:**

   ```javascript
   xhr.open('GET', 'https://example.com/data.json');
   ```

   Метод `open()` инициализирует запрос. Он принимает два обязательных аргумента:

   - **HTTP метод:**  'GET', 'POST', 'PUT', 'DELETE' и т.д.
   - **URL-адрес:**  адрес, по которому будет отправлен запрос.

3. **Установка заголовков (опционально):**

   ```javascript
   xhr.setRequestHeader('Content-Type', 'application/json');
   ```

   Метод `setRequestHeader()`  устанавливает заголовок для HTTP-запроса. В данном случае мы указываем, что ожидаем получить данные в формате JSON.

4. **Отправка запроса:**

   ```javascript
   xhr.send();
   ```

   Метод `send()` отправляет HTTP-запрос на сервер.

5. **Обработка ответа:**

   ```javascript
   xhr.onload = function() {
       if (xhr.status >= 200 && xhr.status < 300) {
           // Обработка успешного ответа
           console.log(xhr.responseText); 
       } else {
           // Обработка ошибки
           console.error('Ошибка запроса:', xhr.status);
       }
   };
   ```

   Событие `onload` происходит, когда запрос успешно завершен (независимо от кода состояния). Внутри обработчика мы проверяем код состояния ответа (`xhr.status`) -  2xx означает успех.

   Свойство `xhr.responseText` содержит данные ответа от сервера в виде строки.

### Загрузка JSON данных

Теперь, когда мы познакомились с основами XMLHttpRequest, давайте сфокусируемся на загрузке данных в формате JSON. 

Предположим, у нас есть файл `data.json`, расположенный по адресу `https://example.com/data.json`, с таким содержимым:

```json
{
  "name": "John Doe",
  "age": 30,
  "city": "New York"
}
```

Чтобы загрузить и обработать эти данные, мы можем использовать следующий код:

```javascript
const xhr = new XMLHttpRequest();
xhr.open('GET', 'https://example.com/data.json');

xhr.onload = function() {
  if (xhr.status >= 200 && xhr.status < 300) {
    // Преобразуем JSON строку в JavaScript объект
    const data = JSON.parse(xhr.responseText);

    // Используем полученные данные
    console.log('Имя:', data.name);
    console.log('Возраст:', data.age);
    console.log('Город:', data.city);
  } else {
    console.error('Ошибка запроса:', xhr.status);
  }
};

xhr.send();
```

В этом примере мы:

1. Создаем новый объект `XMLHttpRequest`.
2. Открываем соединение, используя метод `GET` и URL-адрес файла `data.json`.
3. В обработчике события `onload`:
   - Проверяем, успешно ли завершен запрос, проверяя код состояния.
   - Если запрос успешен, преобразуем JSON-строку из `xhr.responseText` в JavaScript-объект, используя `JSON.parse()`.
   - Выводим полученные данные в консоль.
4. Отправляем запрос.

### Обработка ошибок

При работе с XMLHttpRequest важно предусмотреть обработку ошибок. Вот несколько распространенных ошибок, которые могут возникнуть:

| Код состояния | Описание                                            |
|--------------|----------------------------------------------------|
| 400          | Bad Request - неверный формат запроса               |
| 401          | Unauthorized - требуется авторизация                |
| 403          | Forbidden - доступ запрещен                         |
| 404          | Not Found - ресурс не найден                       |
| 500          | Internal Server Error - внутренняя ошибка сервера |

В нашем примере мы проверяем код состояния ответа и выводим сообщение об ошибке, если запрос не был успешным. Вы можете расширить этот блок кода, чтобы обрабатывать различные ошибки по-разному, например, отображать пользователю более информативные сообщения.

### Заключение

XMLHttpRequest - это мощный инструмент для выполнения HTTP-запросов и загрузки данных в формате JSON. Используя его в сочетании с методами `JSON.parse()` и `JSON.stringify()`, вы можете легко обмениваться данными между вашим JavaScript-кодом и сервером.
