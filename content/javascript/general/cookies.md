## Куки (Cookies) в JavaScript

В этом разделе мы разберемся с понятием куки (cookies) и как их использовать в JavaScript для взаимодействия с браузером пользователя.

### Что такое куки?

Куки - это небольшие текстовые файлы, которые хранятся на компьютере пользователя и содержат информацию о его действиях на веб-сайте. Они используются для:

* **Сохранения пользовательских настроек**: язык, тема оформления, история просмотренных товаров.
* **Отслеживания сессий**: аутентификация пользователя, содержимое корзины покупок.
* **Персонализации**: показ релевантной рекламы, рекомендаций.

### Структура куки

Куки состоят из пар "ключ-значение", а также могут содержать дополнительные атрибуты:

| Атрибут     | Описание                                                                  |
|--------------|---------------------------------------------------------------------------|
| name         | Имя куки (обязательный атрибут)                                           |
| value        | Значение куки (обязательный атрибут)                                      |
| expires      | Дата истечения срока действия куки                                     |
| max-age      | Время жизни куки в секундах                                             |
| domain       | Домен, для которого доступна кука                                         |
| path         | Путь на домене, для которого доступна кука                               |
| secure       | Флаг, указывающий, что кука должна передаваться только по HTTPS          |
| HttpOnly     | Флаг, указывающий, что кука доступна только для HTTP-запросов (не для JS) |
| SameSite     | Ограничение на отправку куки на сторонние сайты                        |

### Работа с куки в JavaScript

#### Создание куки

Для создания куки используется свойство `document.cookie`:

```javascript
// Создание куки с именем "username" и значением "John Doe"
document.cookie = "username=John Doe";

// Создание куки с дополнительными атрибутами
document.cookie = "theme=dark; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"; 
```

**Важно**: 

* Каждая пара "ключ-значение" в куки разделяется точкой с запятой (`;`).
* Пробелы после точки с запятой игнорируются.
* Даты истечения срока действия должны быть в формате UTC.

#### Чтение куки

Чтение значения куки осуществляется с помощью того же свойства `document.cookie`.  Результат - это строка, содержащая все куки, установленные для данного домена.

```javascript
const allCookies = document.cookie;
console.log(allCookies); // Вывод: "username=John Doe; theme=dark"
```

Для получения значения конкретной куки, нужно написать функцию парсинга строки:

```javascript
function getCookie(name) {
  const cookieValue = document.cookie.split('; ').find(row => row.startsWith(name + '='));
  if (cookieValue) {
    return cookieValue.split('=')[1];
  } else {
    return null;
  }
}

const username = getCookie("username"); 
console.log(username); // Вывод: "John Doe"
```

#### Изменение куки

Для изменения куки достаточно создать новую с тем же именем:

```javascript
document.cookie = "username=Jane Doe"; 
```

#### Удаление куки

Чтобы удалить куки, нужно установить ее срок действия в прошедшее время:

```javascript
document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"; 
```

### Пример использования куки

Допустим, нужно сохранить выбранную пользователем тему оформления сайта:

```javascript
// Функция для установки темы
function setTheme(themeName) {
  document.cookie = `theme=${themeName}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/`;
  document.body.classList.add(themeName);
}

// Функция для получения сохраненной темы
function getSavedTheme() {
  const savedTheme = getCookie("theme");
  if (savedTheme) {
    document.body.classList.add(savedTheme);
  } else {
    setTheme("light"); // Установка темы по умолчанию
  }
}

// Вызов функции при загрузке страницы
window.onload = getSavedTheme;

// Обработчик события для кнопки смены темы
const themeButton = document.getElementById("themeButton");
themeButton.addEventListener("click", () => {
  const currentTheme = document.body.classList.contains("dark") ? "dark" : "light";
  const newTheme = currentTheme === "dark" ? "light" : "dark";
  setTheme(newTheme);
});
```

В этом примере мы создаем две функции: `setTheme` для установки темы и `getSavedTheme` для получения сохраненной темы. При загрузке страницы вызывается функция `getSavedTheme`, которая проверяет наличие куки "theme" и устанавливает соответствующую тему. Кнопка смены темы при клике меняет тему и сохраняет ее в куки.

### Важные моменты

* Размер куки ограничен 4 КБ.
* Браузеры могут ограничивать количество куки, хранящихся для одного домена.
* Куки отправляются на сервер при каждом запросе, что может увеличить объем передаваемых данных.
* Использование куки для хранения конфиденциальной информации не рекомендуется, так как они могут быть доступны злоумышленникам.

В следующем разделе мы рассмотрим LocalStorage - более современный способ хранения данных на стороне клиента. 
