## Отправка AJAX-запросов с помощью XMLHttpRequest

AJAX (Асинхронный JavaScript и XML) — это мощный подход в веб-разработке, который позволяет обновлять части веб-страницы без её полной перезагрузки. Это делает веб-приложения более отзывчивыми и динамичными.  XMLHttpRequest (XHR) — это API, доступный в JavaScript, который играет ключевую роль в реализации AJAX, позволяя отправлять асинхронные HTTP-запросы к серверу и получать от него данные. 

### Основы XMLHttpRequest

Объект `XMLHttpRequest` является основой для отправки AJAX-запросов. Давайте рассмотрим базовые шаги по отправке простого запроса:

1. **Создание объекта XMLHttpRequest:**
```javascript
const xhr = new XMLHttpRequest(); 
```
   
2. **Установка обработчика события `readystatechange`:**
   Этот обработчик будет вызываться при каждом изменении состояния запроса.

```javascript
xhr.onreadystatechange = function() {
  // Проверка состояния и статуса запроса
  if (this.readyState === 4 && this.status === 200) {
    // Обработка ответа от сервера
    console.log(this.responseText); 
  }
};
```

3. **Открытие запроса:**
   Метод `open()` определяет тип запроса, URL-адрес и режим (синхронный/асинхронный).
```javascript
xhr.open("GET", "https://example.com/api/data", true); 
```

4. **Отправка запроса:**
```javascript
xhr.send();
```

**Пояснение:**

* **`readyState`:** свойство объекта `XMLHttpRequest` хранит состояние запроса. 
   *  `0`: Запрос не инициализирован
   *  `1`: Соединение с сервером установлено
   *  `2`: Запрос получен сервером
   *  `3`: Сервер обрабатывает запрос
   *  `4`: Запрос завершен, ответ готов.

* **`status`:** код ответа HTTP, полученный от сервера (например, 200 - успех, 404 - не найдено).

* **`responseText`:** свойство, содержащее ответ от сервера в текстовом формате.

### Типы запросов HTTP

XMLHttpRequest поддерживает различные типы запросов HTTP, наиболее распространенными из которых являются:

| Метод HTTP | Описание                                    |
|------------|----------------------------------------------|
| GET        | Используется для получения данных с сервера. |
| POST       | Используется для отправки данных на сервер.  |
| PUT        | Используется для обновления данных на сервере. |
| DELETE     | Используется для удаления данных на сервере.  |


### Отправка данных на сервер

Для отправки данных на сервер с помощью метода POST необходимо задать заголовки запроса и передать данные в методе `send()`:

```javascript
const xhr = new XMLHttpRequest();
xhr.open("POST", "https://example.com/api/submit");
xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

// Формирование данных для отправки
const data = "name=John&age=30";

xhr.send(data);
```

### Обработка JSON-ответа

Часто сервер возвращает данные в формате JSON. Для обработки такого ответа можно воспользоваться методом `JSON.parse()`:

```javascript
xhr.onreadystatechange = function() {
  if (this.readyState === 4 && this.status === 200) {
    const response = JSON.parse(this.responseText);
    // Обработка данных из объекта response
    console.log(response.name); 
    console.log(response.age); 
  }
};
```

### Обработка ошибок

Важно обрабатывать потенциальные ошибки при работе с `XMLHttpRequest`.  Это можно сделать, проверяя код статуса ответа:

```javascript
xhr.onreadystatechange = function() {
  if (this.readyState === 4) {
    if (this.status === 200) {
      // Обработка успешного ответа
    } else {
      // Обработка ошибки
      console.error("Произошла ошибка:", this.status);
    }
  }
};
```

### Заключение

`XMLHttpRequest` предоставляет гибкий инструмент для реализации AJAX в JavaScript.  Он позволяет отправлять асинхронные запросы различных типов, обрабатывать ответы от сервера и управлять состоянием запроса, что делает его незаменимым инструментом для создания динамических и интерактивных веб-приложений. 
