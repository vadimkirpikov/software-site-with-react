## Модульное тестирование компонентов и сервисов в AngularJS 1.8.3

Модульное тестирование – это неотъемлемая часть разработки качественного и поддерживаемого программного обеспечения. В контексте AngularJS, модульное тестирование позволяет проверить корректность работы изолированных частей приложения, таких как компоненты и сервисы, независимо друг от друга. Это значительно упрощает поиск и исправление ошибок, а также повышает уверенность в работоспособности приложения после внесения изменений.

В этой статье мы рассмотрим основные принципы и инструменты для проведения модульного тестирования компонентов и сервисов в AngularJS 1.8.3.

### Инструменты для модульного тестирования

Для написания и запуска модульных тестов в AngularJS мы будем использовать следующие инструменты:

* **Jasmine:**  популярный фреймворк для написания тестов в стиле BDD (Behavior Driven Development), который предоставляет удобный синтаксис для описания ожидаемого поведения кода.
* **Karma:**  инструмент для запуска тестов в различных браузерах и окружениях, который позволяет автоматизировать процесс тестирования и получать отчеты о его результатах.
* **Angular Mocks:** модуль AngularJS, предоставляющий набор инструментов для имитации работы различных сервисов и компонентов, таких как `$http`, `$q`, `$timeout` и другие.

### Тестирование сервисов

Сервисы в AngularJS, как правило, представляют собой функции или объекты, инкапсулирующие определенную логику приложения. Для их тестирования необходимо создать экземпляр сервиса и проверить корректность его работы с помощью различных методов Jasmine.

#### Пример

Рассмотрим пример тестирования сервиса `Calculator`, который выполняет простые арифметические операции:

```javascript
// calculator.service.js
angular.module('myApp')
  .service('Calculator', function() {
    this.add = function(a, b) {
      return a + b;
    };

    this.subtract = function(a, b) {
      return a - b;
    };
  });
```

Тест для этого сервиса может выглядеть следующим образом:

```javascript
// calculator.service.spec.js
describe('Calculator Service', function() {
  // Создаем переменную для хранения экземпляра сервиса
  let Calculator;

  // Внедряем сервис Calculator перед каждым тестом
  beforeEach(module('myApp'));
  beforeEach(inject(function(_Calculator_) {
    Calculator = _Calculator_;
  }));

  it('должен корректно складывать числа', function() {
    expect(Calculator.add(2, 3)).toBe(5);
  });

  it('должен корректно вычитать числа', function() {
    expect(Calculator.subtract(5, 3)).toBe(2);
  });
});
```

В этом примере:

1. Мы описываем набор тестов для сервиса `Calculator` с помощью функции `describe`.
2. Внедряем зависимость `Calculator` с помощью функции `inject`.
3. Используем метод `beforeEach` для создания нового экземпляра сервиса перед каждым тестом.
4. Используем методы `it` для описания каждого тестового сценария.
5. Используем метод `expect` и матчеры Jasmine для проверки корректности работы сервиса.

### Тестирование компонентов

Компоненты в AngularJS представляют собой изолированные блоки пользовательского интерфейса, состоящие из шаблона HTML, контроллера JavaScript и опций конфигурации. Для их тестирования необходимо создать экземпляр компонента, скомпилировать его шаблон, взаимодействовать с ним через контроллер и проверять, что он отображается и ведет себя ожидаемым образом.

#### Пример

Рассмотрим пример тестирования компонента `UserList`, который отображает список пользователей, полученных от сервиса `UserService`:

```javascript
// user-list.component.js
angular.module('myApp')
  .component('userList', {
    templateUrl: 'user-list.template.html',
    controller: function(UserService) {
      const ctrl = this;
      ctrl.users = [];

      ctrl.$onInit = function() {
        UserService.getUsers().then(function(users) {
          ctrl.users = users;
        });
      };
    }
  });
```

Тест для этого компонента может выглядеть следующим образом:

```javascript
// user-list.component.spec.js
describe('UserList Component', function() {
  // Переменные для хранения элемента компонента и его scope
  let element, scope;

  // Моковые данные для сервиса UserService
  const mockUsers = [
    { id: 1, name: 'John Doe' },
    { id: 2, name: 'Jane Doe' }
  ];

  // Настройка модуля перед запуском тестов
  beforeEach(module('myApp'));

  // Внедрение зависимостей и создание экземпляра компонента
  beforeEach(inject(function($rootScope, $compile, $q, UserService) {
    // Создаем шпиона для сервиса UserService
    spyOn(UserService, 'getUsers').and.returnValue($q.resolve(mockUsers));

    // Создаем scope и компилируем компонент
    scope = $rootScope.$new();
    element = angular.element('<user-list></user-list>');
    element = $compile(element)(scope);
    scope.$digest();
  }));

  it('должен отображать список пользователей', function() {
    // Проверяем, что компонент отображает правильное количество элементов списка
    expect(element.find('li').length).toBe(mockUsers.length);

    // Проверяем, что каждый элемент списка содержит имя пользователя
    angular.forEach(mockUsers, function(user, index) {
      expect(element.find('li').eq(index).text()).toContain(user.name);
    });
  });
});
```

В этом примере:

1. Мы описываем набор тестов для компонента `UserList` с помощью функции `describe`.
2. Внедряем необходимые зависимости: `$rootScope`, `$compile`, `$q` и `UserService`.
3. Создаем шпиона для сервиса `UserService` с помощью метода `spyOn` и задаем ему возвращаемое значение с помощью `and.returnValue`.
4. Создаем новый scope, компилируем шаблон компонента и запускаем цикл дайджеста с помощью `$digest`.
5. Проверяем, что компонент отображает правильное количество элементов списка и что каждый элемент содержит имя пользователя.

### Заключение

В этой статье мы рассмотрели основы модульного тестирования компонентов и сервисов в AngularJS 1.8.3. Мы познакомились с инструментами Jasmine, Karma и Angular Mocks, а также с основными приемами написания тестов для сервисов и компонентов. 

Модульное тестирование - это важный этап разработки, который позволяет создавать более надежное и поддерживаемое программное обеспечение. Применение описанных в этой статье принципов и инструментов поможет вам писать более качественный и тестируемый код на AngularJS. 
