## Основы безопасности в AngularJS

Безопасность веб-приложений - это критически важный аспект разработки. AngularJS, как и другие фреймворки, предоставляет инструменты и механизмы для защиты ваших приложений от распространенных угроз. В этом разделе мы рассмотрим основные принципы безопасности в AngularJS 1.8.3 и как их применять на практике.

### Внедрение зависимостей (DI) и безопасность

AngularJS использует внедрение зависимостей (DI) как основной механизм для связи компонентов приложения. DI играет важную роль в обеспечении безопасности, предоставляя контролируемую среду для взаимодействия с внешними данными.

### Строгая контекстная фильтрация (Strict Contextual Escaping)

AngularJS использует строгую контекстную фильтрацию для предотвращения межсайтового скриптинга (XSS). Эта техника автоматически экранирует данные, вставляемые в DOM, в зависимости от контекста. Например, данные, отображаемые в атрибуте `src` тега `<img>`, будут экранированы иначе, чем данные, отображаемые внутри тега `<p>`.

Пример:

```html
<!-- Небезопасно -->
<img src="{{user.avatar}}">

<!-- Безопасно -->
<img ng-src="{{user.avatar}}">
```

В первом примере, если `user.avatar` содержит вредоносный JavaScript код, он будет выполнен в браузере. Во втором примере, директива `ng-src`  обеспечивает безопасное отображение данных, предотвращая XSS атаку.

### Предотвращение межсайтовых запросов подделки (CSRF)

CSRF атаки эксплуатируют доверие сайта к пользователю, заставляя его выполнять нежелательные действия. AngularJS предоставляет механизмы для защиты от CSRF с помощью синхронизатора токенов. 

**Как работает синхронизатор токенов:**

1. Сервер генерирует уникальный токен и отправляет его клиенту.
2. AngularJS сохраняет токен и автоматически добавляет его в заголовки HTTP запросов (обычно в заголовок `X-CSRF-Token`).
3. Сервер проверяет наличие и корректность токена в каждом запросе.

**Пример настройки защиты от CSRF на сервере (Node.js + Express):**

```javascript
const express = require('express');
const csrf = require('csurf');

const app = express();

// Настройка CSRF защиты
app.use(csrf({ cookie: true }));

app.get('/api/data', (req, res) => {
  // ...
});
```

**Пример отправки запроса с токеном в AngularJS:**

```javascript
angular.module('myApp', [])
  .factory('dataService', ['$http', function($http) {
    return {
      getData: function() {
        return $http.get('/api/data');
      }
    };
  }]);
```

AngularJS автоматически добавит CSRF токен в заголовок запроса.

### Валидация данных

Валидация данных - это важный этап защиты приложений от некорректных или вредоносных данных. AngularJS предоставляет встроенные директивы валидации, которые можно использовать для проверки данных на стороне клиента.

Пример:

```html
<form name="myForm">
  <input type="email" name="email" ng-model="user.email" required>
  <span ng-show="myForm.email.$invalid">Пожалуйста, введите корректный email</span>
</form>
```

### Сантизация HTML

AngularJS предоставляет сервис `$sce` для обработки HTML, полученного из ненадежных источников. Этот сервис позволяет создавать "песочницы" для выполнения JavaScript кода, что ограничивает доступ к DOM и другим ресурсам.

Пример:

```javascript
angular.module('myApp', [])
  .controller('MyController', ['$scope', '$sce', function($scope, $sce) {
    $scope.userContent = $sce.trustAsHtml('<p>Безопасный HTML</p>');
  }]);
```

### Заключение

В этом разделе мы рассмотрели основные принципы безопасности в AngularJS 1.8.3. Важно помнить, что безопасность - это непрерывный процесс, требующий внимания на всех этапах разработки. 

Используйте описанные выше инструменты и техники для создания безопасных и надежных веб-приложений.