## Основы тестирования в AngularJS

Тестирование - важная часть разработки любого приложения, и приложения на AngularJS не являются исключением.  Тесты помогают гарантировать, что ваш код работает должным образом, и предотвращают появление ошибок в будущем. 

В этой статье мы рассмотрим основы тестирования в AngularJS, используя Jasmine как фреймворк для написания тестов и Karma как инструмент запуска тестов.

### Jasmine

Jasmine - это JavaScript фреймворк для тестирования, ориентированный на поведение (BDD - Behavior-Driven Development). Он предоставляет простой синтаксис для написания тестов, понятный даже тем, кто только начинает знакомиться с тестированием.

**Основные элементы Jasmine:**

* **describe(description, specDefinitions):** Определяет набор тестов (тестовый набор). Принимает два параметра: описание набора тестов и функцию, содержащую сами тесты.
* **it(description, testFunction):** Определяет отдельный тест. Принимает описание теста и функцию, содержащую код теста.
* **expect(actual):** Используется для создания утверждения. Принимает фактическое значение, которое будет сравниваться с ожидаемым.
* **Matchers:** Функции, используемые после `expect()` для определения ожидаемого результата. Некоторые распространенные matchers:
    * `toBe(expected)`: Проверяет, равны ли фактическое и ожидаемое значения.
    * `toEqual(expected)`: Проверяет, равны ли фактическое и ожидаемое значения, включая вложенные объекты и массивы.
    * `toBeDefined()`: Проверяет, определено ли значение.
    * `toBeNull()`: Проверяет, равно ли значение `null`.
    * `toBeTruthy()`: Проверяет, является ли значение истинным.
    * `toBeFalsy()`: Проверяет, является ли значение ложным.
    * `toContain(item)`: Проверяет, содержит ли массив указанный элемент.

**Пример теста на Jasmine:**

```javascript
describe('Тестирование функции сложения', function() {
  it('должна возвращать сумму двух чисел', function() {
    function sum(a, b) {
      return a + b;
    }
    expect(sum(1, 2)).toBe(3); 
  });
});
```

### Karma

Karma - это инструмент запуска тестов для JavaScript, который позволяет запускать тесты в различных браузерах и средах. Karma запускает веб-сервер, который загружает ваши исходные файлы и файлы тестов в браузер, а затем запускает тесты и отображает результаты.

### Настройка окружения

1. **Установка Node.js:** Убедитесь, что у вас установлен Node.js. Скачайте и установите его с официального сайта [https://nodejs.org/](https://nodejs.org/) если необходимо.

2. **Создание проекта AngularJS:**  
    ```bash
    npm install -g @angular/cli
    ng new my-app
    cd my-app
    ```

3. **Установка Karma и Jasmine:**
    ```bash
    ng add @angular/cli/plugins/karma-jasmine
    ```

### Написание первого теста

Создайте файл `src/app/app.component.spec.ts`:

```typescript
import { TestBed } from '@angular/core/testing';
import { AppComponent } from './app.component';

describe('AppComponent', () => {
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [
        AppComponent
      ],
    }).compileComponents();
  });

  it('должен создать компонент AppComponent', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

  it('должен содержать заголовок "my-app"', () => {
    const fixture = TestBed.createComponent(AppComponent);
    fixture.detectChanges(); // Запускаем обнаружение изменений
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('.content span')?.textContent).toContain('my-app app is running!');
  });
});
```

В этом примере:

- `describe` определяет набор тестов для компонента `AppComponent`.
- `beforeEach` запускается перед каждым тестом, настраивая тестовый модуль AngularJS с помощью `TestBed`.
- Первый `it` проверяет, что компонент `AppComponent` успешно создан.
- Второй `it` проверяет, что компонент содержит ожидаемый текст в заголовке.

### Запуск тестов

Для запуска тестов выполните команду:

```bash
ng test
```

Karma запустит тесты в браузере (по умолчанию используется Chrome) и отобразит результаты в консоли.

### Типы тестов

В AngularJS можно выделить два основных типа тестов:

- **Unit-тесты:**  Проверяют работу отдельных частей приложения (компонентов, сервисов, директив) в изоляции. 
- **E2E-тесты (End-to-End):**  Тестируют приложение как единое целое, симулируя действия пользователя в браузере.

В данной статье мы рассмотрели основы unit-тестирования в AngularJS.  E2E-тестирование выходит за рамки данной статьи, но важно понимать, что оба типа тестов важны для обеспечения качества вашего приложения. 
