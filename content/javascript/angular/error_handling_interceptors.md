## Обработка ошибок и интерсепторы в AngularJS 1.8.3

В процессе разработки AngularJS приложений неизбежно возникают ошибки. Независимо от того, насколько тщательно написан код, внешние факторы, такие как сетевые проблемы или некорректные данные с сервера, могут привести к непредвиденным ошибкам. Эффективная обработка ошибок является важной частью создания надежного и удобного приложения.

AngularJS предоставляет механизмы для централизованной обработки ошибок с помощью сервиса `$exceptionHandler` и перехвата HTTP-запросов с помощью интерсепторов.

### $exceptionHandler

Сервис `$exceptionHandler` — это глобальный обработчик ошибок, который вызывается при возникновении необработанных исключений в вашем приложении. Вы можете переопределить этот сервис, чтобы реализовать собственную логику обработки ошибок, например, для логирования ошибок, отображения пользовательских сообщений об ошибках или отправки отчетов об ошибках на сервер.

**Пример:**

```javascript
angular.module('myApp', [])
  .config(function($provide) {
    $provide.decorator('$exceptionHandler', function($delegate) {
      return function(exception, cause) {
        // Вызов стандартного обработчика ошибок
        $delegate(exception, cause);

        // Дополнительная логика обработки ошибок
        console.error('Произошла ошибка:', exception.message, cause);
        // Отправка отчета об ошибке на сервер
        // ...
      };
    });
  });
```

В данном примере мы используем `$provide.decorator` для переопределения сервиса `$exceptionHandler`. Внутри функции-обработчика мы сначала вызываем стандартный обработчик ошибок (`$delegate`), чтобы сохранить его поведение по умолчанию. Затем мы добавляем свою логику, которая выводит сообщение об ошибке в консоль и может отправлять отчет об ошибке на сервер.

### Интерсепторы

Интерсепторы — это функции, которые перехватывают HTTP-запросы и ответы, отправляемые и получаемые вашим приложением. Вы можете использовать интерсепторы для выполнения следующих задач:

* Аутентификация запросов
* Добавление заголовков к запросам и ответам
* Преобразование данных запроса и ответа
* Обработка ошибок HTTP

Интерсепторы определяются как фабрики, которые возвращают объект с методами для перехвата различных этапов HTTP-запроса:

| Метод           | Описание                                                        |
|----------------|-----------------------------------------------------------------|
| `request`      | Вызывается перед отправкой запроса                             |
| `requestError` | Вызывается при возникновении ошибки во время отправки запроса |
| `response`     | Вызывается после получения ответа                             |
| `responseError`| Вызывается при возникновении ошибки при получении ответа       |

**Пример:**

```javascript
angular.module('myApp')
  .factory('httpInterceptor', function($q) {
    return {
      // Добавление заголовка авторизации к каждому запросу
      request: function(config) {
        config.headers['Authorization'] = 'Bearer ' + localStorage.getItem('token');
        return config;
      },
      // Обработка ошибки 401 (Unauthorized)
      responseError: function(response) {
        if (response.status === 401) {
          // Перенаправление на страницу входа
          $location.path('/login');
          return $q.reject(response);
        }
        return $q.reject(response);
      }
    };
  })
  .config(function($httpProvider) {
    // Регистрация интерсептора
    $httpProvider.interceptors.push('httpInterceptor');
  });
```

В этом примере мы создаем фабрику `httpInterceptor`, которая определяет методы `request` и `responseError`. Метод `request` добавляет заголовок авторизации к каждому запросу, а метод `responseError` обрабатывает ошибку 401, перенаправляя пользователя на страницу входа.

### Совместное использование $exceptionHandler и интерсепторов

Вы можете использовать `$exceptionHandler` и интерсепторы совместно для обработки ошибок в вашем приложении. Например, вы можете использовать интерсептор для перехвата ошибок HTTP, а затем передавать их в `$exceptionHandler` для централизованной обработки.

**Пример:**

```javascript
angular.module('myApp')
  .factory('httpInterceptor', function($q, $injector) {
    return {
      responseError: function(response) {
        // Получение сервиса $exceptionHandler
        var $exceptionHandler = $injector.get('$exceptionHandler');

        // Передача ошибки в $exceptionHandler
        $exceptionHandler(new Error('HTTP Error: ' + response.status), response.config.url);

        return $q.reject(response);
      }
    };
  });
```

В этом примере мы получаем сервис `$exceptionHandler` с помощью `$injector` внутри метода `responseError`. Это позволяет нам передавать ошибки HTTP в `$exceptionHandler` для централизованной обработки.

### Заключение

Обработка ошибок является важной частью разработки любого приложения. AngularJS предоставляет удобные инструменты для обработки ошибок, такие как `$exceptionHandler` и интерсепторы. Используя эти инструменты, вы можете создавать надежные и удобные приложения, которые эффективно обрабатывают ошибки. 
