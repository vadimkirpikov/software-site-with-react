## Удаление документов из MongoDB с помощью Node.js

В процессе работы с базой данных MongoDB часто возникает необходимость удалять документы. Node.js в сочетании с драйвером MongoDB предоставляет удобные инструменты для выполнения этой задачи. 

### Подключение к базе данных

Перед тем как удалять документы, необходимо установить соединение с базой данных MongoDB. Для этого используется драйвер `mongodb`:

```javascript
const { MongoClient } = require('mongodb');

async function connectToDatabase() {
  const uri = "mongodb://localhost:27017"; // Замените на ваш URI
  const client = new MongoClient(uri);

  try {
    await client.connect();
    console.log("Успешное подключение к базе данных!");
    return client;
  } catch (error) {
    console.error("Ошибка подключения:", error);
  }
}
```

В этом примере мы:

1. Импортируем класс `MongoClient` из пакета `mongodb`.
2. Определяем URI для подключения к базе данных. 
3. Создаем экземпляр `MongoClient` с указанным URI.
4. Используем метод `connect()` для установления соединения.
5. Обрабатываем возможное исключение при подключении.

### Удаление одного документа

Для удаления одного документа используется метод `deleteOne()`. Этот метод принимает два аргумента:

1. Фильтр - объект, определяющий критерии выбора документа для удаления.
2. Опции - необязательный объект с настройками операции удаления.

Пример удаления документа:

```javascript
async function deleteSingleDocument(client) {
  const database = client.db('test'); // Выбираем базу данных
  const collection = database.collection('documents'); // Выбираем коллекцию

  const filter = { name: "Пример документа" }; // Критерий поиска

  try {
    const result = await collection.deleteOne(filter);
    console.log(`Удалено ${result.deletedCount} документов`);
  } catch (error) {
    console.error("Ошибка при удалении документа:", error);
  }
}
```

В этом примере мы:

1. Выбираем базу данных `test` и коллекцию `documents`.
2. Определяем фильтр для поиска документа с полем `name`, равным "Пример документа".
3. Вызываем метод `deleteOne()`, передавая фильтр в качестве аргумента.
4. Выводим количество удаленных документов.

### Удаление нескольких документов

Для удаления нескольких документов используется метод `deleteMany()`. Этот метод работает аналогично `deleteOne()`, но удаляет все документы, соответствующие заданному фильтру.

Пример удаления нескольких документов:

```javascript
async function deleteMultipleDocuments(client) {
  const database = client.db('test');
  const collection = database.collection('documents');

  const filter = { category: "Новости" }; // Критерий поиска

  try {
    const result = await collection.deleteMany(filter);
    console.log(`Удалено ${result.deletedCount} документов`);
  } catch (error) {
    console.error("Ошибка при удалении документов:", error);
  }
}
```

В этом примере мы удаляем все документы, у которых поле `category` равно "Новости".

### Опции удаления

Методы `deleteOne()` и `deleteMany()` принимают необязательный второй аргумент - объект с опциями. 

| Опция          | Описание                                                                  |
|----------------|--------------------------------------------------------------------------|
| `w`            | Уровень записи. По умолчанию 1.                                           |
| `wtimeout`      | Таймаут записи в миллисекундах.                                           |
| `j`            | Записать в журнал. По умолчанию false.                                  |
| `bypassDocumentValidation` | Пропустить валидацию документа на уровне приложения. По умолчанию false. |

Пример использования опций:

```javascript
const result = await collection.deleteMany(
  { category: "Новости" },
  { w: "majority", wtimeout: 5000 }
);
```

В этом примере мы указываем опции `w` и `wtimeout` для обеспечения записи на большинство узлов реплики с таймаутом 5 секунд.

### Заключение

В этой статье мы рассмотрели основные методы удаления документов из MongoDB с помощью Node.js. Вы научились подключаться к базе данных, удалять один или несколько документов, а также использовать опции для управления процессом удаления. 
