## Создание API с помощью Node.js

Node.js, благодаря своей неблокирующей архитектуре, идеально подходит для создания производительных и масштабируемых API. В этом разделе мы рассмотрим основные шаги и инструменты для создания простого REST API с помощью Node.js.

### Выбор фреймворка

Node.js предоставляет обширную экосистему фреймворков для разработки веб-приложений, включая API. Некоторые популярные варианты:

| Фреймворк | Описание |
|---|---|
| Express.js | Минималистичный и гибкий фреймворк, подходящий для большинства API. |
| Koa.js | Более современный фреймворк, использующий async/await для более чистого кода. |
| Fastify | Высокопроизводительный фреймворк, оптимизированный для скорости и низкого потребления ресурсов. |

В этом руководстве мы будем использовать **Express.js** из-за его популярности и простоты.

### Установка Express.js

Создайте новый проект Node.js и инициализируйте его:

```
mkdir my-api
cd my-api
npm init -y
```

Затем установите Express.js:

```
npm install express
```

### Создание простого сервера

Создайте файл `index.js` и добавьте следующий код:

```javascript
const express = require('express');
const app = express();
const port = 3000;

// Обработчик запросов на корневой маршрут
app.get('/', (req, res) => {
  res.send('Hello from my API!');
});

// Запуск сервера
app.listen(port, () => {
  console.log(`Server is running on port ${port}`);
});
```

В этом коде мы:

1. Импортируем модуль `express`.
2. Создаем экземпляр приложения Express.js.
3. Определяем порт, на котором будет работать сервер.
4. Создаем обработчик GET-запросов на корневой маршрут (`/`), который отправляет простое текстовое сообщение клиенту.
5. Запускаем сервер и выводим сообщение в консоль.

Запустите сервер с помощью команды `node index.js`. Откройте браузер и перейдите по адресу `http://localhost:3000/`. Вы должны увидеть сообщение "Hello from my API!".

### Определение маршрутов и обработчиков запросов

Маршруты определяют конечные точки API, а обработчики запросов определяют действия, выполняемые при обращении к этим конечным точкам. 

Давайте создадим маршрут `/users` для получения списка пользователей:

```javascript
// ... предыдущий код ...

const users = [
  { id: 1, name: 'John Doe' },
  { id: 2, name: 'Jane Doe' },
];

app.get('/users', (req, res) => {
  res.json(users);
});

// ... остальной код ...
```

В этом коде мы:

1. Создаем массив `users` с данными пользователей.
2. Определяем обработчик GET-запросов на маршрут `/users`.
3. Отправляем массив `users` в формате JSON клиенту с помощью метода `res.json()`.

### Обработка параметров запроса

Параметры запроса используются для передачи данных в API. Express.js предоставляет объект `req.query` для доступа к этим параметрам.

Давайте изменим маршрут `/users` для поиска пользователя по имени:

```javascript
app.get('/users', (req, res) => {
  const name = req.query.name;
  const filteredUsers = name 
    ? users.filter(user => user.name.includes(name)) 
    : users;
  res.json(filteredUsers);
});
```

Теперь, если вы отправите GET-запрос на `http://localhost:3000/users?name=John`, API вернет только пользователя с именем "John Doe".

### Обработка тела запроса

Тело запроса используется для передачи данных в API, обычно в формате JSON. Express.js не обрабатывает тело запроса по умолчанию. Для этого нужно использовать middleware, например, `body-parser`:

```
npm install body-parser
```

Добавьте следующий код после импорта `express`:

```javascript
const bodyParser = require('body-parser');
app.use(bodyParser.json());
```

Теперь вы можете получать доступ к телу JSON-запроса через объект `req.body`.

### Создание маршрутов для CRUD-операций

CRUD - это аббревиатура для основных операций с данными: Create, Read, Update, Delete (создание, чтение, обновление, удаление). Давайте создадим маршруты для всех CRUD-операций с пользователями:

```javascript
// ... предыдущий код ...

let nextUserId = 3;

// Создание пользователя (POST /users)
app.post('/users', (req, res) => {
  const newUser = {
    id: nextUserId++,
    name: req.body.name
  };
  users.push(newUser);
  res.status(201).json(newUser);
});

// Обновление пользователя (PUT /users/:id)
app.put('/users/:id', (req, res) => {
  const userId = parseInt(req.params.id);
  const userIndex = users.findIndex(user => user.id === userId);

  if (userIndex === -1) {
    return res.status(404).send('User not found');
  }

  users[userIndex] = { ...users[userIndex], name: req.body.name };
  res.json(users[userIndex]);
});

// Удаление пользователя (DELETE /users/:id)
app.delete('/users/:id', (req, res) => {
  const userId = parseInt(req.params.id);
  const userIndex = users.findIndex(user => user.id === userId);

  if (userIndex === -1) {
    return res.status(404).send('User not found');
  }

  users.splice(userIndex, 1);
  res.status(204).send();
});

// ... остальной код ...
```

В этом коде мы:

1. Создаем маршрут POST для создания пользователя.
2. Создаем маршрут PUT для обновления пользователя.
3. Создаем маршрут DELETE для удаления пользователя.
4. Используем коды состояния HTTP для обозначения результатов операции (201 Created, 404 Not Found, 204 No Content).

### Заключение

Мы рассмотрели основы создания API с помощью Node.js и Express.js. Вы научились создавать сервер, определять маршруты, обрабатывать запросы и работать с данными. 

Это лишь базовый пример, и существует множество других аспектов, которые нужно учитывать при разработке реальных API, таких как:

* Обработка ошибок
* Валидация данных
* Аутентификация и авторизация
* Тестирование
* Документирование

Продолжайте изучать Node.js и Express.js, чтобы создавать более сложные и функциональные API.
