## Модели и представления в Node.js: Структурирование приложения

В процессе разработки веб-приложений на Node.js часто возникает необходимость структурировать данные и логику взаимодействия с ними. Для этого используются две важные концепции: **модели** и **представления**. В этой статье мы рассмотрим эти концепции и научимся применять их на практике.

### Понимание моделей и представлений

**Модель** - это объект, представляющий сущность в вашем приложении. Например, если вы разрабатываете блог, моделью может быть "Статья", содержащая заголовок, текст, дату публикации и автора. Модели обычно отвечают за:

- Определение структуры данных.
- Валидацию данных.
- Взаимодействие с базой данных.

**Представление** - это компонент, отвечающий за отображение данных пользователю и обработку его действий. В случае с блогом, представление может отображать список статей или форму добавления новой статьи. Представления обычно:

- Получают данные от моделей.
- Формируют HTML-код, отправляемый браузеру.
- Обрабатывают пользовательский ввод.

### Выбор подходящей библиотеки

Для работы с моделями и представлениями в Node.js существует множество библиотек. Рассмотрим два популярных варианта:

**1. Sequelize:**

- **Преимущества:** Поддерживает множество баз данных (PostgreSQL, MySQL, SQLite и др.), предоставляет мощные инструменты для работы с отношениями между моделями.
- **Недостатки:** Более сложная настройка, может быть избыточной для простых проектов.

**2. Mongoose:**

- **Преимущества:**  Специализируется на работе с MongoDB, простая и интуитивно понятная.
- **Недостатки:**  Поддерживает только MongoDB.

Выбор библиотеки зависит от конкретных требований проекта. В данном руководстве мы будем использовать **Mongoose** для работы с базой данных MongoDB.

### Подключение Mongoose и создание модели

**Шаг 1.** Установите Mongoose:

```bash
npm install mongoose
```

**Шаг 2.** Подключите Mongoose к базе данных в вашем файле `app.js`:

```javascript
const mongoose = require('mongoose');

// Подключение к базе данных
mongoose.connect('mongodb://localhost:27017/mydatabase', {
  useNewUrlParser: true,
  useUnifiedTopology: true
})
  .then(() => console.log('Подключение к базе данных установлено'))
  .catch(err => console.error('Ошибка подключения к базе данных:', err));
```

**Шаг 3.** Создайте модель "Статья" в файле `models/article.js`:

```javascript
const mongoose = require('mongoose');

// Определение схемы модели
const articleSchema = new mongoose.Schema({
  title: {
    type: String,
    required: true
  },
  content: {
    type: String,
    required: true
  },
  createdAt: {
    type: Date,
    default: Date.now
  }
});

// Создание модели на основе схемы
const Article = mongoose.model('Article', articleSchema);

module.exports = Article;
```

### Создание простого представления

**Шаг 1.** Создайте файл `views/articles.ejs` для отображения списка статей:

```html
<!DOCTYPE html>
<html>
<head>
  <title>Список статей</title>
</head>
<body>
  <h1>Статьи</h1>
  <ul>
    <% articles.forEach(article => { %>
      <li>
        <h2><%= article.title %></h2>
        <p><%= article.content %></p>
      </li>
    <% }); %>
  </ul>
</body>
</html>
```

**Шаг 2.** Создайте маршрут для отображения списка статей в файле `routes/articles.js`:

```javascript
const express = require('express');
const router = express.Router();
const Article = require('../models/article');

router.get('/', async (req, res) => {
  try {
    // Получение всех статей из базы данных
    const articles = await Article.find();

    // Отрисовка представления 'articles.ejs' с передачей данных 'articles'
    res.render('articles', { articles: articles });
  } catch (err) {
    console.error(err);
    res.status(500).send('Ошибка сервера');
  }
});

module.exports = router;
```

**Шаг 3.** Подключите маршрутизатор в файле `app.js`:

```javascript
// ...

const articlesRouter = require('./routes/articles');
app.use('/articles', articlesRouter);

// ...
```

### Запуск приложения

Запустите ваше приложение:

```bash
node app.js
```

Теперь, при переходе по адресу `http://localhost:3000/articles` (порт может отличаться), вы должны увидеть список статей, полученных из базы данных.

Это базовый пример использования моделей и представлений в Node.js. В дальнейшем вы сможете расширить функциональность, добавив возможность создавать, редактировать и удалять статьи, а также реализовать более сложную логику взаимодействия с пользователем. 
