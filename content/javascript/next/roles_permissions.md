## Система ролей и прав доступа в Next.js

Система ролей и прав доступа (RBAC) — это неотъемлемая часть многих веб-приложений, обеспечивающая безопасность и конфиденциальность данных. Она позволяет ограничить доступ пользователей к определенным функциям и ресурсам приложения в зависимости от их роли. В этой статье мы рассмотрим реализацию RBAC в Next.js 14.0.0 с использованием простых и эффективных методов.

**Определение ролей и прав доступа**

Первым шагом в реализации RBAC является определение ролей пользователей и соответствующих им прав доступа. Роли могут быть, например, "Администратор", "Редактор", "Пользователь". Каждая роль имеет определенный набор разрешений, например:

| Роль        | Права доступа                                           |
| ----------- | ------------------------------------------------------ |
| Администратор | Чтение, создание, редактирование, удаление всех данных |
| Редактор     | Чтение, создание, редактирование данных              |
| Пользователь | Только чтение данных                                   |

**Хранение информации о ролях и правах**

Существует несколько способов хранения информации о ролях и правах пользователей:

* **Локально в коде:** Подходит для небольших приложений с ограниченным количеством ролей и прав.
* **База данных:** Обеспечивает гибкость и масштабируемость, позволяет легко изменять роли и права.
* **Внешние сервисы:** Упрощают управление доступом и интеграцию с другими системами.

В данном примере мы будем использовать простой подход с локальным хранением информации о ролях и правах в коде:

```javascript
// roles.js
const ROLES = {
  ADMIN: 'admin',
  EDITOR: 'editor',
  USER: 'user',
};

const PERMISSIONS = {
  READ: 'read',
  CREATE: 'create',
  UPDATE: 'update',
  DELETE: 'delete',
};

const ROLE_PERMISSIONS = {
  [ROLES.ADMIN]: [
    PERMISSIONS.READ,
    PERMISSIONS.CREATE,
    PERMISSIONS.UPDATE,
    PERMISSIONS.DELETE,
  ],
  [ROLES.EDITOR]: [
    PERMISSIONS.READ,
    PERMISSIONS.CREATE,
    PERMISSIONS.UPDATE,
  ],
  [ROLES.USER]: [PERMISSIONS.READ],
};

export { ROLES, PERMISSIONS, ROLE_PERMISSIONS };
```

**Проверка прав доступа**

Для проверки прав доступа можно создать функцию, которая будет принимать роль пользователя и требуемое разрешение, а возвращать будет логическое значение, указывающее, разрешен ли доступ:

```javascript
// auth.js
import { ROLE_PERMISSIONS } from './roles';

export const hasPermission = (role, permission) => {
  // Проверка наличия роли и разрешения в списке
  return ROLE_PERMISSIONS[role]?.includes(permission);
};
```

**Применение RBAC в компонентах Next.js**

Для применения RBAC в компонентах Next.js можно использовать различные подходы. Один из них — создание middleware, которая будет проверять права доступа пользователя перед отображением страницы:

```javascript
// middleware.js
import { NextResponse } from 'next/server';
import { hasPermission } from './auth';

export async function middleware(request) {
  // Получение роли пользователя из сессии или другого источника
  const userRole = request.cookies.get('role')?.value || 'guest';

  // Проверка прав доступа на основе маршрута
  const path = request.nextUrl.pathname;
  if (path === '/admin' && !hasPermission(userRole, 'admin')) {
    return NextResponse.redirect(new URL('/login', request.url));
  }

  return NextResponse.next();
}
```

**Пример использования в компоненте**

```javascript
// pages/admin.js
import { useState } from 'react';

export default function AdminPage() {
  const [data, setData] = useState([]);

  // ... логика для работы с данными

  return (
    <div>
      <h1>Админ панель</h1>
      {/* ... отображение данных */}
    </div>
  );
}
```

В этом примере middleware проверяет, имеет ли пользователь роль "администратор" при попытке доступа к странице `/admin`. Если у пользователя нет необходимых прав, он будет перенаправлен на страницу входа.

**Заключение**

В этой статье мы рассмотрели базовые принципы реализации системы ролей и прав доступа в Next.js. Мы рассмотрели определение ролей, хранение информации о правах, проверку доступа и применение RBAC в компонентах. 

Помните, что это всего лишь базовый пример, и вам может потребоваться более сложная система в зависимости от требований вашего приложения.
