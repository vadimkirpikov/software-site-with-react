## Основы тестирования в Next.js

Тестирование — неотъемлемая часть разработки качественного ПО. Оно позволяет проверить корректность работы приложения, выявить потенциальные проблемы и обеспечить стабильность при дальнейшей разработке. В этой статье мы рассмотрим основные концепции тестирования в Next.js и познакомимся с инструментами, которые помогут нам в этом процессе.

### Виды тестирования

Существует множество видов тестирования, каждый из которых направлен на проверку различных аспектов приложения. Рассмотрим некоторые из них:

* **Модульное тестирование (Unit testing)**: проверка отдельных компонентов или функций в изоляции от других частей приложения. 
* **Интеграционное тестирование (Integration testing)**: проверка взаимодействия между различными компонентами приложения.
* **End-to-End тестирование (E2E testing)**: проверка работы приложения с точки зрения пользователя, имитируя его действия в браузере.

### Инструменты для тестирования

Next.js не навязывает конкретные инструменты для тестирования, предоставляя разработчикам свободу выбора.  Среди популярных инструментов можно выделить:

* **Jest:** фреймворк для тестирования JavaScript, разработанный Facebook. Отличается простотой настройки, высокой скоростью работы и мощными возможностями.
* **React Testing Library:** библиотека для тестирования React-компонентов, фокусирующаяся на проверке поведения компонентов с точки зрения пользователя.
* **Cypress:** инструмент для end-to-end тестирования, позволяющий имитировать действия пользователя в реальном браузере.

### Настройка Jest

Для начала работы с Jest необходимо установить необходимые пакеты:

```bash
npm install --save-dev jest @testing-library/react @testing-library/jest-dom
```

Далее, создадим файл конфигурации Jest `jest.config.js` в корне проекта:

```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  transform: {
    '^.+\\.(js|jsx|ts|tsx)$': '<rootDir>/node_modules/babel-jest',
  },
};
```

* `testEnvironment: 'jsdom'`: указывает на использование jsdom - легковесной реализации DOM для Node.js, что позволяет запускать тесты в виртуальном окружении браузера.
* `setupFilesAfterEnv`: массив путей к файлам, которые будут выполнены после настройки тестового окружения. В данном случае, указан файл `jest.setup.js`, который мы создадим далее.
* `transform`: объект, описывающий правила трансформации кода перед запуском тестов. В данном случае, используется `babel-jest` для трансформации файлов с расширениями `.js`, `.jsx`, `.ts`, `.tsx`.

Создадим файл `jest.setup.js`:

```javascript
// jest.setup.js
import '@testing-library/jest-dom/extend-expect';
```

В этом файле мы импортируем расширения для Jest от `@testing-library/jest-dom`, которые добавляют удобные проверки для работы с DOM-элементами.

### Написание первого теста

Создадим простой компонент `Button.jsx`, который будем тестировать:

```javascript
// components/Button.jsx
import React from 'react';

const Button = ({ children, onClick }) => {
  return (
    <button onClick={onClick}>
      {children}
    </button>
  );
};

export default Button;
```

Создадим файл `Button.test.jsx` рядом с компонентом и напишем первый тест:

```javascript
// components/Button.test.jsx
import React from 'react';
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import Button from './Button';

describe('Button', () => {
  it('рендерит кнопку с правильным текстом', () => {
    render(<Button>Нажми меня</Button>);
    const buttonElement = screen.getByText('Нажми меня');
    expect(buttonElement).toBeInTheDocument();
  });

  it('вызывает функцию по клику', () => {
    const handleClick = jest.fn(); // создаем мок-функцию
    render(<Button onClick={handleClick}>Нажми меня</Button>);
    const buttonElement = screen.getByText('Нажми меня');
    userEvent.click(buttonElement); // симулируем клик по кнопке
    expect(handleClick).toHaveBeenCalled(); // проверяем, что мок-функция была вызвана
  });
});
```

В этом тесте мы:

* Импортируем необходимые функции из `@testing-library/react` и `@testing-library/user-event`.
* Оборачиваем наши тесты в блок `describe`, который группирует связанные тесты.
* Используем функцию `render` для рендеринга нашего компонента.
* Используем `screen.getByText` для поиска элемента на странице по его текстовому содержимому.
* Используем `expect` для проверки утверждений.
* Используем `jest.fn()` для создания мок-функции, которая отслеживает свои вызовы.
* Используем `userEvent.click` для симуляции клика по элементу.

Для запуска теста, выполните команду `npx jest` в терминале. Вы должны увидеть успешный результат выполнения теста.

### Заключение

В этой статье мы рассмотрели основы тестирования в Next.js, познакомились с инструментами Jest и React Testing Library, а также написали свой первый тест. Тестирование является важным этапом разработки, который позволяет создавать надежные и стабильные приложения.
