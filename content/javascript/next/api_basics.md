## Создание RESTful API с Next.js

Next.js, помимо рендеринга страниц, предоставляет мощные возможности для создания серверных API. Это позволяет вам обрабатывать данные, взаимодействовать с базами данных и выполнять другие серверные операции, не покидая экосистемы Next.js. 

В основе API Next.js лежит концепция **API-маршрутов**. Файлы, расположенные в директории `pages/api`, автоматически становятся API-маршрутами. Каждый файл представляет собой отдельный endpoint вашего API.

### Базовый пример

Давайте создадим простой API, который будет возвращать список сообщений.

1. Создайте файл `pages/api/messages.js`:

```javascript
// pages/api/messages.js

export default function handler(req, res) {
  const messages = [
    { id: 1, text: 'Первое сообщение' },
    { id: 2, text: 'Второе сообщение' },
  ];

  res.status(200).json(messages);
}
```

В этом коде:

- `handler` - асинхронная функция, которая принимает два аргумента: `req` (объект запроса) и `res` (объект ответа).
- `messages` - массив объектов, представляющих сообщения.
- `res.status(200).json(messages)` - отправляем ответ с HTTP-статусом 200 (OK) и данными в формате JSON.

2. Запустите сервер разработки Next.js:

```bash
npm run dev
```

3. Откройте в браузере адрес `http://localhost:3000/api/messages`. Вы увидите JSON-ответ с созданным списком сообщений.

### HTTP-методы

API-маршруты Next.js могут обрабатывать различные HTTP-методы, такие как `GET`, `POST`, `PUT`, `DELETE` и др. Вы можете определить, какой метод был использован, проверив свойство `req.method`.

Пример обработки `GET` и `POST` запросов:

```javascript
// pages/api/messages.js

export default function handler(req, res) {
  if (req.method === 'GET') {
    // Обработка GET-запроса
    const messages = [
      { id: 1, text: 'Первое сообщение' },
      { id: 2, text: 'Второе сообщение' },
    ];
    res.status(200).json(messages);
  } else if (req.method === 'POST') {
    // Обработка POST-запроса
    const newMessage = req.body; // Получение данных из тела запроса
    // ... логика сохранения нового сообщения ...
    res.status(201).json({ message: 'Сообщение успешно создано' });
  } else {
    res.status(405).end(); // Метод не разрешен
  }
}
```

### Обработка данных запроса

Для доступа к данным, отправляемым клиентом в теле запроса (например, при отправке формы), вы можете использовать свойство `req.body`.

Пример:

```javascript
// pages/api/messages.js

export default async function handler(req, res) {
  if (req.method === 'POST') {
    const { text } = req.body;

    // Валидация данных
    if (!text) {
      return res.status(400).json({ message: 'Текст сообщения обязателен' });
    }

    // ... логика сохранения сообщения ...
  }

  // ...
}
```

### Динамические маршруты

Next.js позволяет создавать динамические API-маршруты, используя квадратные скобки `[]` в имени файла.

Пример:

```javascript
// pages/api/messages/[id].js

export default function handler(req, res) {
  const { id } = req.query; // Получение значения id из URL

  // ... логика получения сообщения по id ...
}
```

В этом примере `[id]` в имени файла создает динамический маршрут, который будет соответствовать любому URL-адресу вида `/api/messages/1`, `/api/messages/2` и т.д. Значение `id` будет доступно в объекте `req.query`.

Это лишь базовые принципы создания RESTful API с Next.js. В следующих разделах мы рассмотрим более сложные сценарии, такие как работа с базами данных, аутентификация и авторизация, обработка ошибок и многое другое. 
