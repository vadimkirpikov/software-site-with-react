## Выполнение SQL-запросов

Современная веб-разработка немыслима без взаимодействия с базами данных. В PHP для этого существует ряд расширений, позволяющих подключаться к различным СУБД, таким как MySQL, PostgreSQL, SQLite и другим.  

Одним из наиболее популярных и широко используемых расширений является **PDO (PHP Data Objects)**. PDO предоставляет абстрактный уровень доступа к базам данных, что позволяет писать единый код для работы с разными СУБД. В данном разделе мы рассмотрим основы работы с PDO и выполнение SQL-запросов.

### Подключение к базе данных

Первым шагом для работы с базой данных является установление соединения. Для этого используется конструктор класса PDO, которому передаются параметры подключения:

```php
<?php

// Параметры подключения
$dsn = 'mysql:host=localhost;dbname=test_db';
$username = 'user';
$password = 'password';

try {
    // Создание объекта PDO
    $pdo = new PDO($dsn, $username, $password);

    // Установка режима обработки ошибок в исключения
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    echo "Соединение установлено!";
} catch (PDOException $e) {
    // Обработка ошибок подключения
    echo "Ошибка подключения: " . $e->getMessage();
}

?>
```

В данном примере `$dsn` содержит строку подключения, указывающую драйвер (`mysql`), хост (`localhost`) и имя базы данных (`test_db`). Переменные `$username` и `$password` хранят имя пользователя и пароль для доступа к базе данных. 

Обратите внимание на блок `try...catch`.  Он позволяет отлавливать исключения, которые могут возникнуть в процессе подключения, и обрабатывать их соответствующим образом. 

### Выполнение SQL-запросов

После установки соединения можно выполнять SQL-запросы к базе данных. PDO предоставляет три основных метода для выполнения запросов:

* **query()**: Используется для выполнения запросов, которые возвращают набор данных, например, `SELECT`.
* **exec()**:  Используется для выполнения запросов, которые не возвращают набор данных, например, `INSERT`, `UPDATE`, `DELETE`.
* **prepare()**:  Используется для подготовки запросов с параметрами. Это позволяет избежать SQL-инъекций и повысить безопасность приложения.

#### Метод query()

Рассмотрим пример выполнения запроса `SELECT` с помощью метода `query()`:

```php
<?php

// Выполнение SQL-запроса
$query = "SELECT * FROM users";
$statement = $pdo->query($query);

// Обработка результатов запроса
while ($row = $statement->fetch(PDO::FETCH_ASSOC)) {
    echo $row['id'] . ' - ' . $row['name'] . '<br>';
}

?>
```

В данном примере `$statement` содержит объект типа `PDOStatement`, который представляет результат выполнения запроса. Метод `fetch()` используется для получения данных из результирующего набора построчно. Аргумент `PDO::FETCH_ASSOC` указывает, что данные должны быть возвращены в виде ассоциативного массива.

#### Метод exec()

Пример выполнения запроса `INSERT` с помощью метода `exec()`:

```php
<?php

// Выполнение SQL-запроса
$query = "INSERT INTO users (name, email) VALUES ('Иван', 'ivan@example.com')";
$affectedRows = $pdo->exec($query);

// Вывод количества затронутых строк
echo "Добавлено строк: " . $affectedRows;

?>
```

Метод `exec()` возвращает количество строк, затронутых запросом. 

#### Подготовленные запросы

Для повышения безопасности приложения и предотвращения SQL-инъекций рекомендуется использовать подготовленные запросы. Подготовленный запрос отправляется на сервер базы данных один раз, а затем может выполняться несколько раз с разными параметрами.

Пример использования подготовленного запроса:

```php
<?php

// Подготовка запроса
$query = "SELECT * FROM users WHERE name = ?";
$statement = $pdo->prepare($query);

// Привязка параметра и выполнение запроса
$name = 'Иван';
$statement->bindParam(1, $name);
$statement->execute();

// Обработка результатов запроса
while ($row = $statement->fetch(PDO::FETCH_ASSOC)) {
    echo $row['id'] . ' - ' . $row['name'] . '<br>';
}

?>
```

В данном примере символ `?` является placeholder'ом для параметра. Метод `bindParam()` связывает параметр `$name` с placeholder'ом под номером 1. 

### Заключение

В этой статье мы рассмотрели основы работы с PDO и выполнения SQL-запросов.  PDO предоставляет удобный и безопасный способ взаимодействия с базами данных. Подробную информацию о PDO и его возможностях можно найти в официальной документации PHP. 
