## Настройка PHP для разработки и продакшена

Правильная настройка PHP — это ключевой фактор успеха вашего проекта. Оптимизированная для конкретной среды конфигурация обеспечит безопасность, производительность и предсказуемое поведение вашего приложения. В этом разделе мы рассмотрим базовые параметры конфигурации PHP 8.3 для сред разработки и production, а также узнаем, как управлять ими.

### Конфигурационный файл php.ini

PHP хранит свои настройки в файле `php.ini`. Поиск этого файла происходит в следующих местах (в порядке приоритета):

- Текущая директория
- Переменная окружения `PHPRC`
- Путь, заданный во время компиляции PHP

Чтобы узнать расположение вашего файла `php.ini`, создайте файл `info.php` со следующим содержимым:

```php
<?php
phpinfo();
```

Запустите этот файл через веб-сервер и найдите строку "Loaded Configuration File".

### Основные параметры php.ini

#### 1. Отображение ошибок

В режиме разработки важно видеть все ошибки и предупреждения, чтобы своевременно их исправлять. Для этого настройте следующие параметры:

```
error_reporting = E_ALL
display_errors = On
```

В production-среде отображение ошибок может представлять угрозу безопасности, поэтому рекомендуется отключить его:

```
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT
display_errors = Off
```

Вместо отображения ошибок в браузере настройте логирование в файл:

```
log_errors = On
error_log = /var/log/php-errors.log
```

#### 2. Лимит времени выполнения скрипта

Параметр `max_execution_time` определяет максимальное время выполнения скрипта в секундах.

```
max_execution_time = 30 
```

#### 3. Лимит памяти

Параметр `memory_limit` устанавливает максимальный объем памяти, который может использовать скрипт.

```
memory_limit = 128M
```

#### 4. Загрузка файлов

Параметры `file_uploads`, `upload_max_filesize` и `post_max_size` отвечают за загрузку файлов на сервер.

```
file_uploads = On
upload_max_filesize = 2M
post_max_size = 8M
```

#### 5. Сессии

Параметр `session.save_path` определяет директорию для хранения сессионных файлов.

```
session.save_path = "/tmp"
```

### Различия в настройках для разработки и продакшена

| Параметр | Разработка | Production |
|---|---|---|
| `display_errors` | On | Off |
| `error_reporting` | E_ALL | E_ALL & ~E_DEPRECATED & ~E_STRICT |
| `log_errors` | Off | On |
| `error_log` | - | /var/log/php-errors.log |
| `display_startup_errors` | On | Off |

В production-среде рекомендуется:

- Установить более строгие ограничения на `max_execution_time` и `memory_limit` для предотвращения перегрузки сервера.
- Отключить отображение ошибок и включить логирование ошибок.
- Использовать кэширование для повышения производительности.
- Регулярно обновлять PHP до последней версии для обеспечения безопасности.

### Управление настройками PHP

#### 1. Локальные значения

Вы можете переопределить значения параметров `php.ini` непосредственно в ваших скриптах с помощью функции `ini_set()`:

```php
<?php
// Устанавливаем лимит памяти для текущего скрипта
ini_set('memory_limit', '256M');
```

#### 2. Файл .htaccess

Если у вас есть доступ к файлу `.htaccess` на веб-сервере, вы можете использовать директиву `php_value` для изменения настроек PHP.

```
<IfModule mod_php5.c>
  php_value upload_max_filesize 10M
</IfModule>
```

#### 3. Переменные окружения

Некоторые параметры PHP можно переопределить с помощью переменных окружения. Например:

```
export PHP_MEMORY_LIMIT=256M
```

### Заключение

Правильная настройка PHP – это важный шаг в разработке и деплое приложений. Необходимо учитывать разницу между средами разработки и production, а также использовать все доступные инструменты для управления настройками PHP. Соблюдение рекомендаций из этого раздела поможет вам создать безопасное, производительное и надежное приложение.
