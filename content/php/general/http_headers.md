## Заголовки HTTP в PHP

Заголовки HTTP играют важную роль во взаимодействии клиента (например, браузера) и сервера. Они содержат метаданные о запросе или ответе, такие как кодировка, тип содержимого, куки и многое другое. PHP предоставляет удобные функции для управления этими заголовками.

### Отправка заголовков

Для отправки HTTP-заголовков в PHP используется функция `header()`. Она принимает строку с заголовком в качестве аргумента. 

**Важно:** Функция `header()` должна вызываться до вывода любого контента в браузер, включая пробелы и HTML-теги. В противном случае, PHP выдаст ошибку.

**Пример:**

```php
<?php

// Установка кодировки UTF-8
header('Content-Type: text/html; charset=utf-8');

// Перенаправление на другую страницу
header('Location: https://www.example.com/');
exit; // Важно остановить выполнение скрипта после перенаправления

// Установка cookie
header('Set-Cookie: name=value; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/');

// Запрет кэширования страницы
header('Cache-Control: no-store, no-cache, must-revalidate, max-age=0');
header('Pragma: no-cache');
header('Expires: 0');

// Вывод сообщения об ошибке 404
header('HTTP/1.1 404 Not Found');
echo '<h1>Страница не найдена</h1>';
?>
```

###  Основные заголовки и их назначение

| Заголовок | Описание | Пример |
|---|---|---|
| Content-Type |  Определяет тип содержимого ответа, например, HTML, JSON или изображение. | `Content-Type: text/html; charset=utf-8` |
| Location |  Используется для перенаправления пользователя на другой URL.  | `Location: https://www.example.com/` |
| Set-Cookie | Устанавливает cookie на стороне клиента. | `Set-Cookie: name=value; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/` |
| Cache-Control |  Управляет кэшированием страницы браузером и прокси-серверами. | `Cache-Control: no-cache, max-age=0` |
| Expires |  Указывает дату и время, когда ресурс считается устаревшим.  | `Expires: Wed, 21 Oct 2023 07:28:00 GMT` |
| Pragma |  Предоставляет директивы кэширования, совместимые с HTTP 1.0. | `Pragma: no-cache` |
| Last-Modified |  Указывает дату последнего изменения ресурса. | `Last-Modified: Tue, 15 Nov 2022 12:45:26 GMT` |

###  Получение заголовков запроса

Для получения значений отправленных клиентом заголовков используется суперглобальный массив `$_SERVER`. 

**Пример:**

```php
<?php

// Получение User-Agent
$user_agent = $_SERVER['HTTP_USER_AGENT'];

// Получение реферера
$referer = $_SERVER['HTTP_REFERER'] ?? ''; // Используем оператор ?? для предотвращения ошибки, если заголовок не установлен

// Вывод значений
echo "Ваш браузер: " . $user_agent . "<br>";
echo "Вы пришли с сайта: " . $referer;

?>
```

### Работа с cookies

Cookie - это небольшие фрагменты данных, которые веб-сайт сохраняет на компьютере пользователя для отслеживания информации о сессии или предпочтениях.

#### Установка cookies

Для установки cookie используется функция `setcookie()`:

```php
setcookie(string $name, string $value = "", array $options = []): bool
```

**Параметры функции `setcookie()`:**

| Параметр | Описание |
|---|---|
| `name` | Имя cookie (обязательный параметр) |
| `value` | Значение cookie |
| `options` | Ассоциативный массив с дополнительными параметрами, такими как:  |
| | `expires` - время истечения срока действия cookie (timestamp) |
| | `path` - путь на сервере, для которого доступна cookie |
| | `domain` - домен, для которого доступна cookie |
| | `secure` - отправлять cookie только по HTTPS |
| | `httponly` - делать cookie доступной только через HTTP-протокол, защищая от JavaScript-атак |
| | `samesite` -  защита от CSRF атак, указывает политику использования cookie для межсайтовых запросов |

**Пример:**

```php
<?php

// Установка cookie на 1 час
setcookie('username', 'John Doe', time() + 3600, '/', '.example.com', true, true, 'Lax'); 
?>
```

####  Чтение cookies

Для чтения cookies используется суперглобальный массив `$_COOKIE`:

```php
<?php

// Получение значения cookie
$username = $_COOKIE['username'] ?? '';

// Проверка наличия cookie
if (isset($_COOKIE['username'])) {
    echo "Привет, " . $username;
} else {
    echo "Cookie не установлены";
}
?>
```

###  Безопасность при работе с заголовками HTTP

*   Всегда проверяйте данные, полученные из заголовков, перед использованием.
*   Используйте подготовленные запросы для предотвращения SQL-инъекций.
*   Не выводите чувствительную информацию в заголовках.
*   При работе с cookie всегда устанавливайте параметры `secure` и `httponly` для защиты от XSS-атак.
*   Используйте  флаг `samesite` в cookie  для защиты от CSRF.

**Важно помнить**, что заголовки HTTP играют важную роль во взаимодействии между клиентом и сервером, и правильное использование функций PHP для работы с ними является важным аспектом разработки безопасных и эффективных веб-приложений.