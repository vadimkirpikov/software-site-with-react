## Создание и выполнение миграций

Миграции в Laravel - это PHP-классы, которые позволяют управлять структурой базы данных приложения. Они позволяют создавать таблицы, изменять их структуру и удалять их, используя выразительный и контролируемый подход. Вместо того чтобы вручную выполнять SQL-запросы, вы можете использовать миграции для внесения изменений в базу данных, что делает процесс разработки более структурированным, предсказуемым и, что важно, обратимым.

### Создание миграций

Для создания новой миграции используйте команду Artisan:

```bash
php artisan make:migration create_users_table
```

Эта команда создаст новый файл миграции в директории `database/migrations`. Имя файла будет содержать текущую временную метку и имя миграции, указанное в команде (например, `2024_02_14_143012_create_users_table.php`).

Созданный файл миграции будет содержать класс с двумя методами: `up` и `down`.

- **Метод `up`** используется для определения действий, которые необходимо выполнить при применении миграции. Например, создание таблицы.
- **Метод `down`** используется для определения действий, которые необходимо выполнить при откате миграции. Например, удаление таблицы.

### Пример миграции для создания таблицы users

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Выполняется при применении миграции.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id(); // Создает автоинкрементируемое поле id
            $table->string('name'); // Создает текстовое поле 'name'
            $table->string('email')->unique(); // Создает уникальное текстовое поле 'email'
            $table->timestamp('email_verified_at')->nullable(); // Создает поле 'email_verified_at' для хранения timestamp
            $table->string('password'); // Создает текстовое поле 'password'
            $table->rememberToken(); // Создает текстовое поле 'remember_token'
            $table->timestamps(); // Создает поля 'created_at' и 'updated_at' для хранения timestamp
        });
    }

    /**
     * Выполняется при откате миграции.
     */
    public function down(): void
    {
        Schema::dropIfExists('users'); // Удаляет таблицу 'users'
    }
};
```

### Выполнение миграций

Для применения всех outstanding миграций используйте команду:

```bash
php artisan migrate
```

Эта команда выполнит все миграции, которые еще не были применены к базе данных.

### Откат миграций

Для отката последней примененной миграции используйте команду:

```bash
php artisan migrate:rollback
```

Для отката нескольких миграций укажите количество шагов:

```bash
php artisan migrate:rollback --step=3
```

Эта команда откатит последние три примененные миграции.

### Сброс и повторная миграция

Для сброса всех миграций и их повторного применения используйте команду:

```bash
php artisan migrate:refresh
```

Эта команда сначала откатит все миграции, а затем применит их заново.

### Доступные типы полей

Laravel предоставляет широкий набор типов полей для создания таблиц. Некоторые из них:

| Тип поля | Описание |
|---|---|
| `bigIncrements` | Автоинкрементируемое большое целое число (primary key) |
| `string` | Текстовая строка переменной длины |
| `text` | Длинный текст |
| `integer` | Целое число |
| `boolean` | Логическое значение (true/false) |
| `date` | Дата |
| `dateTime` | Дата и время |
| `timestamp` | Временная метка Unix |
| `binary` | Бинарные данные |

### Модификаторы полей

Модификаторы полей позволяют изменять свойства полей таблицы. 

| Модификатор | Описание |
|---|---|
| `unique` | Создает уникальный индекс для поля |
| `nullable` | Позволяет полю содержать значение NULL |
| `default` | Устанавливает значение по умолчанию для поля |
| `unsigned` | Указывает, что поле должно хранить только положительные числа |

### Создание индексов

Индексы используются для ускорения поиска данных в таблице.

```php
// Создание индекса для поля 'email'
$table->index('email');

// Создание составного индекса для полей 'first_name' и 'last_name'
$table->index(['first_name', 'last_name']);

// Создание уникального индекса для поля 'phone_number'
$table->unique('phone_number');
```

### Создание внешних ключей

Внешние ключи используются для связи между таблицами.

```php
// Создание внешнего ключа для поля 'user_id', 
// ссылающегося на поле 'id' таблицы 'users'
$table->foreign('user_id')->references('id')->on('users');

// Установка каскадного удаления
$table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
```

Используя миграции, вы можете управлять структурой базы данных вашего приложения Laravel более эффективно и безопасно. 
