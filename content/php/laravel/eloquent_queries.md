## Основы запросов с использованием Eloquent

Eloquent - это мощный ORM (Object-Relational Mapper), предоставляемый фреймворком Laravel. ORM позволяет взаимодействовать с базой данных с помощью объектно-ориентированного синтаксиса, что делает код более читаемым и удобным в поддержке.

### Подключение модели

Перед началом работы с Eloquent необходимо подключить соответствующую модель. Модели обычно располагаются в папке `app/Models`.  Предположим, у нас есть модель `User`:

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    //
}
```

### Получение всех записей

Для получения всех записей из таблицы, связанной с моделью, используется метод `all()`:

```php
use App\Models\User;

$users = User::all();

foreach ($users as $user) {
    echo $user->name;
}
```

### Получение одной записи

Метод `find()` позволяет получить одну запись по ее первичному ключу:

```php
$user = User::find(1);

echo $user->email;
```

### Условия выборки

#### Метод `where()`

Для добавления условий выборки используется метод `where()`:

```php
$activeUsers = User::where('status', 'active')->get();

foreach ($activeUsers as $user) {
    echo $user->name;
}
```

#### Операторы сравнения

Eloquent поддерживает различные операторы сравнения:

| Оператор | Описание                     |
| -------- | --------------------------- |
| `=`      | равно                       |
| `>`      | больше                      |
| `<`      | меньше                      |
| `>=`     | больше или равно             |
| `<=`     | меньше или равно             |
| `!=`     | не равно                    |
| `like`   | поиск по шаблону           |
| `in`     | принадлежит списку         |
| `null`   | значение равно NULL         |
| `notnull`| значение не равно NULL      |

#### Комбинирование условий

Для комбинирования условий используются логические операторы `and` и `or`:

```php
$users = User::where('status', 'active')
             ->where('age', '>', 25)
             ->get();
```

### Сортировка

Метод `orderBy()` позволяет отсортировать результаты запроса:

```php
$users = User::orderBy('name', 'desc')->get();
```

Первый аргумент метода - это имя столбца для сортировки, второй аргумент (необязательный) - направление сортировки (`asc` - по возрастанию, `desc` - по убыванию).

### Лимиты и пагинация

#### Метод `take()`

Метод `take()` ограничивает количество получаемых записей:

```php
$users = User::take(5)->get();
```

#### Метод `skip()`

Метод `skip()` позволяет пропустить определенное количество записей:

```php
$users = User::skip(10)->take(5)->get();
```

#### Пагинация

Для реализации пагинации используется метод `paginate()`:

```php
$users = User::paginate(15);

// В шаблоне:
{{ $users->links() }}
```

### Агрегатные функции

Eloquent предоставляет ряд агрегатных функций:

* `count()`: количество записей
* `max()`: максимальное значение
* `min()`: минимальное значение
* `avg()`: среднее значение
* `sum()`: сумма значений

```php
$userCount = User::count();

$maxPrice = Product::max('price');
```

### Примеры

#### Получить всех пользователей с email-адресом в домене "example.com", отсортированных по имени в обратном порядке, с лимитом в 10 записей:

```php
$users = User::where('email', 'like', '%@example.com%')
             ->orderBy('name', 'desc')
             ->take(10)
             ->get();
```

#### Получить количество заказов, сделанных каждым пользователем:

```php
$users = User::withCount('orders')->get();

foreach ($users as $user) {
    echo $user->name . ': ' . $user->orders_count;
}
```

### Заключение

В этом разделе мы рассмотрели основы работы с Eloquent ORM в Laravel. 
Мы изучили основные методы выборки данных, добавление условий, сортировку, 
лимиты, пагинацию и использование агрегатных функций. 
Eloquent предоставляет удобный и интуитивно понятный 
интерфейс для работы с базой данных, 
что значительно упрощает разработку веб-приложений. 
Более подробно возможности Eloquent будут рассмотрены в следующих разделах. 
