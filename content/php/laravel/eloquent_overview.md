## Модели и ORM Eloquent в Laravel

В этом разделе мы рассмотрим один из ключевых компонентов фреймворка Laravel - модели и ORM Eloquent. Понимание принципов работы с моделями существенно упростит разработку вашего приложения.

### Что такое модель?

Модель в Laravel - это PHP класс, который представляет собой таблицу в базе данных. Каждая модель предоставляет удобный интерфейс для взаимодействия с этой таблицей: получение, создание, обновление и удаление записей.

### ORM Eloquent

Eloquent - это реализация паттерна ActiveRecord в Laravel. Он позволяет работать с базой данных, используя выразительный синтаксис PHP, без необходимости писать SQL запросы напрямую. 

Основные преимущества Eloquent:

* **Удобство и простота:**  Eloquent предоставляет интуитивно понятный синтаксис для выполнения CRUD-операций, что значительно упрощает работу с базой данных.
* **Безопасность:** Eloquent предотвращает SQL инъекции, экранируя пользовательские данные.
* **Гибкость:** Eloquent поддерживает множество типов отношений между моделями, что позволяет создавать сложные структуры данных.
* **Миграции:** Laravel предоставляет механизм миграций, который позволяет легко изменять структуру базы данных и синхронизировать ее с моделями.

### Создание модели

Для создания модели в Laravel используется команда `artisan`:

```bash
php artisan make:model Product
```

Эта команда создаст файл модели `Product.php` в папке `app/Models`.

Пример файла модели:

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Product extends Model
{
    //
}
```

### Соединение с таблицей

По умолчанию Eloquent предполагает, что имя таблицы во множественном числе соответствует имени модели. В нашем случае модель `Product` будет связана с таблицей `products`. 

Если вам нужно указать другое имя таблицы, вы можете определить свойство `$table` в модели:

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Product extends Model
{
    protected $table = 'my_products'; // Указываем имя таблицы 'my_products'
}
```

### Массовое заполнение

Для защиты от уязвимостей, связанных с массовым присвоением, Eloquent требует явно указать поля, доступные для заполнения.  Это можно сделать, определив свойство `$fillable` в модели:

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Product extends Model
{
    protected $fillable = ['name', 'description', 'price']; // Поля, доступные для массового заполнения
}
```

Теперь мы можем создать новый продукт, используя метод `create`:

```php
$product = Product::create([
    'name' => 'Телефон',
    'description' => 'Смартфон последней модели',
    'price' => 1000,
]);
```

### Получение данных

Eloquent предоставляет множество методов для получения данных из базы данных. 

#### Получение всех записей

```php
$products = Product::all(); // Возвращает коллекцию всех продуктов
```

#### Получение одной записи

```php
$product = Product::find(1); // Возвращает продукт с id = 1
```

#### Условия выборки

```php
$expensiveProducts = Product::where('price', '>', 500)->get(); // Возвращает продукты с ценой больше 500
```

#### Сортировка

```php
$sortedProducts = Product::orderBy('name')->get(); // Возвращает продукты, отсортированные по имени
```

### Обновление данных

Для обновления данных можно использовать метод `update`:

```php
$product = Product::find(1);
$product->update([
    'price' => 1100, 
]);
```

### Удаление данных

Для удаления данных используется метод `delete`:

```php
$product = Product::find(1);
$product->delete();
```

### Вывод

В этой части руководства мы рассмотрели основы работы с моделями и ORM Eloquent в Laravel. Мы научились создавать модели, подключаться к таблицам, выполнять CRUD-операции и использовать базовые методы выборки. В следующих разделах мы углубимся в более сложные возможности Eloquent, такие как отношения между моделями, eager loading и многое другое.
