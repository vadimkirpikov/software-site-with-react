## Тестирование кода: юнит-тесты и UI-тесты

Качественное приложение — это не только приложение с богатым функционалом и привлекательным дизайном, но и приложение, работающее стабильно и предсказуемо. Достичь этого помогает тестирование, которое позволяет выявлять и исправлять ошибки на ранних этапах разработки. В этой статье мы рассмотрим два ключевых типа тестирования в Swift: юнит-тесты и UI-тесты.

### Юнит-тесты

Юнит-тесты — это тесты, направленные на проверку корректности работы отдельных частей (юнитов) кода, таких как функции, методы или классы. Они изолированы друг от друга и от внешних зависимостей, что позволяет быстро и точно определить источник ошибки.

#### Создание юнит-тестов

Для создания юнит-тестов в Xcode используется фреймворк XCTest. При создании нового проекта Xcode автоматически генерирует target для тестирования с именем `<имя_проекта>Tests`.

Каждый тест — это метод класса, унаследованного от XCTestCase. Название метода должно начинаться с `test` и описывать тестируемое поведение. 

**Пример:**

```swift
import XCTest
@testable import MyProject // Импортируем тестируемый модуль

class MyProjectTests: XCTestCase {
    func testAddition() throws {
        // Arrange: подготовка данных для теста
        let a = 2
        let b = 3

        // Act: вызов тестируемого кода
        let result = a + b

        // Assert: проверка результата
        XCTAssertEqual(result, 5, "Сложение работает некорректно")
    }
}
```

В этом примере мы тестируем операцию сложения. Метод `testAddition` содержит три основные части:

* **Arrange (Подготовка):** определяются входные данные для теста (переменные `a` и `b`).
* **Act (Действие):** вызывается тестируемый код (`a + b`).
* **Assert (Проверка):** с помощью функции `XCTAssertEqual` проверяется, равен ли результат ожидаемому значению.

#### Методы проверки (assertions)

XCTest предоставляет набор функций для проверки различных условий:

| Метод                    | Описание                                                                             |
|---------------------------|-------------------------------------------------------------------------------------|
| `XCTAssertEqual`           | Проверяет равенство двух значений                                                        |
| `XCTAssertNotEqual`        | Проверяет неравенство двух значений                                                   |
| `XCTAssertTrue`            | Проверяет, истинно ли выражение                                                       |
| `XCTAssertFalse`           | Проверяет, ложно ли выражение                                                        |
| `XCTAssertNil`             | Проверяет, равно ли значение `nil`                                                  |
| `XCTAssertNotNil`          | Проверяет, не равно ли значение `nil`                                                 |
| `XCTAssertThrowsError`     | Проверяет, бросает ли код ошибку                                                     |
| `XCTAssertNoThrow`         | Проверяет, что код не бросает ошибку                                                    |

#### Запуск юнит-тестов

Запустить юнит-тесты можно несколькими способами:

* Нажав на кнопку запуска тестов в панели инструментов Xcode.
* Выбрав пункт меню Product > Test.
* Используя сочетание клавиш Command + U.

### UI-тесты

UI-тесты используются для проверки пользовательского интерфейса и его взаимодействия с пользователем. Они имитируют действия пользователя, такие как нажатия на кнопки, ввод текста и прокрутка, и проверяют, что приложение реагирует на них ожидаемым образом.

#### Создание UI-тестов

UI-тесты создаются аналогично юнит-тестам, но используют другой класс — `XCUIApplication`.

**Пример:**

```swift
import XCTest

class MyProjectUITests: XCTestCase {
    func testTapButton() throws {
        // UI tests must launch the application under test.
        let app = XCUIApplication()
        app.launch()

        // Находим кнопку по ее label и тапаем по ней
        let button = app.buttons["My Button"]
        button.tap()

        // Проверяем, что после нажатия на кнопку появился alert
        let alert = app.alerts["Alert Title"]
        XCTAssertTrue(alert.waitForExistence(timeout: 5))
    }
}
```

В этом примере мы запускаем приложение, находим кнопку с label "My Button" и "нажимаем" на нее. Затем проверяем, что после этого действия появился alert с заданным title.

#### Поиск элементов UI

Для поиска элементов UI в UI-тестах используются различные методы класса `XCUIElementQuery`. 

Примеры:

* `app.buttons["Кнопка"]`: поиск кнопки с label "Кнопка"
* `app.textFields["Поле ввода"]`: поиск текстового поля с placeholder "Поле ввода"
* `app.staticTexts["Текст"]`: поиск элемента с текстом "Текст"
* `app.cells.element(boundBy: 0)`: поиск первой ячейки в таблице

#### Действия с UI

После того как элемент UI найден, с ним можно выполнять различные действия:

* `tap()`: тап по элементу
* `doubleTap()`: двойной тап по элементу
* `twoFingerTap()`: тап двумя пальцами по элементу
* `press(forDuration:thenDragTo:)`: нажатие на элемент с последующим перетаскиванием

#### Проверка состояния UI

Для проверки состояния UI используются методы, аналогичные методам проверки в юнит-тестах. 

Примеры:

* `XCTAssertTrue(element.exists)`: проверяет, существует ли элемент на экране
* `XCTAssertEqual(element.label, "Текст")`: проверяет, равен ли label элемента заданному значению
* `XCTAssertTrue(element.isEnabled)`: проверяет, активен ли элемент

### Заключение

В этой статье мы рассмотрели основы юнит-тестирования и UI-тестирования в Swift. Тестирование — неотъемлемая часть разработки качественного программного обеспечения. Регулярное написание тестов позволяет выявлять ошибки на ранних этапах, повышает надежность кода и упрощает его дальнейшую поддержку. 
