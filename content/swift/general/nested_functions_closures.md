## Вложенные функции и замыкания

В Swift, функции - это мощный инструмент, позволяющий структурировать код и повторно использовать логику. В этом разделе мы рассмотрим два важных аспекта функций: вложенные функции и замыкания. 

### Вложенные функции

Вложенная функция - это функция, объявленная внутри другой функции. Она имеет доступ к переменным и константам, объявленным во внешней функции, даже если внешняя функция уже завершила свое выполнение.

```swift
func outerFunction(param: Int) -> () -> Int {
    let outerValue = 10
    
    func innerFunction() -> Int {
        // innerFunction имеет доступ к outerValue и param
        return outerValue + param
    }
    
    return innerFunction
}
```

В этом примере `innerFunction` является вложенной функцией, объявленной внутри `outerFunction`. Она имеет доступ к параметру `param` и константе `outerValue`, объявленным во внешней функции. 

Обратите внимание, что `outerFunction` возвращает функцию. Это возможно благодаря тому, что в Swift функции являются объектами первого класса - их можно присваивать переменным, передавать в качестве аргументов и возвращать из других функций.

```swift
let myFunction = outerFunction(param: 5)
let result = myFunction() // result будет равен 15
```

В этом примере мы сначала вызываем `outerFunction(param: 5)`, которая возвращает нам `innerFunction`. Затем мы сохраняем эту функцию в переменной `myFunction` и вызываем ее. 

### Замыкания

Замыкание - это самодостаточный блок кода, который можно передавать и использовать в других частях программы. Замыкания похожи на функции, но у них есть несколько ключевых отличий:

* Замыкания могут захватывать и сохранять ссылки на переменные и константы из окружающего контекста, в котором они определены.
* Замыкания можно определить без имени.
* Синтаксис замыканий более лаконичный, чем у функций.

Рассмотрим пример:

```swift
func makeIncrementer(forIncrement amount: Int) -> () -> Int {
    var runningTotal = 0
    
    // Замыкание захватывает переменную runningTotal
    let incrementer: () -> Int = {
        runningTotal += amount
        return runningTotal
    }
    
    return incrementer
}
```

В этом примере функция `makeIncrementer` принимает один аргумент - `amount` - и возвращает замыкание. Замыкание захватывает переменную `runningTotal`, объявленную во внешней функции, и увеличивает ее на значение `amount` при каждом вызове.

```swift
let incrementByTen = makeIncrementer(forIncrement: 10)
print(incrementByTen()) // Выведет 10
print(incrementByTen()) // Выведет 20
print(incrementByTen()) // Выведет 30
```

В этом примере мы сначала создаем замыкание `incrementByTen`, которое увеличивает значение на 10. Затем мы трижды вызываем это замыкание, и каждый раз значение увеличивается на 10.

### Синтаксис замыканий

Синтаксис замыканий может быть кратким. Рассмотрим несколько примеров:

**Полный синтаксис:**

```swift
{ (parameters) -> returnType in
    // Тело замыкания
}
```

**Пример:**

```swift
let add: (Int, Int) -> Int = { (a: Int, b: Int) -> Int in
    return a + b
}
```

**Сокращенный синтаксис:**

* Тип параметров и возвращаемого значения можно не указывать, если компилятор может их вывести.
* Можно использовать сокращенные имена аргументов ($0, $1, и т.д.).
* Если тело замыкания состоит из одного выражения, его можно не заключать в фигурные скобки и не использовать ключевое слово `return`.

**Пример:**

```swift
let add = { $0 + $1 }
```

### Использование замыканий

Замыкания часто используются в Swift для:

* Передачи блоков кода в качестве аргументов функциям (например, функциям сортировки, фильтрации, отображения).
* Создания асинхронных операций (например, сетевых запросов).
* Определения обработчиков событий (например, обработчиков нажатий на кнопки).

**Пример:**

```swift
let numbers = [1, 2, 3, 4, 5]

// Фильтрация массива с помощью замыкания
let evenNumbers = numbers.filter { $0 % 2 == 0 }

// evenNumbers будет содержать [2, 4]
```

В этом примере мы используем замыкание `$0 % 2 == 0`, чтобы отфильтровать массив `numbers` и получить новый массив, содержащий только четные числа.

Вложенные функции и замыкания - это мощные инструменты, которые делают Swift более выразительным и гибким. Понимание того, как их использовать, поможет вам писать более чистый, лаконичный и эффективный код. 
