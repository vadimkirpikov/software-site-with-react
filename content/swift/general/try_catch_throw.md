## Обработка ошибок с помощью try, catch, throw в Swift 5.9

В Swift ошибки являются полноценными объектами, которые можно создавать, передавать и обрабатывать. Такой подход позволяет писать более предсказуемый и безопасный код. В этом разделе мы рассмотрим механизм обработки ошибок с помощью ключевых слов `try`, `catch` и `throw`, а также узнаем, как создавать собственные типы ошибок.

### Ключевое слово `throw`

Ключевое слово `throw` используется для "выбрасывания" ошибки, сигнализируя о том, что что-то пошло не так.  Рассмотрим пример:

```swift
enum NetworkError: Error {
    case badURL
    case requestFailed
}

func fetchData(from urlString: String) throws -> Data {
    guard let url = URL(string: urlString) else {
        throw NetworkError.badURL
    }

    // Код, который может выбросить ошибку
    let (data, _) = try Data(contentsOf: url)
    return data
}
```

В данном примере определена функция `fetchData(from:)`, которая принимает строку URL и пытается получить данные с сервера.  

1. **Создание типа ошибки:** 
   - Создаем перечисление `NetworkError`, которое соответствует протоколу `Error`. 
   -  `NetworkError` содержит два случая: `badURL` и `requestFailed`, которые представляют возможные ошибки при получении данных.

2. **Использование `guard` и `throw`:**
   - Внутри функции `fetchData(from:)` используем оператор `guard` для проверки, удалось ли создать URL из переданной строки. 
   - Если URL создать не удалось (значение `url` равно `nil`), "выбрасываем" ошибку `NetworkError.badURL` с помощью `throw`.

3. **Обработка потенциальной ошибки при получении данных:**
    -  `Data(contentsOf:)` - это инициализатор, который может выбросить ошибку, если не удастся получить данные по указанному URL. 
    - Ключевое слово `try` перед инициализатором указывает компилятору, что мы ожидаем потенциальную ошибку и будем ее обрабатывать. 

### Ключевые слова `try` и `catch`

Для обработки выброшенных ошибок используются блоки `do-catch`. 

```swift
do {
    let data = try fetchData(from: "https://example.com/data")
    // Обработка полученных данных
} catch NetworkError.badURL {
    // Обработка ошибки некорректного URL
} catch {
    // Обработка других ошибок
} 
```

1. **Блок `do`:**
   - Код, который может выбросить ошибку, помещается в блок `do`.
   - В примере мы вызываем функцию `fetchData(from:)`, которая может выбросить ошибку типа `NetworkError`. 

2. **Блок `catch`:**
   - Блоки `catch` используются для обработки различных типов ошибок.
   - Первый блок `catch` обрабатывает ошибку `NetworkError.badURL`, а второй блок `catch` обрабатывает все остальные ошибки.

### Создание собственных типов ошибок

Вы можете создавать собственные типы ошибок, определяюя их как перечисления, структуры или классы, соответствующие протоколу `Error`.

```swift
enum DatabaseError: Error {
    case connectionError(message: String)
    case dataNotFound
}
```

В данном примере определен тип ошибки `DatabaseError` с двумя случаями: `connectionError` с описанием ошибки и `dataNotFound`, указывающий на отсутствие данных. 

**Пример использования:**

```swift
func connectToDatabase() throws {
    // Логика подключения к базе данных
    if connectionFailed {
        throw DatabaseError.connectionError(message: "Ошибка подключения")
    }
}

do {
    try connectToDatabase()
    // Работа с базой данных
} catch DatabaseError.connectionError(let message) {
    print("Ошибка базы данных: \(message)")
} catch DatabaseError.dataNotFound {
    print("Данные не найдены")
} catch {
    print("Произошла неизвестная ошибка")
}
```

В этом примере, если функция `connectToDatabase()` "выбросит" ошибку `DatabaseError.connectionError`, то блок `catch` перехватит ее и выведет сообщение об ошибке, переданное в `message`. 

Использование механизма обработки ошибок с помощью `try`, `catch` и `throw` позволяет писать более надежный и предсказуемый код, обрабатывая ошибки явным образом. 
