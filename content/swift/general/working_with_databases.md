## Работа с базами данных в Swift

В мире разработки мобильных приложений, хранение и управление данными являются неотъемлемыми аспектами. В Swift, языке программирования для iOS, macOS, watchOS и tvOS, существует несколько способов работы с базами данных, каждый из которых подходит для разных сценариев. В этой статье мы рассмотрим основы работы с базами данных в Swift, используя фреймворк SQLite. 

SQLite - это встраиваемая реляционная база данных, отличающаяся простотой использования и легковесностью. Она идеально подходит для хранения данных локально на устройстве пользователя.

### Подключение SQLite к проекту Xcode

Для начала работы с SQLite в проекте Xcode, необходимо подключить соответствующую библиотеку. Это можно сделать с помощью Swift Package Manager:

1. Откройте ваш проект Xcode.
2. Выберите File -> Add Packages...
3. В строке поиска введите "SQLite.swift" и выберите соответствующий пакет.
4. Убедитесь, что выбрана последняя версия пакета, и нажмите "Add Package".

После завершения установки пакета, вы можете импортировать SQLite в ваш проект Swift:

```swift
import SQLite
```

### Создание и подключение к базе данных

После подключения библиотеки SQLite, вы можете создать новую базу данных или подключиться к существующей. 

```swift
// Путь к файлу базы данных
let dbPath = NSSearchPathForDirectoriesInDomains(.documentDirectory, .userDomainMask, true).first! + "/mydatabase.sqlite3"

// Создание подключения к базе данных
let db = try Connection(dbPath)
```

В этом примере мы определяем путь к файлу базы данных, расположенному в директории документов пользователя. Затем мы создаем объект `Connection`, передавая ему путь к файлу. Если файл базы данных не существует, он будет создан автоматически.

### Создание таблицы

Перед тем, как начать сохранять данные в базе данных, необходимо создать таблицу. Таблица в реляционной базе данных представляет собой набор данных, организованных в строки и столбцы. 

```swift
// Создание таблицы "users"
try db.execute(
    """
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        email TEXT UNIQUE
    )
    """
)
```

В этом примере мы используем метод `execute()` объекта `Connection` для выполнения SQL-запроса. Запрос создает таблицу `users` с тремя столбцами:

* `id`: Целочисленный столбец, являющийся первичным ключом и автоматически увеличивающимся.
* `name`: Строковый столбец, обязательный для заполнения.
* `email`: Строковый столбец, значения в котором должны быть уникальными.

### Вставка данных в таблицу

Для добавления новых записей в таблицу, используйте инструкцию `INSERT`:

```swift
// Вставка новой записи в таблицу "users"
let insertStatement = try db.prepare(
    """
    INSERT INTO users (name, email) VALUES (?, ?)
    """
)

try insertStatement.run("Иван Иванов", "ivan.ivanov@example.com")
```

В этом примере мы используем плейсхолдеры `?` для предотвращения SQL-инъекций. Значения для плейсхолдеров передаются в метод `run()`.

### Чтение данных из таблицы

Для получения данных из таблицы, используйте инструкцию `SELECT`:

```swift
// Выборка всех записей из таблицы "users"
let users = try db.prepare("SELECT * FROM users")

// Итерация по результатам запроса
for user in users {
    let id = user[0] as! Int64 // Получение значения столбца "id"
    let name = user[1] as! String // Получение значения столбца "name"
    let email = user[2] as! String // Получение значения столбца "email"
    
    print("ID: \(id), Имя: \(name), Email: \(email)")
}
```

В этом примере мы используем метод `prepare()` для подготовки SQL-запроса. Затем мы итерируем по объекту `users`, получая доступ к значениям столбцов по их индексам.

### Обновление данных в таблице

Для обновления записей в таблице, используйте инструкцию `UPDATE`:

```swift
// Обновление записи в таблице "users"
let updateStatement = try db.prepare(
    """
    UPDATE users SET email = ? WHERE id = ?
    """
)

try updateStatement.run("new.email@example.com", 1)
```

В этом примере мы обновляем адрес электронной почты пользователя с `id = 1`.

### Удаление данных из таблицы

Для удаления записей из таблицы, используйте инструкцию `DELETE`:

```swift
// Удаление записи из таблицы "users"
let deleteStatement = try db.prepare(
    """
    DELETE FROM users WHERE id = ?
    """
)

try deleteStatement.run(1)
```

В этом примере мы удаляем запись пользователя с `id = 1`.

### Заключение

В этой статье мы рассмотрели основы работы с базами данных SQLite в Swift. Вы узнали, как подключаться к базе данных, создавать таблицы, а также выполнять базовые операции CRUD (Create, Read, Update, Delete). SQLite - это мощный и простой инструмент, который можно использовать для хранения данных в ваших приложениях Swift. 
