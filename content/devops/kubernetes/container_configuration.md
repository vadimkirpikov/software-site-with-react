## Конфигурация и работа с контейнерами внутри подов

В предыдущих разделах мы познакомились с основами Kubernetes и узнали, что такое поды. Теперь разберемся, как конфигурировать и управлять контейнерами внутри подов. 

### Определение контейнеров в манифестах Pod

Каждый под описывается YAML или JSON файлом, называемым манифестом. В манифесте мы указываем Kubernetes, какие контейнеры нужно запустить в поде. 

Рассмотрим пример простого манифеста пода, запускающего один контейнер Nginx:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
spec:
  containers:
  - name: nginx
    image: nginx:latest
```

Разберем содержимое манифеста:

- **apiVersion:** Указывает версию Kubernetes API, которую мы используем. 
- **kind:** Определяет тип объекта, в данном случае это Pod.
- **metadata:** Содержит метаданные пода, такие как имя.
- **spec:** Описывает желаемое состояние пода, включая список контейнеров.

В разделе `containers` мы определяем контейнеры, которые будут запущены в поде:

- **name:** Уникальное имя контейнера внутри пода.
- **image:** Название образа контейнера, который будет использован для запуска. 

В данном примере мы используем образ `nginx:latest`, который будет загружен из Docker Hub.

### Запуск пода

Для запуска пода, описанного в манифесте, используем команду `kubectl apply`:

```bash
kubectl apply -f nginx-pod.yaml
```

Опция `-f` указывает путь к файлу манифеста.

### Несколько контейнеров в одном поде

Kubernetes позволяет запускать несколько контейнеров в одном поде. Это полезно, когда контейнеры зависят друг от друга или выполняют совместную задачу.

Например, рассмотрим под, который запускает веб-сервер Nginx и приложение, логирующее запросы в stdout:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-logger-pod
spec:
  containers:
  - name: nginx
    image: nginx:latest
  - name: logger
    image: busybox
    command: ["sh", "-c", "tail -f /dev/null"]
```

В этом примере мы определили два контейнера: `nginx` и `logger`. Контейнер `logger` использует образ `busybox` и запускает команду `tail -f /dev/null`, которая эмулирует работу приложения, записывающего логи.

### Работа с портами контейнеров

По умолчанию порты контейнеров внутри пода недоступны извне. Для того чтобы сделать порт контейнера доступным, необходимо определить его в секции `ports` манифеста пода.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
spec:
  containers:
  - name: nginx
    image: nginx:latest
    ports:
    - containerPort: 80
```

В данном примере мы указали, что контейнер `nginx` слушает порт `80`. 

### Переменные окружения

Для настройки контейнеров используются переменные окружения. Их можно определить в манифесте пода двумя способами:

**1. Использование поля `env`:**

```yaml
env:
- name: MY_VARIABLE
  value: "my value"
```

**2. Использование поля `envFrom` для загрузки переменных из ConfigMap или Secret:**

```yaml
envFrom:
- configMapRef:
    name: my-config
```

### Монтирование томов

Kubernetes позволяет монтировать тома в контейнеры для хранения данных. Существуют различные типы томов, например:

- **emptyDir:** Эфемерные тома, существующие только во время жизни пода.
- **hostPath:** Монтирование директории хост-машины в контейнер.
- **persistentVolumeClaim:** Использование Persistent Volumes для хранения данных.

Пример монтирования `emptyDir` в контейнер:

```yaml
volumes:
- name: shared-data
  emptyDir: {}

containers:
- name: my-container
  image: my-image
  volumeMounts:
  - name: shared-data
    mountPath: /data
```

### Ресурсные ограничения

Kubernetes позволяет ограничивать потребление ресурсов (CPU, памяти) контейнерами. Это делается с помощью полей `resources` в манифесте пода:

```yaml
resources:
  limits:
    cpu: "1"
    memory: "512Mi"
  requests:
    cpu: "0.5"
    memory: "256Mi"
```

В данном примере мы установили лимит потребления CPU в 1 ядро и памяти в 512 мегабайт, а также запросили гарантированное выделение 0.5 ядра CPU и 256 мегабайт памяти.

### Заключение

В этой статье мы рассмотрели базовые принципы конфигурации и работы с контейнерами внутри подов. Более подробно о работе с подами, управлении их жизненным циклом, сетевыми настройками и другими аспектами работы с Kubernetes вы узнаете из следующих разделов руководства. 
