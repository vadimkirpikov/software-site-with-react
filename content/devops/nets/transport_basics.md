## Основы транспортного уровня

Транспортный уровень играет ключевую роль в модели OSI, обеспечивая надежную и эффективную передачу данных между приложениями на разных хостах. Он абстрагируется от деталей физической передачи данных, предоставляя приложениям высокоуровневый интерфейс для обмена сообщениями.

### Основные функции транспортного уровня:

* **Сегментация и сборка данных:** Разбиение данных приложения на сегменты удобного размера для передачи по сети и их последующая сборка на стороне получателя.
* **Управление потоком:** Регулирование скорости передачи данных, чтобы не перегружать получателя.
* **Установление и разрыв соединения:** В зависимости от протокола, может предоставляться механизм для установления логического соединения между приложениями перед обменом данными и его корректного завершения.
* **Мультиплексирование:**  Возможность нескольким приложениям на одном хосте использовать общие сетевые ресурсы, идентифицируя приложения с помощью номеров портов.

### Протоколы транспортного уровня

Существует множество протоколов транспортного уровня, но наиболее распространенными являются TCP и UDP:

**TCP (Transmission Control Protocol):**

* **Ориентированный на соединение:** Перед передачей данных устанавливается логическое соединение, обеспечивающее надежную доставку.
* **Надежная доставка:** Гарантирует доставку всех сегментов данных в правильном порядке без потерь или дублирования.
* **Управление потоком и перегрузками:** Адаптирует скорость передачи данных к пропускной способности сети.
* **Пример использования:** HTTP, HTTPS, FTP, SMTP

**UDP (User Datagram Protocol):**

* **Без установления соединения:**  Не требует установления соединения перед передачей данных, что уменьшает задержки.
* **Ненадежная доставка:** Не гарантирует доставку данных и не отслеживает порядок прибытия.
* **Высокая производительность:** Отсутствие дополнительных механизмов делает UDP более быстрым и эффективным для приложений, где потеря некоторых данных допустима.
* **Пример использования:** DNS, DHCP, VoIP, потоковое видео

### Номера портов

Для мультиплексирования транспортный уровень использует номера портов. Каждый порт идентифицирует определенное приложение или сервис на хосте. 

* **Номера портов от 0 до 1023:** Зарезервированы для известных сервисов (например, порт 80 для HTTP, порт 443 для HTTPS).
* **Номера портов от 1024 до 49151:** Зарегистрированные порты, которые могут быть использованы приложениями.
* **Номера портов от 49152 до 65535:** Динамические порты, которые назначаются операционной системой временно.

### Пример кода:

```python
# Пример простого UDP сервера на Python
import socket

UDP_IP = "127.0.0.1"  # Адрес для прослушивания
UDP_PORT = 5005  # Номер порта

sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) # Создание UDP сокета
sock.bind((UDP_IP, UDP_PORT)) # Привязка сокета к адресу и порту

while True:
    data, addr = sock.recvfrom(1024) # Получение данных
    print(f"Получено сообщение: {data.decode()} от {addr}") 
    sock.sendto(data, addr) # Отправка данных обратно отправителю
```

**Описание кода:**

1.  Импортируется библиотека `socket`.
2.  Определяются адрес (`UDP_IP`) и порт (`UDP_PORT`) для прослушивания.
3.  Создается UDP сокет.
4.  Сокет связывается с указанным адресом и портом.
5.  В бесконечном цикле сервер ожидает данные.
6.  При получении данных, выводится информация об отправителе и сообщении.
7.  Полученные данные отправляются обратно отправителю.

### Заключение

Понимание основ транспортного уровня важно для работы с сетевыми приложениями. Знание разницы между TCP и UDP, а также принципов работы портов поможет в настройке, диагностике и оптимизации сетевых взаимодействий. 
