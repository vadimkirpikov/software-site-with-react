## Обзор серверов и локаций в Nginx

Nginx, как мощный веб-сервер и обратный прокси-сервер, предоставляет широкие возможности для настройки обработки запросов. Ключевыми элементами этой настройки являются понятия "сервер" и "локация".  

### Серверы в Nginx

"Сервер" в контексте конфигурации Nginx — это не физический сервер, а виртуальный блок, определяющий конфигурацию для обработки запросов к определенному домену, IP-адресу или их комбинации. 

#### Создание виртуальных серверов

Виртуальные серверы определяются внутри блока `http` в главном конфигурационном файле Nginx (обычно `nginx.conf`) с помощью директивы `server`:

```
http {
    ... 
    server {
        # Конфигурация виртуального сервера
    }
    ... 
}
```

#### Пример конфигурации виртуального сервера:

```
server {
    listen 80;                   # Прослушиваемый порт
    server_name example.com;    # Доменное имя
    
    location / {                # Корневая локация
        root /var/www/example.com; # Путь к файлам сайта
        index index.html;          # Файл индекса
    }
}
```

В данном примере:

* `listen 80`: Сервер прослушивает порт 80 (стандартный HTTP-порт).
* `server_name example.com`: Сервер отвечает на запросы к домену example.com.
* `location /`: Определяет корневую локацию, обрабатывающую запросы к `/`.
* `root /var/www/example.com`: Указывает путь к файлам сайта.
* `index index.html`: Задает файл индекса (по умолчанию `index.html`).

### Локации в Nginx

"Локация" — это механизм, позволяющий более детально настраивать обработку запросов в зависимости от URI запроса. Локации определяются внутри блока `server` и могут быть вложенными.

#### Типы локаций

Существует два основных типа локаций:

* **Точные:** Сопоставляются с URI запроса точно. Задаются с помощью префикса `=`.
  
   Пример: `location = /images/logo.png { ... }` будет обрабатывать только запросы к `/images/logo.png`.

* **Регулярные выражения:** Используют регулярные выражения для сопоставления с URI. 

   * **С модификатором `~*`:**  регистронезависимые.
   * **С модификатором `~`:**  регистрозависимые.
   * **С префиксами `^~` :**  приоритет над регулярными выражениями.
   * **Без префиксов:**  приоритет над именованными локациями.

    Пример:  `location ~* \.(jpg|jpeg|png)$ { ... }` будет обрабатывать запросы к файлам с расширениями jpg, jpeg, png (без учета регистра).

#### Приоритет локаций

Nginx выбирает наиболее подходящую локацию для обработки запроса на основе следующих правил:

1. Точная локация имеет наивысший приоритет.
2. Локации с префиксом `^~` имеют приоритет над регулярными выражениями.
3. Регулярные выражения с модификаторами `~` и `~*` обрабатываются в порядке их определения.
4. Локации без префиксов имеют наименьший приоритет.

#### Пример конфигурации с локациями

```
server {
    listen 80;
    server_name example.com;

    location / {
        root /var/www/example.com;
        index index.html;
    }

    location /images/ {     # Обработка запросов к изображениям
        root /var/www/images; 
    }

    location ~* \.php$ {   # Обработка PHP-файлов
        # ... конфигурация PHP-обработчика
    }
}
```

В этом примере:

* Локация `/images/` обрабатывает запросы к изображениям, находящимся в папке `/var/www/images`.
* Локация `~* \.php$` обрабатывает все запросы к файлам с расширением .php.

### Заключение

"Серверы" и "локации" — фундаментальные понятия конфигурации Nginx. Виртуальные серверы позволяют обслуживать несколько сайтов на одном сервере, а локации обеспечивают гибкую настройку обработки запросов на основе URI. Глубокое понимание этих инструментов открывает путь к созданию сложных и эффективных конфигураций веб-сервера. 
