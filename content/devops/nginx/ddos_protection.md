## Защита от DDoS-атак с помощью nginx

DDoS-атаки представляют собой серьёзную угрозу для веб-серверов, так как могут привести к отказу в обслуживании (DoS) для легитимных пользователей. Nginx предоставляет ряд инструментов и техник для эффективной защиты от подобных атак.

### Ограничение скорости запросов

Ограничение скорости запросов позволяет ограничить количество запросов, которые клиент может отправлять на сервер за определенный промежуток времени.  Это помогает предотвратить перегрузку сервера и защитить его от DoS-атак.

**Пример конфигурации:**

```nginx
limit_req_zone $binary_remote_addr zone=one:10m rate=5r/s;

server {
    ...
    location / {
        limit_req zone=one;
        ...
    }
}
```

**Описание:**

* `limit_req_zone`: определяет зону ограничения скорости запросов с именем `one` и размером хранилища 10 мегабайт.
* `$binary_remote_addr`: используется как ключ для идентификации клиентов.
* `rate=5r/s`:  ограничивает скорость запросов до 5 в секунду на один IP-адрес.
* `limit_req zone=one`: применяет ограничение скорости запросов из зоны `one` к блоку `location`.

### Блокировка подозрительных IP-адресов

Блокировка подозрительных IP-адресов позволяет предотвратить доступ к серверу со стороны известных злоумышленников. Для этого можно использовать директивы `deny` и `allow` в файле конфигурации nginx.

**Пример конфигурации:**

```nginx
geo $blacklist {
    default 0;
    192.168.1.10 1;
    10.0.0.0/8 1;
}

server {
    ...
    if ($blacklist) {
        return 403;
    }
    ...
}
```

**Описание:**

* `geo $blacklist`: определяет переменную `$blacklist`, которая принимает значение `1`, если IP-адрес находится в черном списке, и `0` - в противном случае.
* `192.168.1.10`:  блокирует доступ с конкретного IP-адреса.
* `10.0.0.0/8`:  блокирует доступ из целой подсети.
* `if ($blacklist) { return 403; }`:  возвращает ошибку 403 (Forbidden) для заблокированных IP-адресов.

### Использование кэширования

Кэширование позволяет сохранять копии часто запрашиваемых страниц на сервере или у клиента, что снижает нагрузку на сервер во время DDoS-атаки.

**Пример конфигурации:**

```nginx
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m inactive=60m max_size=1g;

server {
    ...
    location / {
        proxy_pass http://backend;
        proxy_cache my_cache;
        proxy_cache_valid 200 30m;
    }
}
```

**Описание:**

* `proxy_cache_path`: определяет расположение и параметры кэша.
* `keys_zone=my_cache:10m`: создает зону хранения ключей кэша размером 10 мегабайт.
* `proxy_cache my_cache`:  включает кэширование для запросов к указанному бекенду.
* `proxy_cache_valid 200 30m`:  кэширует ответы с кодом 200 (OK) на 30 минут.

### Ограничение количества подключений

Ограничение количества одновременных подключений от одного IP-адреса помогает предотвратить истощение ресурсов сервера.

**Пример конфигурации:**

```nginx
limit_conn_zone $binary_remote_addr zone=conn_limit:10m;

server {
    ...
    limit_conn conn_limit 10;
    ...
}
```

**Описание:**

* `limit_conn_zone`:  определяет зону ограничения подключений с именем `conn_limit` и размером 10 мегабайт.
* `limit_conn conn_limit 10`:  ограничивает количество одновременных подключений от одного IP-адреса до 10.

### Использование WAF (Web Application Firewall)

WAF - это веб-приложение, которое анализирует трафик на наличие вредоносных запросов и блокирует их. Существуют  модули WAF для nginx, такие как ModSecurity, которые предоставляют расширенные возможности по защите от атак.

**Пример конфигурации:**

```nginx
load_module modules/ngx_http_modsecurity_module.so;

server {
    ...
    modsecurity on;
    modsecurity_rules_file /etc/nginx/modsec/main.conf;
    ...
}
```

**Описание:**

* `load_module`:  подключает модуль ModSecurity.
* `modsecurity on`:  включает ModSecurity для данного виртуального хоста.
* `modsecurity_rules_file`:  указывает файл с правилами ModSecurity.

### Дополнительные рекомендации

* **Мониторинг трафика:**  важно отслеживать трафик на сервере, чтобы своевременно выявлять подозрительную активность.
* **Использование CDN:** CDN (Content Delivery Network) помогает распределить трафик по нескольким серверам, снижая нагрузку на основной сервер.
* **Обновление ПО:**  регулярно обновляйте nginx и другие компоненты системы, чтобы исправлять уязвимости.

Защита от DDoS-атак - это комплексная задача, которая требует комплексного подхода. Использование описанных выше методов и инструментов nginx поможет повысить защищенность вашего веб-сервера от подобных угроз.