## Виртуальные хосты (Server Blocks) в Nginx

Виртуальные хосты (в терминологии Nginx — **server blocks**) позволяют запускать несколько сайтов или веб-приложений на одном сервере Nginx. Каждый виртуальный хост имеет собственные настройки, определяющие, как Nginx будет обрабатывать запросы к определенному домену или IP-адресу.

### Принципы работы

При получении запроса Nginx определяет, какой виртуальный хост должен его обработать, на основе следующих параметров:

* **IP-адрес:** Запросы могут быть направлены на разные IP-адреса, привязанные к серверу.
* **Имя домена:** Заголовок `Host` в HTTP-запросе указывает доменное имя сайта.
* **Порт:** Разные виртуальные хосты могут прослушивать разные порты.

Nginx выбирает наиболее специфичный виртуальный хост, соответствующий запросу. Если найдено несколько совпадений, используется первый по порядку в конфигурационном файле.

### Создание виртуального хоста

Конфигурация виртуальных хостов хранится в файле **nginx.conf** или в отдельных файлах, расположенных в директории **sites-available** (путь может отличаться в зависимости от дистрибутива).

**Шаг 1:** Откройте конфигурационный файл Nginx:

```
sudo nano /etc/nginx/nginx.conf
```

**Шаг 2:** Добавьте новый блок `server` внутри блока `http`:

```nginx
http {
    ...
    server {
        # Настройки виртуального хоста
    }
    ...
}
```

**Шаг 3:** Настройте параметры виртуального хоста:

```nginx
server {
    listen 80;             # Порт для прослушивания
    server_name example.com;  # Доменное имя

    root /var/www/example.com; # Корневая директория сайта

    location / {
        index index.html; # Файл индекса
    }
}
```

**Шаг 4:** Сохраните изменения и перезапустите Nginx:

```
sudo systemctl restart nginx
```

### Пример настройки

Рассмотрим пример настройки двух виртуальных хостов: **example.com** и **blog.example.com**.

**Файл: /etc/nginx/sites-available/example.com.conf:**

```nginx
server {
    listen 80;
    server_name example.com www.example.com;

    root /var/www/example.com;

    location / {
        index index.html;
    }
}

server {
    listen 80;
    server_name blog.example.com;

    root /var/www/blog.example.com;

    location / {
        index index.php;
        try_files $uri $uri/ /index.php?$args;
    }

    # Дополнительные настройки для PHP
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
    }
}
```

**Описание:**

* **Первый блок `server`:** 
    * Прослушивает порт 80.
    * Обрабатывает запросы к доменам **example.com** и **www.example.com**.
    * Указывает корневую директорию сайта как **/var/www/example.com**.
    * Задает **index.html** как файл индекса.
* **Второй блок `server`:**
    * Прослушивает порт 80.
    * Обрабатывает запросы к домену **blog.example.com**.
    * Указывает корневую директорию сайта как **/var/www/blog.example.com**.
    * Задает **index.php** как файл индекса.
    * Настраивает обработку PHP-файлов с помощью **FastCGI**.

### Активация виртуального хоста

Для активации виртуального хоста создайте символическую ссылку на файл конфигурации в директории **sites-enabled**:

```
sudo ln -s /etc/nginx/sites-available/example.com.conf /etc/nginx/sites-enabled/
```

После создания символической ссылки перезапустите Nginx:

```
sudo systemctl restart nginx
```

### Проверка конфигурации

После внесения изменений в конфигурацию Nginx всегда рекомендуется проверять ее на наличие ошибок:

```
sudo nginx -t
```

Если ошибок нет, вы увидите сообщение "**syntax is ok**" и "**test is successful**".

## Заключение

Виртуальные хосты Nginx позволяют размещать несколько сайтов на одном сервере, эффективно используя ресурсы и упрощая администрирование. Гибкость и мощность Nginx делают его идеальным выбором для проектов любой сложности. 
