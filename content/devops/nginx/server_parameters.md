## Конфигурация параметров серверов в Nginx

В этой статье мы подробно рассмотрим настройку блоков `server` в конфигурационном файле Nginx. Блоки `server` являются ключевыми элементами конфигурации, которые определяют, как Nginx будет обрабатывать запросы к различным веб-сайтам или приложениям, размещенным на одном сервере.

### Основная структура блока `server`

Каждый блок `server` начинается с директивы `server` и заканчивается закрывающейся фигурной скобкой `}`. Внутри блока размещаются директивы, управляющие обработкой запросов для данного сервера.

```nginx
server {
    # Директивы для настройки сервера
}
```

### Директивы блока `server`

Рассмотрим основные директивы, которые можно использовать внутри блока `server`:

**1. `listen`**: Указывает IP-адрес и порт, на котором сервер будет прослушивать входящие соединения.

```nginx
listen 80;
listen [::]:80; # Прослушивание IPv6 адреса
```

**2. `server_name`**: Задает доменное имя или имена, которые будут обслуживаться данным блоком `server`. 

```nginx
server_name example.com www.example.com;
```

**3. `root`**: Указывает корневой каталог веб-сайта, где хранятся файлы, к которым будет осуществляться доступ.

```nginx
root /var/www/example.com/html;
```

**4. `index`**: Определяет список файлов, которые Nginx будет пытаться открыть при запросе к директории, если не указано имя файла.

```nginx
index index.html index.htm;
```

**5. `location`**: Позволяет настроить обработку запросов в зависимости от URL-адреса. Директива `location` используется для создания блоков, которые определяют правила обработки запросов, соответствующих заданным шаблонам. Подробнее о блоках `location` мы поговорим в следующей статье.

### Пример простой конфигурации

```nginx
server {
    listen 80;
    server_name example.com www.example.com;
    root /var/www/example.com/html;
    index index.html index.htm;

    location / {
        # Правила обработки запросов к корневому каталогу
    }
}
```

### Виртуальные хосты на основе имен

Nginx позволяет размещать несколько веб-сайтов на одном сервере, используя виртуальные хосты на основе имен. Каждый виртуальный хост имеет свой блок `server` с уникальным значением директивы `server_name`. 

**Пример конфигурации двух виртуальных хостов:**

```nginx
server {
    listen 80;
    server_name example.com www.example.com;
    root /var/www/example.com/html;
    index index.html index.htm;
}

server {
    listen 80;
    server_name test.com www.test.com;
    root /var/www/test.com/html;
    index index.html index.htm;
}
```

### Обработка статических файлов

Nginx эффективно обрабатывает статические файлы, такие как изображения, CSS и JavaScript. Для настройки обработки статических файлов используются следующие директивы:

* **`sendfile on`**: Включает режим отправки файлов ядра, что повышает производительность.
* **`tcp_nopush on`**: Включает отправку данных одним пакетом, что также улучшает производительность.
* **`tcp_nodelay on`**: Отключает алгоритм Нэгла, позволяя отправлять данные немедленно.

**Пример конфигурации:**

```nginx
server {
    # ...

    location /static/ {
        root /var/www/example.com/;
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
    }
}
```

### SSL/TLS шифрование

Для настройки HTTPS-соединений используется директива `ssl` в блоке `listen` и директива `ssl_certificate` для указания пути к сертификату SSL.

**Пример конфигурации:**

```nginx
server {
    listen 443 ssl;
    server_name example.com www.example.com;
    ssl_certificate /etc/ssl/certs/example.com.crt;
    ssl_certificate_key /etc/ssl/private/example.com.key;

    # ...
}
```

### Заключение

В этой статье мы рассмотрели основы конфигурации блоков `server` в Nginx. Вы узнали о ключевых директивах, таких как `listen`, `server_name`, `root` и `index`, а также о том, как настраивать виртуальные хосты и обработку статических файлов.  В следующей статье мы подробнее рассмотрим блоки `location` и их возможности для гибкой настройки обработки запросов в Nginx.
