## Защита системы и управление фаерволом

Важнейшей частью администрирования Linux-системы является обеспечение ее безопасности. Одним из основных инструментов для этого служит фаервол - программный или аппаратный барьер, контролирующий сетевой трафик, поступающий на ваш сервер. 

В этой статье мы рассмотрим основы управления фаерволом в Linux, используя популярный инструмент командной строки - `firewalld`.

### Firewalld: основы

`Firewalld` - это демон, предоставляющий динамически управляемый межсетевой экран с поддержкой сетевых зон. Зоны - это предопределенные наборы правил, определяющие уровень доверия к сетевым соединениям. 

### Управление службой firewalld

Для начала убедитесь, что `firewalld` запущен и работает:

```
sudo systemctl status firewalld
```

Если служба не запущена, выполните следующие команды:

```
sudo systemctl start firewalld
sudo systemctl enable firewalld
```

Эти команды запустят `firewalld` и добавят его в автозагрузку.

### Сетевые зоны

`Firewalld` по умолчанию использует зону `public`.  Список доступных зон можно получить командой:

```
firewall-cmd --get-zones
```

Вы можете узнать текущую активную зону командой:

```
firewall-cmd --get-active-zones
```

Для смены зоны используется команда:

```
sudo firewall-cmd --zone=название_зоны --change-interface=название_интерфейса
```

**Важно!**  Изменение зоны влияет на правила фаервола. Будьте осторожны при смене зоны, убедитесь, что вы понимаете последствия.

### Правила фаервола

#### Постоянные и временные правила

`Firewalld` поддерживает два типа правил: 

* **Постоянные** правила сохраняются после перезагрузки системы. 
* **Временные** правила действуют до перезагрузки. 

#### Добавление и удаление правил

Добавить правило можно командой:

```
sudo firewall-cmd --permanent --zone=название_зоны --add-service=название_сервиса
```

Например, чтобы разрешить SSH-подключения на постоянной основе в зоне `public`:

```
sudo firewall-cmd --permanent --zone=public --add-service=ssh
```

Для удаления правила используйте `--remove-service`:

```
sudo firewall-cmd --permanent --zone=public --remove-service=ssh
```

#### Список правил

Для просмотра списка правил в активной зоне используйте:

```
sudo firewall-cmd --list-all
```

Для просмотра правил в определенной зоне:

```
sudo firewall-cmd --zone=название_зоны --list-all
```

#### Порты и сервисы

`Firewalld` использует понятия "сервис" и "порт". 

* **Сервис** - это именованный набор портов и протоколов, например, `ssh`, `http`, `https`.
* **Порт** -  это числовой идентификатор, используемый для адресации определенного процесса или сервиса.

Для добавления правила для определенного порта используйте `--add-port`:

```
sudo firewall-cmd --permanent --zone=public --add-port=8080/tcp
```

В этом примере мы открываем порт `8080` для протокола `tcp`.

#### Протоколы

`Firewalld` поддерживает различные протоколы, такие как `tcp`, `udp`, `icmp`.  

#### Направления

Правила можно применять к разным направлениям трафика: 

* `incoming` - входящий трафик
* `outgoing` - исходящий трафик

По умолчанию правила применяются к входящему трафику. 

#### Примеры

Разрешить HTTP трафик на порту 80:

```
sudo firewall-cmd --permanent --zone=public --add-service=http 
```

Разрешить доступ к PostgreSQL:

```
sudo firewall-cmd --permanent --zone=public --add-service=postgresql
```

Открыть порт 3000 для приложения Node.js:

```
sudo firewall-cmd --permanent --zone=public --add-port=3000/tcp
```

#### Перезагрузка firewalld

После внесения изменений в конфигурацию `firewalld` необходимо перезагрузить службу:

```
sudo firewall-cmd --reload
```

### Заключение

В этой статье мы рассмотрели основы управления фаерволом `firewalld` в Linux. Правильная настройка фаервола - это важный шаг в обеспечении безопасности вашей системы. 

Помните, что данная статья не является исчерпывающим руководством по `firewalld`. Для получения более подробной информации обратитесь к официальной документации `firewalld`. 
