## Мониторинг и логирование в Docker

Мониторинг и логирование являются неотъемлемыми частями жизненного цикла любого приложения, и Docker-контейнеры не исключение.  Правильная настройка мониторинга и логирования позволяет:

* Отслеживать состояние контейнеров и приложений в реальном времени.
* Выявлять и диагностировать проблемы производительности.
* Анализировать поведение приложения и находить узкие места.
* Собирать информацию о работе приложения для аудита и отладки.

Docker предоставляет несколько инструментов и подходов для мониторинга и логирования контейнеров. В рамках этого раздела мы рассмотрим основные из них.

### Docker stats

Команда `docker stats` позволяет получить базовую информацию о потреблении ресурсов (CPU, память, сеть, дисковое пространство) запущенными контейнерами в режиме реального времени.

**Пример использования:**

```bash
docker stats <CONTAINER_ID>
```

**Описание параметров:**

* `<CONTAINER_ID>`: ID или имя контейнера, для которого нужно вывести статистику.

**Пример вывода:**

```
CONTAINER ID   NAME                CPU % MEM USAGE / LIMIT   MEM %   NET I/O         BLOCK I/O        PIDS
c7f957a7e193   my_container         0.00%   1.255MiB / 1.95GiB   0.08%   4.06kB / 2.54kB   0B / 0B         4
```

### Docker logs

Команда `docker logs` используется для просмотра логов контейнера. По умолчанию выводятся логи стандартного вывода (stdout) и стандартной ошибки (stderr) приложения, запущенного в контейнере.

**Пример использования:**

```bash
docker logs <CONTAINER_ID>
```

**Описание параметров:**

* `<CONTAINER_ID>`: ID или имя контейнера, логи которого нужно просмотреть.

**Дополнительные опции:**

* `-f`, `--follow`: отслеживать лог в реальном времени.
* `-t`, `--timestamps`: показывать временные метки для каждой строки лога.
* `--tail`: указать количество последних строк лога для вывода.

### Логирование на уровне приложения

Наиболее гибким и информативным способом логирования является вывод логов приложения в стандартный вывод (stdout) или стандартную ошибку (stderr). Это позволяет использовать механизмы сбора и обработки логов Docker, а также применять специализированные инструменты для анализа логов.

**Пример конфигурации приложения (Python):**

```python
import logging

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

logger.info('Приложение запущено')
```

### Docker logging drivers

Docker поддерживает различные драйверы логирования, которые позволяют перенаправлять логи контейнеров в централизованные системы сбора и анализа логов.

**Таблица популярных logging drivers:**

| Драйвер     | Описание                                                                                                     |
|------------|------------------------------------------------------------------------------------------------------------------|
| `json-file`| Логи сохраняются в JSON-файлы на хост-машине (используется по умолчанию).                                         |
| `syslog`    | Логи отправляются на syslog-сервер.                                                                                |
| `fluentd`   | Логи отправляются на Fluentd - сборщик данных и логов.                                                          |
| `splunk`    | Логи отправляются в Splunk - платформу для анализа машинных данных.                                              |

**Настройка logging driver для контейнера:**

```bash
docker run -d --log-driver=syslog --log-opt syslog-address=udp://<IP-адрес_syslog-сервера>:514 <IMAGE> <КОМАНДА>
```

**Описание параметров:**

* `--log-driver`: имя драйвера логирования.
* `--log-opt`: опции для драйвера логирования.

### Инструменты мониторинга Docker

Существует множество сторонних инструментов, которые позволяют осуществлять комплексный мониторинг Docker-контейнеров и Docker Swarm кластеров. 

**Примеры популярных инструментов:**

* **cAdvisor:**  предоставляет детальную информацию о потреблении ресурсов контейнерами.
* **Prometheus:**  система мониторинга и оповещения с открытым исходным кодом.
* **Grafana:**  платформа для визуализации данных, интегрируется с Prometheus.
* **Datadog:**  облачная платформа мониторинга, предоставляющая расширенные возможности анализа логов и метрик.

### Заключение

Правильно настроенный мониторинг и логирование Docker-контейнеров являются залогом стабильной и эффективной работы приложений. Docker предоставляет базовые инструменты для этих задач, а также возможность интеграции со сторонними решениями для более сложных сценариев. 
