## Управление множеством контейнеров с Docker Compose

Docker Compose – это инструмент, который упрощает создание и управление приложениями, состоящими из нескольких контейнеров Docker. С его помощью можно определить все сервисы, необходимые для работы приложения, в одном файле YAML, а затем запустить их одной командой.

### Зачем использовать Docker Compose?

Представьте, что ваше приложение состоит из веб-сервера, базы данных и кеша. Запуск каждого из этих компонентов по отдельности может быть утомительным, особенно если нужно передавать переменные окружения или настраивать связи между ними. 

Docker Compose решает эту проблему, позволяя описать все зависимости и конфигурации в одном месте. Это делает развертывание и управление приложением проще и надежнее.

### Установка Docker Compose

Docker Compose поставляется вместе с Docker Desktop для Windows и macOS. Если вы используете Linux, установите его отдельно, следуя инструкциям на официальном сайте Docker: [https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)

### Создание файла docker-compose.yml

Файл `docker-compose.yml` – это основа для работы с Docker Compose. В нем описывается, какие образы Docker использовать, как их настраивать и как они взаимодействуют друг с другом.

**Пример файла `docker-compose.yml`:**

```yaml
version: "3.9"
services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
  db:
    image: mysql:latest
    environment:
      MYSQL_ROOT_PASSWORD: example
    volumes:
      - db_data:/var/lib/mysql
volumes:
  db_data:
```

**Описание структуры файла:**

- **version**: указывает версию синтаксиса Docker Compose.
- **services**: содержит список сервисов, составляющих приложение.
  - **web**: имя сервиса (в данном случае - веб-сервер).
    - **image**: указывает образ Docker, который будет использоваться для запуска контейнера.
    - **ports**: задает проброс портов с хост-машины в контейнер. Формат: `<порт_хоста>:<порт_контейнера>`.
    - **volumes**: монтирует тома (директории) в контейнер.
  - **db**: другой сервис (база данных).
    - **environment**: задает переменные окружения для контейнера.
  - **volumes**: определяет тома, используемые в файле.

### Запуск приложения с помощью Docker Compose

Для запуска приложения, описанного в файле `docker-compose.yml`, выполните следующую команду в терминале, находясь в директории с файлом:

```bash
docker-compose up -d
```

**Опция `-d`** запускает контейнеры в фоновом режиме.

### Управление контейнерами

Docker Compose предоставляет набор команд для управления контейнерами:

| Команда                      | Описание                                 |
|------------------------------|------------------------------------------|
| `docker-compose up`          | Запускает контейнеры.                  |
| `docker-compose down`        | Останавливает и удаляет контейнеры.       |
| `docker-compose ps`         | Показывает список запущенных контейнеров. |
| `docker-compose logs <service>` | Показывает логи указанного сервиса.      |
| `docker-compose restart <service>` | Перезапускает указанный сервис.          |

### Пример использования Docker Compose

Создадим простое приложение, состоящее из веб-сервера Nginx и базы данных MySQL.

1. **Создайте файл `docker-compose.yml`:**

```yaml
version: "3.9"
services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
    depends_on:
      - db
  db:
    image: mysql:latest
    environment:
      MYSQL_ROOT_PASSWORD: example
```

2. **Создайте файл `nginx.conf`:**

```nginx
server {
  listen 80;
  location / {
    return 200 "Hello from Docker Compose!\n";
  }
}
```

3. **Запустите приложение:**

```bash
docker-compose up -d
```

4. **Откройте в браузере адрес `http://localhost`.** Вы увидите сообщение "Hello from Docker Compose!".

### Заключение

Docker Compose значительно упрощает работу с многоконтейнерными приложениями. Он позволяет описывать конфигурацию сервисов в декларативном виде, что делает управление ими более простым и удобным.
