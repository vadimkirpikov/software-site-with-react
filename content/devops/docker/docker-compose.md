## Оркестрация контейнеров с Docker Compose

Разработка современных приложений часто включает в себя работу с множеством сервисов: базы данных, очереди сообщений, веб-серверы и т.д. Запуск и управление каждым сервисом по отдельности может стать настоящей головной болью. Docker Compose приходит на помощь, упрощая работу с multi-контейнерными приложениями.

### Что такое Docker Compose?

Docker Compose - это инструмент, который позволяет определять и запускать multi-контейнерные приложения с помощью декларативного YAML-файла. Вместо того, чтобы запускать каждый контейнер вручную с множеством параметров, вы описываете конфигурацию всего приложения в одном файле `docker-compose.yml`.  Compose автоматизирует запуск, остановку, перезапуск и масштабирование сервисов.

### Установка Docker Compose

Docker Compose входит в состав Docker Desktop для Windows и macOS. Если вы используете Linux, установите его отдельно, следуя инструкциям на официальном сайте Docker: [https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)

### Структура файла docker-compose.yml

Файл `docker-compose.yml` использует синтаксис YAML для определения сервисов, сетей и томов, составляющих ваше приложение. Пример простого файла `docker-compose.yml`:

```yaml
version: "3.9"
services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
  db:
    image: mysql:latest
    environment:
      MYSQL_ROOT_PASSWORD: example
```

Разберем структуру файла:

- `version`: Указывает версию синтаксиса Docker Compose.
- `services`: Определяет сервисы, из которых состоит приложение.
- `web` и `db`: Имена сервисов.
- `image`: Указывает образ Docker, который будет использоваться для создания контейнера.
- `ports`: Пробрасывает порты из контейнера на хост-машину (в данном случае порт 80).
- `environment`: Позволяет задавать переменные окружения для контейнера.

### Базовые команды Docker Compose

- **docker-compose up**: Запускает приложение. Используйте флаг `-d`, чтобы запустить его в фоновом режиме.
- **docker-compose down**: Останавливает и удаляет контейнеры, сети и образы, созданные при помощи `docker-compose up`.
- **docker-compose ps**: Выводит список запущенных контейнеров.
- **docker-compose logs**: Показывает логи контейнеров.
- **docker-compose build**: Собирает или пересобирает образы сервисов.
- **docker-compose restart**: Перезапускает сервисы.
- **docker-compose scale**: Масштабирует сервисы, запуская нужное количество контейнеров. Например, `docker-compose scale web=3` запустит 3 копии сервиса `web`.

### Пример использования Docker Compose

Создадим простое приложение, состоящее из веб-сервера Nginx и базы данных PostgreSQL. 

1. Создайте файл `docker-compose.yml`:

```yaml
version: "3.9"
services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
    depends_on:
      - db
  db:
    image: postgres:latest
    environment:
      POSTGRES_PASSWORD: example
```

В данном примере:

- `web`: Сервис веб-сервера Nginx, который проксирует запросы на порт 80 хост-машины на порт 80 внутри контейнера.
- `db`: Сервис базы данных PostgreSQL с установленным паролем `example`.
- `depends_on`: Указывает, что сервис `web` зависит от сервиса `db`, 
   и будет запущен только после запуска `db`.

2. Запустите приложение:

```
docker-compose up -d
```

3. Откройте браузер и перейдите по адресу `http://localhost`. Вы должны увидеть страницу приветствия Nginx.

### Заключение

Docker Compose значительно упрощает запуск и управление multi-контейнерными приложениями. С его помощью можно определить всю инфраструктуру приложения в одном файле, что делает развертывание и управление более удобным и эффективным. 
