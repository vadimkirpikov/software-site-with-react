## Оркестрация приложений с помощью docker-compose.yml

В процессе разработки мы часто сталкиваемся с необходимостью запускать не одно, а сразу несколько приложений, взаимодействующих между собой. Это может быть база данных, backend-сервис и frontend-приложение, работающие в связке. Запуск и настройка каждого контейнера по отдельности может стать утомительной и подверженной ошибкам задачей. 

Здесь на помощь приходит инструмент **Docker Compose**. Он позволяет описать все необходимые для работы приложения сервисы (контейнеры) в одном файле - `docker-compose.yml`.  Благодаря этому, мы получаем возможность управлять всем приложением как единым целым. 

### Структура файла docker-compose.yml

Файл `docker-compose.yml` написан на языке YAML и имеет следующую структуру:

```yaml
version: "3.9"   # Версия синтаксиса Docker Compose

services:          # Описание сервисов (контейнеров)
  <имя_сервиса_1>:
    <параметры_сервиса>
  <имя_сервиса_2>:
    <параметры_сервиса>

# Дополнительные настройки (сети, volumes)
```

### Основные параметры сервисов

Каждый сервис в файле `docker-compose.yml` описывается с помощью набора параметров. Вот некоторые из наиболее часто используемых:

| Параметр      | Описание                                                                      |
|--------------|------------------------------------------------------------------------------|
| `image`       | Образ Docker, на основе которого будет создан контейнер.                     |
| `build`       | Путь к Dockerfile для сборки образа (альтернатива `image`).               |
| `ports`      | Список портов, которые нужно пробросить из контейнера на хост-машину.         |
| `volumes`     | Список томов для монтирования в контейнер.                                    |
| `environment` | Переменные окружения, доступные внутри контейнера.                           |
| `depends_on`  | Список сервисов, от которых зависит данный сервис (порядок запуска).        |
| `networks`    | Список сетей Docker, к которым подключен сервис.                             |
| `command`     | Команда, которая будет выполнена при запуске контейнера.                   |

### Пример: Запуск простого веб-приложения

Создадим простое веб-приложение, состоящее из веб-сервера Nginx и бэкенда на Python (Flask).

**1. Создание структуры проекта:**

```
project/
├── backend/
│   └── app.py
├── nginx/
│   └── nginx.conf
└── docker-compose.yml
```

**2. Создание Flask-приложения (backend/app.py):**

```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello from Flask!'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

**3. Настройка Nginx (nginx/nginx.conf):**

```nginx
server {
    listen 80;

    location / {
        proxy_pass http://backend:5000;
    }
}
```

**4. Создание файла docker-compose.yml:**

```yaml
version: "3.9"

services:
  backend: # Название сервиса бэкенда
    build: ./backend # Сборка образа из директории ./backend
    ports:
      - "5000:5000" # Проброс порта 5000 из контейнера на хост-машину

  nginx: # Название сервиса Nginx
    build: ./nginx # Сборка образа из директории ./nginx
    ports:
      - "80:80" # Проброс порта 80 из контейнера на хост-машину
    depends_on: # Зависимость от сервиса backend
      - backend 
```

**5. Запуск приложения:**

```bash
docker-compose up -d
```

Эта команда соберёт образы, создаст и запустит контейнеры `backend` и `nginx`.  Nginx будет проксировать запросы на порт 80 к Flask-приложению, работающему на порту 5000. 

### Заключение

Файл `docker-compose.yml` является мощным инструментом для управления многоконтейнерными приложениями. Он упрощает запуск, настройку и управление зависимостями между сервисами.  Более подробную информацию о Docker Compose можно найти в [официальной документации](https://docs.docker.com/compose/).
