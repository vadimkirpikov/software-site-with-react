## Загрузка и сохранение файлов

Загрузка файлов является распространенной задачей в веб-приложениях. ASP.NET Core предоставляет удобные механизмы для обработки загрузки файлов и их сохранения на сервере.

### Настройка приложения

Для начала убедитесь, что ваше приложение настроено на обработку форм, отправляющих файлы. Добавьте следующий атрибут в тег `<form>` в вашем представлении:

```html
<form method="post" enctype="multipart/form-data">
    ...
</form>
```

Атрибут `enctype="multipart/form-data"` указывает браузеру отправлять данные формы, включая файлы, в формате multipart/form-data.

### Модель представления

Создайте модель представления, которая будет использоваться для привязки данных формы, включая загружаемый файл. Например:

```csharp
public class UploadFileModel
{
    [Required(ErrorMessage = "Пожалуйста, выберите файл.")]
    [Display(Name = "Файл")]
    public IFormFile File { get; set; }
}
```

- `IFormFile` представляет загруженный файл.
- Атрибут `[Required]` делает поле обязательным для заполнения.
- Атрибут `[Display]` устанавливает отображаемое имя поля.

### Обработка загрузки файла в контроллере

В методе действия контроллера, обрабатывающем отправку формы, используйте внедрение зависимостей, чтобы получить доступ к экземпляру `IWebHostEnvironment` и получить путь к корневой папке wwwroot:

```csharp
[HttpPost]
public async Task<IActionResult> UploadFile(UploadFileModel model, [FromServices] IWebHostEnvironment env)
{
    if (ModelState.IsValid)
    {
        // Получаем путь к папке wwwroot
        string wwwrootPath = env.WebRootPath;

        // Задаем имя файла
        string fileName = Path.GetFileName(model.File.FileName);

        // Полный путь к файлу для сохранения
        string filePath = Path.Combine(wwwrootPath, "uploads", fileName);

        // Сохраняем файл на диск
        using (var stream = new FileStream(filePath, FileMode.Create))
        {
            await model.File.CopyToAsync(stream);
        }

        // Дополнительная логика обработки после сохранения файла

        return RedirectToAction("Success"); 
    }

    return View(model);
}
```

В этом коде:

- `[FromServices]` используется для внедрения зависимости `IWebHostEnvironment`.
- `env.WebRootPath` возвращает путь к корневой папке wwwroot.
- `Path.Combine` используется для создания полного пути к файлу для сохранения.
- `model.File.CopyToAsync` используется для асинхронного копирования загруженного файла в файловую систему.

### Отображение загруженного файла

Чтобы отобразить загруженный файл пользователю, можно использовать тег `<img>`, если это изображение, или предоставить ссылку для скачивания, если это другой тип файла.

```html
@if (Model != null && Model.File != null)
{
    <img src="~/uploads/@Model.File.FileName" alt="Загруженное изображение" />
    <a href="~/uploads/@Model.File.FileName" download>Скачать файл</a>
}
```

### Безопасность

При работе с загрузкой файлов важно обеспечить безопасность:

- **Валидация файлов:** проверяйте тип, размер и другие атрибуты загружаемого файла, чтобы предотвратить загрузку вредоносных файлов.
- **Имена файлов:** генерируйте уникальные имена файлов на сервере, чтобы избежать конфликтов имен и атак с подменой файлов.
- **Хранилище файлов:** не храните загруженные файлы непосредственно в папке wwwroot. Вместо этого используйте отдельную папку для хранения файлов и настройте веб-сервер для доступа к ней.

### Заключение

В этой статье мы рассмотрели основные шаги по загрузке и сохранению файлов в ASP.NET Core. Важно помнить о безопасности при работе с загрузкой файлов и применять соответствующие меры защиты.
