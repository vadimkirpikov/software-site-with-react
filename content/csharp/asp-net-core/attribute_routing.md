## Атрибуты маршрутизации в ASP.NET Core

Атрибуты маршрутизации в ASP.NET Core предоставляют мощный механизм для определения способов, которыми пользователи (или API клиенты) могут взаимодействовать с вашими контроллерами и их действиями. Вместо того, чтобы указывать все маршруты в одном централизованном месте, вы можете использовать атрибуты непосредственно в коде контроллера, делая код более читаемым и удобным в обслуживании.

### Основы атрибутов маршрутизации

Базовый атрибут маршрутизации — это `[Route]`. Он применяется к контроллеру или методу действия и определяет шаблон URL, который будет использоваться для доступа к ним. 

**Пример:**

```csharp
[Route("api/[controller]")]
public class ProductsController : ControllerBase
{
    [HttpGet("{id}")]
    public IActionResult GetProduct(int id)
    {
        // ... логика получения продукта
    }
}
```

В этом примере:

* `[Route("api/[controller]")]` -  определяет префикс маршрута для всех действий в контроллере `ProductsController`. `[controller]` будет заменен на имя контроллера без суффикса "Controller", то есть "Products".
* `[HttpGet("{id}")]` - указывает, что этот метод действия будет обрабатывать HTTP GET запросы к URL `/api/Products/{id}`, где `{id}` - это переменная, передаваемая в качестве параметра методу `GetProduct`.

### Типы атрибутов маршрутизации

ASP.NET Core предоставляет набор атрибутов маршрутизации для различных HTTP-методов:

| Атрибут | HTTP метод | Описание |
|---|---|---|
| `[HttpGet]` | GET | Обрабатывает запросы на получение данных. |
| `[HttpPost]` | POST | Обрабатывает запросы на создание новых ресурсов. |
| `[HttpPut]` | PUT | Обрабатывает запросы на полное обновление существующего ресурса. |
| `[HttpDelete]` | DELETE | Обрабатывает запросы на удаление ресурса. |
| `[HttpPatch]` | PATCH | Обрабатывает запросы на частичное обновление существующего ресурса. |
| `[HttpHead]` | HEAD | Аналогичен GET, но возвращает только заголовки ответа. |
| `[HttpOptions]` | OPTIONS | Возвращает поддерживаемые HTTP методы для указанного ресурса. |

### Шаблоны маршрутизации

Шаблоны маршрутизации определяют структуру URL и могут содержать литеральные значения и переменные.

**Пример:**

```csharp
[Route("api/orders/{orderId}/items/{itemId}")]
public IActionResult GetOrderItem(int orderId, int itemId)
{
    // ... логика получения элемента заказа
}
```

В этом примере шаблон маршрута содержит две переменные: `{orderId}` и `{itemId}`.

**Типы данных параметров маршрута:**

Вы можете указать тип данных для параметров маршрута, используя ограничения типов:

```csharp
[HttpGet("{id:int}")] // id должен быть целым числом
public IActionResult GetProduct(int id)
{
    // ...
}
```

**Доступные ограничения типов:**

* `int`, `long`, `float`, `double`, `decimal` - числовые типы
* `bool` - логический тип
* `string` - строковый тип
* `guid` - тип GUID
* `datetime` - тип DateTime

### Значения по умолчанию и необязательные параметры

Вы можете определить значения по умолчанию для параметров маршрута, используя синтаксис `[параметр = значение]`:

```csharp
[HttpGet("products/{category?}/{page=1}")]
public IActionResult GetProducts(string? category, int page = 1)
{
    // ...
}
```

В этом примере:

* `category` - необязательный параметр. 
* `page` - необязательный параметр со значением по умолчанию 1.

### Использование нескольких атрибутов `[Route]`

Вы можете применить несколько атрибутов `[Route]` к контроллеру или методу действия, чтобы определить несколько маршрутов для одного и того же действия:

```csharp
[Route("api/products")]
[Route("api/items")]
public class ProductsController : ControllerBase
{
    // ...
}
```

В этом примере контроллер `ProductsController` доступен по двум маршрутам: `/api/products` и `/api/items`.

### Сочетание атрибутов маршрутизации и конвенций маршрутизации

Вы можете комбинировать атрибуты маршрутизации с конвенциями маршрутизации, определенными в `Program.cs`:

```csharp
// Program.cs

builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

var app = builder.Build();

// Конфигурация конвенций маршрутизации
app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Home}/{action=Index}/{id?}");

// ...
```

В этом случае атрибуты маршрутизации будут иметь приоритет над конвенциями маршрутизации.

### Заключение

Атрибуты маршрутизации являются мощным инструментом для определения гибких и удобных в обслуживании маршрутов в приложениях ASP.NET Core. Используя атрибуты маршрутизации, вы можете создавать более чистый и организованный код, улучшая читаемость и снижая вероятность ошибок.
