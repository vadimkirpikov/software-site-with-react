## Основы маршрутизации в ASP.NET Core 8.0

Маршрутизация — это механизм, который позволяет приложению ASP.NET Core принимать входящие HTTP-запросы и направлять их к соответствующим методам действий контроллеров для обработки. Она играет ключевую роль в определении того, как ваше приложение реагирует на различные URL-адреса и какие действия будут выполняться.

### Типы маршрутизации

В ASP.NET Core существует два основных типа маршрутизации:

1. **Маршрутизация на основе соглашений (Conventional Routing):**  Этот тип маршрутизации основан на предопределенных шаблонах URL-адресов. Вы определяете шаблоны маршрутов, которые сопоставляют URL-адреса с действиями контроллера. ASP.NET Core автоматически обрабатывает маршрутизацию на основе этих шаблонов.
2. **Атрибутная маршрутизация (Attribute Routing):**  В этом подходе вы определяете маршруты непосредственно в атрибутах, применяемых к методам действий контроллера. Это обеспечивает более детальный контроль над URL-адресами, связанными с каждым действием.

### Маршрутизация на основе соглашений

Для настройки маршрутизации на основе соглашений используется метод `MapControllerRoute` в методе `Main` класса `Program`.

```csharp
using Microsoft.AspNetCore.Mvc;

var builder = WebApplication.CreateBuilder(args);

// Добавьте службы MVC в контейнер внедрения зависимостей.
builder.Services.AddControllersWithViews();

var app = builder.Build();

// Настройте конвейер запросов HTTP.

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Home/Error");
    // ...
}

app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

// Настройте маршрутизацию на основе соглашений.
app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Home}/{action=Index}/{id?}");

app.Run();
```

В этом примере кода мы определяем маршрут по умолчанию с именем "default". 

* **`{controller=Home}`**: Указывает, что часть URL-адреса перед первым символом `/` будет использоваться для определения контроллера. Значение по умолчанию - "Home".
* **`{action=Index}`**: Указывает, что часть URL-адреса после первого символа `/` будет использоваться для определения действия. Значение по умолчанию - "Index".
* **`{id?}`**: Необязательный параметр маршрута с именем "id". Знак вопроса указывает, что параметр не является обязательным.

### Атрибутная маршрутизация

Атрибутная маршрутизация позволяет определять маршруты непосредственно в атрибутах, применяемых к методам действий. Для использования атрибутной маршрутизации необходимо добавить атрибут `[Route]` перед определением контроллера или действия.

```csharp
using Microsoft.AspNetCore.Mvc;

[Route("api/[controller]")]
public class ProductsController : Controller
{
    [HttpGet("{id}")]
    public IActionResult GetProduct(int id)
    {
        // Логика для получения продукта по идентификатору.
    }

    [HttpPost]
    public IActionResult CreateProduct([FromBody] Product product)
    {
        // Логика для создания нового продукта.
    }
}
```

В этом примере:

* Атрибут `[Route("api/[controller]")]` на уровне контроллера определяет префикс маршрута "api/Products" для всех действий в контроллере `ProductsController`.
* Атрибут `[HttpGet("{id}")]` на методе `GetProduct` указывает, что этот метод будет обрабатывать HTTP-запросы GET по URL-адресу "api/Products/{id}".
* Атрибут `[HttpPost]` на методе `CreateProduct` указывает, что этот метод будет обрабатывать HTTP-запросы POST по URL-адресу "api/Products".

### Параметры маршрута

Параметры маршрута - это переменные, которые извлекаются из URL-адреса и передаются в качестве аргументов методу действия. В примере выше `id` в `[HttpGet("{id}")]` - это параметр маршрута.

### Ограничения маршрута

Ограничения маршрута позволяют указывать ограничения на значения параметров маршрута. Например, вы можете указать, что параметр должен быть целым числом или строкой определенной длины.

```csharp
[HttpGet("{id:int}")] // id должен быть целым числом
public IActionResult GetProduct(int id)
{
    // ...
}
```

### Вывод

Маршрутизация является неотъемлемой частью разработки веб-приложений с использованием ASP.NET Core. Понимание основ маршрутизации, включая типы маршрутизации, параметры маршрута и ограничения маршрута, позволит вам создавать более гибкие и удобные приложения. 
