## Делегаты

Делегаты в C# - это ссылочный тип данных, который хранит ссылки на методы. Проще говоря, делегат - это указатель на метод. Делегаты позволяют писать гибкий и расширяемый код, давая возможность динамически изменять поведение программы во время выполнения.

### Объявление делегата

Объявление делегата напоминает объявление метода, но с ключевым словом `delegate`:

```csharp
public delegate int Calculation(int x, int y);
```

В этом примере мы объявили делегат `Calculation`, который может хранить ссылку на любой метод, принимающий два целочисленных аргумента и возвращающий целочисленное значение.

### Создание экземпляра делегата

Для создания экземпляра делегата необходимо передать ему ссылку на метод с соответствующей сигнатурой:

```csharp
// Объявление методов
public static int Add(int x, int y) => x + y;
public static int Multiply(int x, int y) => x * y;

// Создание экземпляров делегата
Calculation calc1 = Add;
Calculation calc2 = Multiply;
```

Здесь мы создали два экземпляра делегата `Calculation`: `calc1` ссылается на метод `Add`, а `calc2` - на метод `Multiply`.

### Вызов метода через делегат

Вызов метода через делегат осуществляется так же, как и вызов обычного метода:

```csharp
int result1 = calc1(5, 3); // result1 = 8
int result2 = calc2(5, 3); // result2 = 15
```

В этом примере мы вызвали методы `Add` и `Multiply` через делегаты `calc1` и `calc2` соответственно.

### Многоадресные делегаты

Делегаты в C# могут хранить ссылки на несколько методов одновременно. Такие делегаты называются многоадресными. Для добавления метода в многоадресный делегат используется оператор `+=`, а для удаления - оператор `-=`:

```csharp
Calculation calc = Add; // calc ссылается на Add
calc += Multiply; // calc теперь ссылается на Add и Multiply

int result = calc(2, 3); // Вызов Add и Multiply, result = 11 

calc -= Multiply; // Удаление Multiply из списка вызовов
result = calc(2, 3); // Вызов только Add, result = 5
```

В этом примере мы создали многоадресный делегат `calc`, который сначала ссылался на `Add`, затем на `Add` и `Multiply`, а потом снова только на `Add`.

### Анонимные методы

Анонимные методы позволяют определять методы непосредственно в месте их использования. Это удобно, если метод используется только один раз:

```csharp
Calculation calc = delegate(int x, int y)
{
    return x * y + 2;
};

int result = calc(3, 4); // result = 14
```

В этом примере мы создали анонимный метод, который принимает два целых числа и возвращает их произведение, увеличенное на 2.

### Лямбда-выражения

Лямбда-выражения - это краткая форма записи анонимных методов, введенная в C# 3.0:

```csharp
Calculation calc = (x, y) => x * y + 2;

int result = calc(3, 4); // result = 14
```

В этом примере мы создали лямбда-выражение, эквивалентное анонимному методу из предыдущего примера.

### Применение делегатов

Делегаты широко используются в C# для реализации различных шаблонов проектирования, обработки событий, асинхронного программирования и многого другого. Вот некоторые примеры:

* **Обработка событий:** Делегаты используются для определения обработчиков событий, которые вызываются при наступлении определенных событий, например, нажатия кнопки или получения данных из сети.
* **Асинхронное программирование:** Делегаты используются для запуска асинхронных операций и обработки их результатов.
* **Шаблоны проектирования:** Делегаты используются в таких шаблонах проектирования, как Стратегия, Наблюдатель и Команда.

### Заключение

Делегаты - это мощный инструмент в C#, который позволяет писать гибкий, расширяемый и многократно используемый код. Понимание того, как работают делегаты, является важным шагом на пути к освоению языка C#.
