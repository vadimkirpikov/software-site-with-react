## Параллельное программирование: Parallel и PLINQ

Современные компьютеры оснащены многоядерными процессорами, что открывает возможности для значительного ускорения выполнения программ за счет параллельной обработки данных. В C# существуют мощные инструменты для реализации параллелизма, среди которых выделяются классы `Parallel` и PLINQ.

### Класс Parallel

Класс `Parallel` предоставляет статические методы для упрощения выполнения циклов и блоков кода параллельно. 

#### Метод Parallel.For()

Метод `Parallel.For()` является аналогом цикла `for`, но выполняет итерации параллельно.

**Синтаксис:**

```csharp
Parallel.For(int fromInclusive, int toExclusive, Action<int> body);
```

* `fromInclusive`: Начальное значение счетчика (включительно).
* `toExclusive`: Конечное значение счетчика (не включительно).
* `body`: Делегат, выполняемый для каждой итерации.

**Пример:**

```csharp
// Вычисление квадратов чисел от 1 до 10
Parallel.For(1, 11, i =>
{
    Console.WriteLine($"Квадрат {i} равен {i * i}");
});
```

#### Метод Parallel.ForEach()

Метод `Parallel.ForEach()` выполняет итерации параллельно для каждого элемента коллекции.

**Синтаксис:**

```csharp
Parallel.ForEach<TSource>(IEnumerable<TSource> source, Action<TSource> body);
```

* `source`: Коллекция для перебора.
* `body`: Делегат, выполняемый для каждого элемента коллекции.

**Пример:**

```csharp
string[] words = { "apple", "banana", "cherry", "date" };

Parallel.ForEach(words, word =>
{
    Console.WriteLine($"{word} имеет длину {word.Length}");
});
```

#### Метод Parallel.Invoke()

Метод `Parallel.Invoke()` выполняет набор действий параллельно.

**Синтаксис:**

```csharp
Parallel.Invoke(Action[] actions);
```

* `actions`: Массив действий для выполнения.

**Пример:**

```csharp
Parallel.Invoke(
    () => Console.WriteLine("Задача 1"),
    () => Console.WriteLine("Задача 2"),
    () => Console.WriteLine("Задача 3")
);
```

### PLINQ

PLINQ (Parallel LINQ) представляет собой расширение LINQ, позволяющее выполнять запросы к данным параллельно.

#### Метод AsParallel()

Для использования PLINQ необходимо преобразовать объект `IEnumerable<T>` в `ParallelQuery<T>` с помощью метода `AsParallel()`.

**Пример:**

```csharp
int[] numbers = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };

// Вычисление суммы четных чисел с использованием PLINQ
int sum = numbers.AsParallel().Where(n => n % 2 == 0).Sum();

Console.WriteLine($"Сумма четных чисел: {sum}");
```

#### Методы ForAll() и WithDegreeOfParallelism()

PLINQ предоставляет дополнительные методы для управления параллелизмом. Метод `ForAll()` выполняет действие для каждого элемента запроса параллельно. 

**Пример:**

```csharp
List<string> fruits = new List<string> { "apple", "banana", "orange", "grape" };

fruits.AsParallel().ForAll(fruit =>
{
    Console.WriteLine($"Фрукт: {fruit}");
});
```

Метод `WithDegreeOfParallelism()` позволяет ограничить максимальное количество ядер процессора, используемых для выполнения запроса.

**Пример:**

```csharp
int[] data = Enumerable.Range(1, 1000).ToArray();

data.AsParallel().WithDegreeOfParallelism(2).ForAll(i =>
{
    // Выполнение операций над данными
});
```

Важно помнить, что некорректное использование параллельного программирования может привести к ошибкам, связанным с состоянием гонки. Необходимо грамотно проектировать алгоритмы и использовать синхронизацию доступа к общим ресурсам при необходимости. 

Это лишь введение в мир параллельного программирования с использованием `Parallel` и PLINQ в C#. Более глубокое изучение темы позволит вам создавать высокопроизводительные приложения, эффективно использующие ресурсы современных многоядерных систем.
