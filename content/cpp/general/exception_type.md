## Обработка исключений: Тип exception

В C++ исключения являются механизмом обработки ошибок, отличным от традиционного подхода с кодами возврата. Вместо того, чтобы возвращать специальное значение, сигнализирующее об ошибке, функция может "выбросить" исключение, которое представляет собой объект определенного типа. Этот объект содержит информацию об ошибке и может быть "пойман" в другом месте программы, где будет выполнена соответствующая обработка.

Тип `exception` является базовым классом для всех исключений, определенных в стандартной библиотеке C++. Он предоставляет виртуальную функцию `what()`, которая возвращает строку с описанием ошибки. 

### Создание собственных типов исключений

Хотя `exception` и может использоваться напрямую, обычно создают собственные типы исключений, наследуя от него или от других классов исключений. Это позволяет создавать иерархию исключений, специфичных для вашего приложения, и обрабатывать их более детально.

**Пример:**

```c++
#include <iostream>
#include <exception>

class MyException : public std::exception {
public:
  // Конструктор с сообщением об ошибке
  MyException(const std::string& message) : message_(message) {}

  // Переопределение виртуальной функции what()
  const char* what() const noexcept override {
    return message_.c_str();
  }

private:
  std::string message_;
};

int main() {
  try {
    // Код, который может выбросить исключение
    throw MyException("Произошла ошибка!");
  } catch (const MyException& e) {
    // Обработка исключения типа MyException
    std::cerr << "Ошибка: " << e.what() << std::endl;
  } catch (const std::exception& e) {
    // Обработка других исключений стандартной библиотеки
    std::cerr << "Ошибка: " << e.what() << std::endl;
  } 

  return 0;
}
```

В этом примере:

1.  Определен класс `MyException`, наследующий от `std::exception`.
2.  Переопределена виртуальная функция `what()`, возвращающая сообщение об ошибке.
3.  В блоке `try` выбрасывается исключение типа `MyException`.
4.  В блоке `catch` происходит обработка исключения: выводится сообщение об ошибке.

### Иерархия исключений

Создание иерархии исключений позволяет обрабатывать разные типы ошибок специфично. Например:

```c++
#include <iostream>
#include <exception>

// Базовый класс для исключений файловой системы
class FileSystemError : public std::exception {
public:
  FileSystemError(const std::string& message) : message_(message) {}
  const char* what() const noexcept override { return message_.c_str(); }
private:
  std::string message_;
};

// Исключение для ошибки открытия файла
class FileOpenError : public FileSystemError {
public:
  FileOpenError(const std::string& filename) : 
    FileSystemError("Не удалось открыть файл: " + filename) {}
};

// Исключение для ошибки чтения файла
class FileReadError : public FileSystemError {
public:
  FileReadError(const std::string& filename) : 
    FileSystemError("Ошибка чтения файла: " + filename) {}
};

int main() {
  try {
    // Код, работающий с файлами
    throw FileReadError("data.txt"); 
  } catch (const FileOpenError& e) {
    // Обработка ошибки открытия файла
    std::cerr << "Ошибка открытия файла: " << e.what() << std::endl;
  } catch (const FileReadError& e) {
    // Обработка ошибки чтения файла
    std::cerr << "Ошибка чтения файла: " << e.what() << std::endl;
  } catch (const FileSystemError& e) {
    // Обработка других ошибок файловой системы
    std::cerr << "Ошибка файловой системы: " << e.what() << std::endl;
  }

  return 0;
}
```

В этом примере:

1.  Определены классы исключений `FileSystemError`, `FileOpenError` и `FileReadError`, образующие иерархию.
2.  В зависимости от типа ошибки, выбрасывается соответствующее исключение.
3.  Блоки `catch` перехватывают исключения, начиная с самых специфичных.

### Рекомендации

*   Всегда обрабатывайте исключения, чтобы предотвратить аварийное завершение программы.
*   Создавайте собственные типы исключений для специфичных ошибок приложения.
*   Используйте иерархию исключений для организации обработки ошибок.
*   Предоставляйте информативные сообщения об ошибках через функцию `what()`.

Обработка исключений - важный аспект программирования на C++. Правильное использование механизма исключений делает код более надежным, понятным и легким в поддержке.
