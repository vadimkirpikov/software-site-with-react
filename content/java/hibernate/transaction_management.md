<h2>Управление транзакциями в Hibernate 6</h2>

Транзакции являются неотъемлемой частью работы с базами данных, обеспечивая целостность и согласованность данных. Hibernate, как ORM-фреймворк, предоставляет мощные и гибкие механизмы управления транзакциями.

<h3>Основы транзакций</h3>

Транзакция представляет собой логическую единицу работы с базой данных, состоящую из одного или нескольких операций. Она гарантирует, что все операции внутри транзакции будут выполнены успешно, либо ни одна из них не будет применена к базе данных.

Основные свойства транзакций (ACID):

* **Атомарность (Atomicity):** Транзакция представляет собой неделимую единицу работы. Либо все операции выполняются успешно, либо ни одна.
* **Согласованность (Consistency):** Транзакция переводит базу данных из одного согласованного состояния в другое, соблюдая все ограничения целостности.
* **Изолированность (Isolation):** Транзакции выполняются изолированно друг от друга. Изменения, внесенные в рамках одной транзакции, не видны другим транзакциям до тех пор, пока первая транзакция не будет зафиксирована.
* **Долговечность (Durability):** После успешного завершения транзакции изменения, внесенные в базу данных, сохраняются постоянно, даже в случае сбоев системы.

<h3>Управление транзакциями в Hibernate</h3>

Hibernate предоставляет два основных подхода к управлению транзакциями:

* **Управление транзакциями с помощью API Hibernate:** Этот подход предполагает использование `Session` и `Transaction` API Hibernate для явного управления транзакциями.
* **Управление транзакциями с помощью JTA (Java Transaction API):** Этот подход использует JTA для управления транзакциями, что особенно полезно в приложениях, использующих несколько ресурсов данных, таких как несколько баз данных или очереди сообщений.

<h4>Управление транзакциями с помощью API Hibernate</h4>

Для управления транзакциями с помощью API Hibernate необходимо выполнить следующие шаги:

1. **Получить `Session` из `SessionFactory`.** 
2. **Начать транзакцию с помощью `session.beginTransaction()`.**
3. **Выполнить операции с базой данных.**
4. **Зафиксировать транзакцию с помощью `transaction.commit()`.**
5. **Обработать исключения и откатить транзакцию с помощью `transaction.rollback()`, если необходимо.**
6. **Закрыть `Session`.**

**Пример кода:**

```java
// Получаем SessionFactory
SessionFactory sessionFactory = HibernateUtil.getSessionFactory();

// Открываем сессию
Session session = sessionFactory.openSession();

// Начинаем транзакцию
Transaction transaction = session.beginTransaction();

try {
    // Выполняем операции с базой данных
    Employee employee = new Employee("John Doe");
    session.persist(employee);

    // Фиксируем транзакцию
    transaction.commit();
} catch (Exception e) {
    // Откатываем транзакцию в случае ошибки
    if (transaction != null) {
        transaction.rollback();
    }
    e.printStackTrace();
} finally {
    // Закрываем сессию
    session.close();
}
```

**Пояснения к коду:**

1. Мы получаем `SessionFactory`, который используется для создания `Session`.
2. Открываем новую `Session`.
3. Начинаем новую транзакцию с помощью `session.beginTransaction()`.
4. В блоке `try` выполняем операции с базой данных:
   - Создаем новый объект `Employee`.
   - Сохраняем объект `Employee` в базе данных с помощью `session.persist(employee)`.
5. Фиксируем транзакцию с помощью `transaction.commit()`. 
6. В блоке `catch` обрабатываем возможные исключения:
   - Если транзакция активна (`transaction != null`), откатываем ее с помощью `transaction.rollback()`.
   - Выводим информацию об ошибке в консоль.
7. В блоке `finally` закрываем `Session` для освобождения ресурсов. 

Этот пример демонстрирует базовый шаблон управления транзакциями в Hibernate. 

В дальнейшем мы рассмотрим более сложные сценарии управления транзакциями, включая:

* **Распространение транзакций:** Как управлять транзакциями в методах, вызывающих друг друга.
* **Режимы изоляции транзакций:** Как настроить уровень изоляции транзакций для управления конкурентным доступом к данным.

Понимание принципов управления транзакциями является важной частью работы с Hibernate и позволяет создавать надежные и эффективные приложения.
