## Работа с сессиями и транзакциями в Hibernate 6

**Сессия** - это основной интерфейс в Hibernate, предоставляющий методы для взаимодействия с базой данных. Она выступает в роли буфера, где хранятся объекты-сущности, извлечённые из базы данных или подготовленные для сохранения. 

**Транзакция** представляет собой единицу работы с базой данных, которая обеспечивает целостность данных. Все операции, выполненные в рамках транзакции, будут либо успешно применены к базе данных, либо все изменения будут отменены.

### Создание сессии и начало транзакции

Для работы с базой данных необходимо создать сессию и начать транзакцию:

```java
// Получаем фабрику сессий
SessionFactory sessionFactory = HibernateUtil.getSessionFactory();

// Открываем сессию
Session session = sessionFactory.openSession();

// Начинаем транзакцию
Transaction transaction = session.beginTransaction();
```

В данном примере `HibernateUtil` – это класс, отвечающий за конфигурацию и получение `SessionFactory`. 

### Выполнение операций с базой данных

После начала транзакции можно выполнять операции с базой данных, например:

```java
// Создаем объект-сущность
Product product = new Product("Phone", 1000);

// Сохраняем объект в базе данных
session.persist(product);

// Изменяем значение свойства объекта
product.setPrice(1200);

// Удаляем объект из базы данных
session.remove(product);
```

### Завершение транзакции

После выполнения всех необходимых операций необходимо завершить транзакцию, зафиксировав или отменив изменения:

```java
// Фиксируем изменения в базе данных
transaction.commit();

// Отменяем изменения (если возникли ошибки)
// transaction.rollback();

// Закрываем сессию
session.close();
```

**Важно:** 

* Всегда закрывайте сессии после использования, чтобы освободить ресурсы.
* Обрабатывайте исключения, возникающие во время работы с базой данных.
* Используйте `transaction.rollback()` для отмены изменений в случае возникновения ошибок.

### Пример использования сессий и транзакций

Рассмотрим пример создания, изменения и удаления объекта "Товар" (`Product`) с использованием сессий и транзакций:

```java
public class ProductManager {

    public static void main(String[] args) {
        // Получаем фабрику сессий
        SessionFactory sessionFactory = HibernateUtil.getSessionFactory();

        // Открываем сессию
        Session session = sessionFactory.openSession();

        try {
            // Начинаем транзакцию
            Transaction transaction = session.beginTransaction();

            // Создаем объект-сущность
            Product product = new Product("Laptop", 2000);

            // Сохраняем объект в базе данных
            session.persist(product);
            System.out.println("Товар сохранен с ID: " + product.getId());

            // Изменяем значение свойства объекта
            product.setPrice(2500);
            System.out.println("Цена товара изменена.");

            // Удаляем объект из базы данных
            session.remove(product);
            System.out.println("Товар удален.");

            // Фиксируем изменения в базе данных
            transaction.commit();

        } catch (Exception e) {
            // Отменяем изменения в случае ошибки
            if (session.getTransaction() != null) {
                session.getTransaction().rollback();
            }
            e.printStackTrace();
        } finally {
            // Закрываем сессию
            session.close();
        }
    }
}
```

**Важно:** Данный пример является иллюстративным и не отображает всех возможностей работы с сессиями и транзакциями в Hibernate.

В дальнейшем мы подробнее рассмотрим различные методы работы с сессиями, управление транзакциями, уровни изоляции транзакций и другие аспекты взаимодействия с базой данных с помощью Hibernate.
