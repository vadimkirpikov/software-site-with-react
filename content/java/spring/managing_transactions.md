<h2>Управление транзакциями с помощью аннотаций</h2>

Spring Framework предоставляет мощный механизм управления транзакциями, который можно легко интегрировать в приложения, используя аннотации. Этот подход, основанный на аннотациях, упрощает конфигурацию транзакций и делает код более читаемым и поддерживаемым.

<h3>Основы аннотации `@Transactional`</h3>

Аннотация `@Transactional` является ключевым элементом управления транзакциями на основе аннотаций. Её можно применять к классам и методам, чтобы определить границы транзакций. 

**Применение к классам:** Когда `@Transactional` применяется к классу, все методы этого класса будут выполняться в рамках транзакции.

**Применение к методам:** При применении к методу, аннотация определяет транзакционное поведение только для этого конкретного метода.

**Пример:**

```java
@Service
@Transactional
public class UserService {

    @Autowired
    private UserRepository userRepository;

    public void saveUser(User user) {
        userRepository.save(user);
        // Логика сохранения дополнительных данных пользователя
    }
}
```

В этом примере аннотация `@Transactional`, примененная к классу `UserService`, указывает, что все методы этого класса, включая `saveUser`, выполняются в рамках транзакции.

<h3>Атрибуты аннотации `@Transactional`</h3>

Аннотация `@Transactional` предоставляет ряд атрибутов для настройки поведения транзакций.

| Атрибут | Описание |
|---|---|
| `propagation` | Определяет стратегию распространения транзакций. |
| `isolation` | Устанавливает уровень изоляции транзакций. |
| `readOnly` | Указывает, является ли транзакция только для чтения. |
| `timeout` | Задает время ожидания транзакции в секундах. |
| `rollbackFor` | Определяет исключения, которые вызывают откат транзакции. |
| `noRollbackFor` | Указывает исключения, которые не должны вызывать откат транзакции. |

<h4>Стратегия распространения транзакций (`propagation`)</h4>

Атрибут `propagation` определяет, как транзакция взаимодействует с существующими транзакциями.

| Значение | Описание |
|---|---|
| `REQUIRED` | Если вызывающий код выполняется в рамках транзакции, то используется эта же транзакция. В противном случае создается новая транзакция. (по умолчанию) |
| `SUPPORTS` | Используется существующая транзакция, если она есть. В противном случае выполняется без транзакции. |
| `MANDATORY` | Вызывающий код должен быть выполнен в рамках транзакции, иначе будет выброшено исключение. |
| `REQUIRES_NEW` | Всегда создается новая транзакция, независимо от того, существует ли уже транзакция в вызывающем коде. |
| `NOT_SUPPORTED` | Выполняется вне транзакции. Если вызывающий код выполняется в транзакции, то текущая транзакция приостанавливается. |
| `NEVER` | Выполняется без транзакции. Если вызывающий код выполняется в транзакции, то будет выброшено исключение. |
| `NESTED` | Если вызывающий код выполняется в рамках транзакции, то создается вложенная транзакция. В противном случае работает как `REQUIRED`. |

<h4>Уровень изоляции транзакций (`isolation`)</h4>

Уровень изоляции транзакций определяет степень, в которой транзакции изолированы друг от друга.

| Значение | Описание |
|---|---|
| `DEFAULT` | Используется уровень изоляции по умолчанию, заданный СУБД. |
| `READ_UNCOMMITTED` | Позволяет транзакции читать неподтвержденные изменения, сделанные другими транзакциями. |
| `READ_COMMITTED` | Транзакция видит только подтвержденные изменения, сделанные другими транзакциями. |
| `REPEATABLE_READ` | Гарантирует, что при повторном чтении одних и тех же данных в рамках одной транзакции будут получены одни и те же значения. |
| `SERIALIZABLE` | Обеспечивает полную изоляцию транзакций, но может приводить к снижению производительности. |

<h3>Обработка исключений</h3>

Атрибуты `rollbackFor` и `noRollbackFor` позволяют точно контролировать, какие исключения должны вызывать откат транзакции.

**Пример:**

```java
@Service
@Transactional
public class OrderService {

    @Autowired
    private OrderRepository orderRepository;

    @Transactional(rollbackFor = InsufficientFundsException.class)
    public void createOrder(Order order) throws InsufficientFundsException {
        // Логика создания заказа
        // ...
        if (notEnoughFunds()) {
            throw new InsufficientFundsException("Недостаточно средств на счете");
        }
        // ...
    }
}
```

В этом примере откат транзакции будет выполнен только в том случае, если будет выброшено исключение `InsufficientFundsException`.

<h3>Включение поддержки аннотаций `@Transactional`</h3>

Чтобы использовать аннотации `@Transactional`, необходимо включить поддержку транзакций в конфигурации Spring. 

**Включение с помощью Java-конфигурации:**

```java
@Configuration
@EnableTransactionManagement
public class AppConfig {
    // ... конфигурация источника данных и менеджера транзакций
}
```

**Включение с помощью XML-конфигурации:**

```xml
<beans ...>
    <tx:annotation-driven/>
    <!-- ... конфигурация источника данных и менеджера транзакций -->
</beans>
```

<h3>Заключение</h3>

Использование аннотаций `@Transactional` значительно упрощает управление транзакциями в приложениях Spring. Гибкие возможности настройки позволяют точно контролировать поведение транзакций и обеспечивают надежность и целостность данных. 
