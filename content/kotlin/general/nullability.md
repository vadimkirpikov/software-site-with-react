## Null-безопасность и Nullable-типы

Kotlin, в отличие от многих других языков программирования, изначально стремится к безопасности работы с нулевыми значениями (null safety). Это означает, что компилятор Kotlin помогает предотвратить ошибки `NullPointerException`, которые часто возникают в других языках, таких как Java.

### Проблема NullPointerException

`NullPointerException` (NPE) — это исключение, которое возникает, когда программа пытается получить доступ к свойству или вызвать метод объекта, значение которого равно `null`. 

Рассмотрим пример на Java:

```java
String name = null;
int length = name.length(); // Выбросит NullPointerException
```

В этом коде переменная `name` инициализирована значением `null`.  При попытке получить доступ к свойству `length`, возникает `NullPointerException`, так как  у `null` нет такого свойства.

### Решение Kotlin: Nullable-типы

Kotlin решает эту проблему, вводя понятие nullable-типов. В Kotlin переменная не может хранить `null`, если её тип явно не допускает это.

#### Объявление Nullable-типов

Для объявления переменной, которая может хранить `null`, используется символ `?` после типа:

```kotlin
val name: String? = null // Переменная name может хранить String или null
```

Если попытаться вызвать метод или обратиться к свойству переменной nullable-типа без проверки на `null`, компилятор Kotlin выдаст ошибку:

```kotlin
val name: String? = null
val length = name.length // Ошибка компиляции!
```

#### Безопасный доступ к Nullable-типам

Kotlin предоставляет несколько способов безопасного доступа к значениям nullable-типов.

**1. Проверка на null:**

```kotlin
val name: String? = "John"
if (name != null) {
    val length = name.length // name точно не null внутри блока if
    println("Длина имени: $length")
}
```

**2. Оператор безопасного вызова `?.`:**

Оператор `?.` позволяет безопасно вызвать метод или обратиться к свойству, только если значение не равно `null`. Если значение равно `null`, то выражение вернёт `null`:

```kotlin
val name: String? = "John"
val length = name?.length // length будет равно 4
```

**3. Оператор Элвиса `?:`:**

Оператор Элвиса `?:` используется для предоставления значения по умолчанию, если значение слева от него равно `null`:

```kotlin
val name: String? = null
val greeting = "Привет, " + (name ?: "незнакомец") // greeting будет равно "Привет, незнакомец"
```

**4. Оператор не-null утверждения `!!`:**

Оператор `!!` преобразует nullable-тип в не-nullable, но выбрасывает `NullPointerException`, если значение равно `null`:

```kotlin
val name: String? = null
val length = name!!.length // Выбросит NullPointerException
```

**Важно:** Использование `!!` не рекомендуется, так как это может привести к ошибкам во время выполнения. 

### Пример использования Nullable-типов

```kotlin
fun main() {
    val user: User? = getUser()

    // Безопасный доступ к свойствам с помощью ?.
    val name = user?.name 
    val age = user?.age

    // Использование оператора Элвиса
    val greeting = "Привет, " + (name ?: "незнакомец")

    println(greeting)

    // Проверка на null перед доступом к свойствам
    if (user != null) {
        println("Имя пользователя: ${user.name}")
        println("Возраст пользователя: ${user.age}")
    }
}

data class User(val name: String, val age: Int)

fun getUser(): User? {
    // Логика получения пользователя, может вернуть null
    return null 
}
```

В этом примере:
 - `getUser()` - функция, которая может вернуть объект `User` или `null`.
 - `user?.name` и `user?.age` - безопасный доступ к свойствам объекта `User`.
 - `name ?: "незнакомец"` - использование оператора Элвиса для установки значения по умолчанию.
 - `if (user != null)` - проверка на null перед доступом к свойствам объекта `User`.

Использование nullable-типов и операторов Kotlin для работы с ними помогает писать более безопасный и надёжный код, избегая `NullPointerException`. 
