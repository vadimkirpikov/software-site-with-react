## Реальные кейсы использования Neo4j

Neo4j - это графовая база данных, которая позволяет моделировать и хранить информацию, представляющую собой сложные связи между объектами. В отличие от традиционных реляционных баз данных, Neo4j подходит для работы с данными, где важны не только сами данные, но и отношения между ними.  В этой статье мы рассмотрим несколько реальных кейсов применения Neo4j, демонстрирующих широкие возможности этого инструмента. 

### 1. Рекомендательные системы

Рекомендательные системы – это системы, которые предоставляют пользователям персонализированные рекомендации, основываясь на их предыдущих действиях, интересах и предпочтениях. Neo4j идеально подходит для создания рекомендательных систем, так как графовая модель позволяет строить и анализировать сложные связи между пользователями, товарами и другими сущностями.

**Пример:**

Представим интернет-магазин, который продает книги.  Neo4j можно использовать для создания рекомендательной системы, которая предлагает пользователям книги, похожие на те, которые они уже читали, или книги, которые читают пользователи со схожими предпочтениями.

**Реализация:**

* **Модель:** 
    * Вершины: Пользователи (User), Книги (Book), Авторы (Author), Жанры (Genre).
    * Ребра:
        * `ЧИТАЕТ` (READS): соединяет пользователей и книги.
        * `АВТОР` (AUTHOR): соединяет книги и авторов.
        * `ЖАНР` (GENRE): соединяет книги и жанры.
        * `ПОХОЖИЕ_КНИГИ` (SIMILAR_BOOKS): соединяет книги с похожим содержанием.
* **Запрос:** 
    ```cypher
    MATCH (u:User {id: 1234})
    MATCH (b:Book)<-[:READS]-(u)
    MATCH (a:Author)-[:AUTHOR]->(b)
    MATCH (b2:Book)-[:AUTHOR]->(a)
    WITH b2, COLLECT(DISTINCT b2.title) AS similar_books
    WHERE b2 <> b
    RETURN b2.title, similar_books
    LIMIT 5;
    ```
    **Комментарии:** 
    * Запрос находит всех пользователей с id 1234. 
    * Далее запрос ищет все книги, которые читает пользователь.
    * Затем запрос находит всех авторов этих книг.
    * Далее, запрос находит все книги, написанные этими авторами.
    * Из результата исключаются книги, которые уже читались пользователем.
    * В качестве результата возвращаются 5 наиболее популярных книг, написанных теми же авторами, что и те, которые уже читались пользователем.

### 2. Анализ социальных сетей

Neo4j позволяет эффективно анализировать социальные сети, моделируя связи между пользователями, группами, сообществами и контентом. Это позволяет выявлять влиятельных пользователей,  популярные темы,  тенденции  и  другие  важные  параметры  социального  взаимодействия.

**Пример:**

Представим  социальную  сеть,  где  пользователи  могут  создавать  профили,  добавлять  друзей,  публиковать  посты,  ставить  лайки  и  комментировать  контент.

**Реализация:**

* **Модель:**
    * Вершины:  Пользователи (User),  Посты (Post).
    * Ребра:
        * `ДРУЗЬЯ` (FRIENDS): соединяет пользователей,  указывающих на дружеские отношения.
        * `ЛАЙК` (LIKE): соединяет пользователей и посты,  указывающие на лайки.
        * `КОММЕНТАРИЙ` (COMMENT): соединяет пользователей и посты,  указывающие на  оставленный комментарий.
* **Запрос:** 
    ```cypher
    MATCH (u1:User {name: 'Alice'})-[:FRIENDS]->(u2:User)-[:FRIENDS]->(u3:User)
    WHERE u1 <> u3
    RETURN u1.name, u3.name
    LIMIT 10;
    ```
    **Комментарии:** 
    * Запрос находит всех пользователей, которые являются друзьями Alice (u1).
    * Далее, запрос ищет всех пользователей, которые являются друзьями друзей Alice (u2), но не являются самой Alice (u1).
    * В качестве результата возвращаются имена пользователей, которые находятся на расстоянии 2 от Alice в графе дружбы.

### 3. Фрод-мониторинг

Neo4j позволяет эффективно отслеживать подозрительную активность в различных системах, например, в онлайн-банкинге или системах электронной коммерции.  Графовая модель позволяет выявлять  необычные  паттерны  поведения  пользователей,  которые  могут  указывать  на  мошенничество.

**Пример:**

Представим онлайн-магазин, где покупатели совершают покупки с использованием кредитных карт. Neo4j можно использовать для выявления подозрительных транзакций, которые могут быть связаны с мошенничеством.

**Реализация:**

* **Модель:**
    * Вершины: Пользователи (User),  Транзакции (Transaction).
    * Ребра:
        * `СОВЕРШИЛ` (MADE): соединяет пользователей и транзакции,  указывающие  на  то,  что  пользователь  совершил  транзакцию.
        * `СХОДНАЯ_ИНФОРМАЦИЯ` (SIMILAR_INFO): соединяет пользователей,  указывающие  на  схожесть  информации  о  пользователях.
        * `СХОДНАЯ_АКТИВНОСТЬ` (SIMILAR_ACTIVITY): соединяет пользователей,  указывающие  на  схожую  активность  пользователей. 
* **Запрос:** 
    ```cypher
    MATCH (u1:User)-[:MADE]->(t1:Transaction)
    MATCH (u2:User)-[:MADE]->(t2:Transaction)
    WHERE t1.amount > 1000 AND t2.amount > 1000
    AND t1.date BETWEEN date('2023-01-01') AND date('2023-01-07')
    AND t2.date BETWEEN date('2023-01-01') AND date('2023-01-07')
    AND t1.city <> t2.city
    AND u1 <> u2
    RETURN u1.name, u2.name, t1.amount, t2.amount, t1.date, t2.date, t1.city, t2.city
    LIMIT 10;
    ```
    **Комментарии:** 
    * Запрос находит всех пользователей, совершивших транзакции с суммой более 1000 долларов в период с 1 по 7 января 2023 года.
    * Далее, запрос ищет всех пользователей, совершивших транзакции с суммой более 1000 долларов в период с 1 по 7 января 2023 года в разных городах.
    * В качестве результата возвращаются имена пользователей, сумма транзакций, дата и город совершения транзакции.

### 4.  Управление знаниями

Neo4j позволяет моделировать знания,  хранить и  извлекать  информацию из  сложных  и  многосвязных  доменов. 

**Пример:**

Представим  медицинскую  организацию,  которая  использует  Neo4j  для  хранения  информации  о  болезнях,  симптомах,  лекарствах,  докторе и пациентах.

**Реализация:**

* **Модель:**
    * Вершины:  Болезни (Disease),  Симптомы (Symptom),  Лекарства (Medicine),  Доктора (Doctor), Пациенты (Patient).
    * Ребра:
        * `ИМЕЕТ_СИМПТОМ` (HAS_SYMPTOM): соединяет болезни и симптомы.
        * `ЛЕЧИТ` (TREATS): соединяет лекарства и болезни.
        * `ЛЕЧИТСЯ` (TREATED): соединяет пациентов и болезни.
        * `ДИАГНОСТИРОВАЛ` (DIAGNOSED): соединяет докторов и пациентов.
* **Запрос:** 
    ```cypher
    MATCH (p:Patient {name: 'John Doe'})<-[:DIAGNOSED]-(d:Doctor)
    MATCH (d)-[:DIAGNOSED]->(p2:Patient)
    WHERE p2.name <> 'John Doe'
    RETURN d.name, p2.name, COLLECT(DISTINCT p2.symptoms) AS similar_symptoms
    LIMIT 10;
    ```
    **Комментарии:** 
    * Запрос находит всех пациентов, у которых диагностировали ту же болезнь, что и у  John Doe.
    * Далее запрос находит всех докторов, которые диагностировали болезнь John Doe.
    * В результате возвращаются имена докторов, имена пациентов, у которых доктор диагностировал ту же болезнь, что и у  John Doe, и симптомы этих пациентов.

### 5. Геопространственный анализ

Neo4j позволяет эффективно обрабатывать и анализировать данные о пространственных объектах, таких как  дороги,  здания,  точки  интереса  и  другие  географические  объекты.

**Пример:**

Представим  сервис  доставки  товаров,  который  использует  Neo4j  для  оптимизации  маршрутов  доставки.

**Реализация:**

* **Модель:**
    * Вершины:  Точки интереса (POI),  Адрес (Address).
    * Ребра:
        * `РАССТОЯНИЕ` (DISTANCE): соединяет точки интереса и адреса,  указывающие  на  расстояние  между  ними.
* **Запрос:** 
    ```cypher
    MATCH (a1:Address {name: 'New York'})
    MATCH (a2:Address {name: 'Los Angeles'})
    MATCH (p:POI)-[:DISTANCE]->(a1)
    MATCH (p)-[:DISTANCE]->(a2)
    RETURN p.name, p.coordinates
    ORDER BY p.coordinates.latitude
    LIMIT 10;
    ```
    **Комментарии:** 
    * Запрос ищет все точки интереса (POI)  в Нью-Йорке (a1) и Лос-Анджелесе (a2).
    * В результате возвращаются имена и координаты точек интереса, которые расположены как в Нью-Йорке, так и в Лос-Анджелесе.

### Заключение

Neo4j – это мощный инструмент для работы с данными,  где  важны  связи  между  объектами.  Neo4j  применяется  в  широком  спектре  областей,  от  рекомендательных  систем  до  фрод-мониторинга,  и  позволяет  решать  сложные  задачи  с  помощью  интуитивно  понятного  и  эффективного  подхода.
