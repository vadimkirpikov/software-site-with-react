## Условия и фильтры в Cypher

В предыдущих разделах мы познакомились с основными операторами языка Cypher, позволяющими извлекать информацию из графовой базы данных Neo4j. Однако, зачастую нам требуется не просто получить все данные, а отфильтровать их по определенным критериям. Для этого Cypher предоставляет мощные средства фильтрации, основанные на использовании условий и сравнений.

### Условия в Cypher

Условия в Cypher позволяют проверить истинность определенного утверждения и в зависимости от результата выполнить те или иные действия. Основными элементами условий являются операторы сравнения:

| Оператор | Описание | Пример |
|---|---|---|
| `=` | Равно | `n.name = 'Alice'` |
| `!=` | Не равно | `n.age != 25` |
| `<` | Меньше | `n.age < 30` |
| `<=` | Меньше или равно | `n.age <= 30` |
| `>` | Больше | `n.age > 30` |
| `>=` | Больше или равно | `n.age >= 30` |
| `IN` | Содержится в | `n.city IN ['London', 'Paris']` |
| `STARTS WITH` | Начинается с | `n.name STARTS WITH 'A'` |
| `ENDS WITH` | Заканчивается на | `n.name ENDS WITH 'son'` |
| `CONTAINS` | Содержит | `n.name CONTAINS 'a'` |
| `IS NULL` | Является null | `n.email IS NULL` |
| `IS NOT NULL` | Не является null | `n.email IS NOT NULL` |

Условия используются в операторах `WHERE`, `WITH`, `MATCH` и `RETURN`.

### WHERE

`WHERE` используется для фильтрации результатов запроса, оставляя только те записи, которые удовлетворяют заданному условию.

**Пример:**

```cypher
MATCH (n:Person)
WHERE n.age > 30
RETURN n;
```

Этот запрос вернет всех узлов с меткой `Person`, у которых возраст больше 30.

### WITH

`WITH` позволяет отфильтровать результаты промежуточного запроса и передать их дальше по цепочке.

**Пример:**

```cypher
MATCH (n:Person)-[:FRIENDS]->(m:Person)
WHERE n.name = 'Alice'
WITH m
RETURN m.name;
```

Этот запрос сначала находит всех людей, которые дружат с Алисой, а затем отбирает только их имена и возвращает их.

### MATCH

`MATCH` также позволяет использовать условия для фильтрации результатов поиска.

**Пример:**

```cypher
MATCH (n:Person { name: 'Alice' })-[:FRIENDS]->(m:Person { city: 'London' })
RETURN n, m;
```

Этот запрос вернет пару узлов - Алису и ее друга, который живет в Лондоне.

### RETURN

`RETURN` позволяет фильтровать данные, которые возвращаются в результате запроса.

**Пример:**

```cypher
MATCH (n:Person)
WHERE n.age > 30
RETURN n.name, n.age;
```

Этот запрос вернет имя и возраст всех людей старше 30 лет.

### Логические операторы

Для составления более сложных условий используются логические операторы:

| Оператор | Описание | Пример |
|---|---|---|
| `AND` | И | `n.age > 30 AND n.city = 'London'` |
| `OR` | Или | `n.age > 30 OR n.city = 'Paris'` |
| `NOT` | Не | `NOT n.name = 'Alice'` |

**Пример:**

```cypher
MATCH (n:Person)
WHERE n.age > 30 AND n.city IN ['London', 'Paris']
RETURN n;
```

Этот запрос вернет всех людей старше 30 лет, живущих в Лондоне или Париже.

### Регулярные выражения

Cypher позволяет использовать регулярные выражения для поиска узлов и отношений по определенному шаблону.

**Пример:**

```cypher
MATCH (n:Person)
WHERE n.name =~ '.*son$'
RETURN n;
```

Этот запрос вернет всех людей, чье имя заканчивается на "son".

### Фильтрация по типу отношения

Cypher позволяет отфильтровать отношения по типу.

**Пример:**

```cypher
MATCH (n:Person)-[r:FRIENDS]->(m:Person)
RETURN n, r, m;
```

Этот запрос вернет всех людей, которые дружат друг с другом.

### Подведение итогов

Условия и фильтры являются мощным инструментом, позволяющим извлекать необходимую информацию из графовой базы данных Neo4j. Изучив основные операторы и логические операторы, вы сможете создавать сложные запросы для решения различных задач.
