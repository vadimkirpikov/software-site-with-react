## Настройка репликации в MongoDB 7.0

Репликация - это процесс синхронизации данных между несколькими серверами MongoDB. Она обеспечивает высокую доступность данных и отказоустойчивость, позволяя системе продолжать работу даже при сбое одного или нескольких серверов.

В MongoDB 7.0 репликация реализована с помощью **репликационного набора** (replica set), который представляет собой группу серверов MongoDB, содержащих одинаковые копии данных. Репликационный набор состоит из одного **первичного** (primary) сервера и одного или нескольких **вторичных** (secondary) серверов. 

**Первичный сервер** отвечает за обработку всех операций записи. Все изменения данных сначала записываются на первичный сервер, а затем реплицируются на вторичные. 

**Вторичные серверы** получают копии данных с первичного сервера и могут использоваться для чтения данных. В случае сбоя первичного сервера один из вторичных серверов автоматически избирается новым первичным, обеспечивая непрерывность работы приложения.

### Настройка репликационного набора

Рассмотрим пошаговую настройку репликационного набора, состоящего из трех серверов MongoDB.

**Шаг 1. Установка MongoDB**

Убедитесь, что MongoDB 7.0 установлен на всех трех серверах.

**Шаг 2. Настройка конфигурации**

На каждом сервере откройте файл конфигурации MongoDB (`mongod.conf`) и добавьте следующие строки:

```
replication:
  replSetName: "rs0" 
net:
  bindIp: 0.0.0.0 
```

*   `replication.replSetName`: задает имя репликационного набора. Все серверы в одном наборе должны иметь одинаковое имя.
*   `net.bindIp`: указывает IP-адрес, на котором сервер будет прослушивать подключения. `0.0.0.0` разрешает подключение с любого IP-адреса. 

**Шаг 3. Запуск серверов MongoDB**

Запустите сервер MongoDB на каждом сервере с использованием файла конфигурации:

```
mongod --config /path/to/mongod.conf
```

Замените `/path/to/mongod.conf` на фактический путь к файлу конфигурации.

**Шаг 4. Инициализация репликационного набора**

Подключитесь к **одному** из серверов MongoDB с помощью клиента `mongo` и выполните следующий код JavaScript:

```javascript
rs.initiate(
    {
        _id: "rs0",
        members: [
            { _id: 0, host: "server1:27017" },
            { _id: 1, host: "server2:27017" },
            { _id: 2, host: "server3:27017" }
        ]
    }
)
```

*   `_id`: идентификатор репликационного набора. Должен совпадать с именем, указанным в файле конфигурации.
*   `members`: массив, содержащий информацию о каждом сервере в репликационном наборе.
    *   `_id`: уникальный идентификатор сервера в наборе.
    *   `host`: имя хоста или IP-адрес сервера и номер порта.

**Шаг 5. Проверка состояния репликации**

Выполните следующую команду в клиенте `mongo`, чтобы проверить состояние репликационного набора:

```javascript
rs.status()
```

В результате вы должны увидеть информацию о каждом сервере в репликационном наборе, включая его состояние (primary, secondary), время последней синхронизации и другие параметры.

###  Заключение

В этой статье мы рассмотрели основные принципы репликации в MongoDB 7.0 и пошагово настроили простой репликационный набор. 

Репликация - важный аспект обеспечения отказоустойчивости и высокой доступности данных в MongoDB. Более подробно настройка репликации, включая управление пользователями, резервное копирование и восстановление данных, будет рассмотрена в следующих разделах руководства. 
