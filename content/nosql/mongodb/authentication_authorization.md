## Аутентификация и авторизация в MongoDB

В этом разделе мы рассмотрим вопросы аутентификации и авторизации в MongoDB, позволяющие защитить ваши данные от несанкционированного доступа.

### Аутентификация

Аутентификация — это процесс проверки подлинности пользователя, подтверждающий его личность. MongoDB предоставляет несколько механизмов аутентификации:

* **SCRAM (Salted Challenge Response Authentication Mechanism)** — наиболее широко используемый механизм аутентификации в MongoDB. SCRAM использует алгоритм обмена ключами с использованием соли, что делает его более безопасным по сравнению с традиционными механизмами, такими как PLAIN.
* **X.509 Certificate Authentication** — позволяет использовать цифровые сертификаты для аутентификации. 
* **LDAP (Lightweight Directory Access Protocol)** — позволяет аутентифицировать пользователей через LDAP-сервер.
* **Kerberos** — использует протокол Kerberos для аутентификации пользователей.

**Включение аутентификации:**

По умолчанию аутентификация отключена в MongoDB. Чтобы включить аутентификацию, необходимо:

1. **Создать пользователя:**

```javascript
use admin
db.createUser({
  user: "myuser",
  pwd: "mypassword",
  roles: ["readWrite", "clusterAdmin"] // присваиваем пользователю роли
})
```

* **`use admin`** — переключает контекст на базу данных `admin`.
* **`db.createUser()`** — создает нового пользователя.
* **`user`** — имя пользователя.
* **`pwd`** — пароль пользователя.
* **`roles`** — список ролей, которые будут назначены пользователю.

2. **Включить аутентификацию в конфигурационном файле `mongod.conf`:**

```json
security:
  authorization: enabled
```

3. **Перезапустить сервер MongoDB.**

**Пример подключения с аутентификацией:**

```javascript
use admin
db.auth("myuser", "mypassword")
```

* **`use admin`** — переключает контекст на базу данных `admin`.
* **`db.auth()`** — выполняет аутентификацию пользователя.
* **`myuser`** — имя пользователя.
* **`mypassword`** — пароль пользователя.

**Важно!** 
* После включения аутентификации все приложения, взаимодействующие с MongoDB, должны использовать соответствующие механизмы аутентификации. 
* По умолчанию, после включения аутентификации для подключения к серверу MongoDB  требуется авторизация.


### Авторизация

Авторизация — это процесс предоставления пользователю определенных прав доступа к ресурсам. В MongoDB авторизация осуществляется через систему ролей, которые определяют набор действий, которые пользователь может выполнять.

**Основные роли в MongoDB:**

| Роль | Описание |
|---|---|
| **readWrite** | Чтение и запись данных в конкретную базу данных |
| **read** | Только чтение данных в конкретную базу данных |
| **dbAdmin** | Административные операции с конкретной базой данных |
| **clusterAdmin** | Административные операции с кластером |
| **root** | Полный доступ к кластеру, включая управление пользователями и ролями |

**Создание роли:**

```javascript
use admin
db.createRole({
  role: "myrole",
  privileges: [
    { resource: { db: "mydb", collection: "mycollection" }, actions: ["read", "insert"] },
    { resource: { db: "mydb" }, actions: ["drop"] }
  ],
  roles: ["readWrite"]
})
```

* **`use admin`** — переключает контекст на базу данных `admin`.
* **`db.createRole()`** — создает новую роль.
* **`role`** — имя роли.
* **`privileges`** — список привилегий, предоставляемых роли.
* **`resource`** — объект, определяющий ресурс, к которому предоставляются привилегии.
* **`actions`** — список действий, которые разрешены для этого ресурса.
* **`roles`** — список ролей, которые будут наследуемы этой ролью.

**Назначение роли пользователю:**

```javascript
use admin
db.grantRolesToUser("myuser", "myrole")
```

* **`use admin`** — переключает контекст на базу данных `admin`.
* **`db.grantRolesToUser()`** — присваивает роли пользователю.
* **`myuser`** — имя пользователя.
* **`myrole`** — имя роли.

**Пример: ограничение доступа к коллекции `mycollection` в базе данных `mydb`:**

1. **Создать роль `myrole` с привилегиями `read` и `insert` к коллекции `mycollection`:**

```javascript
use admin
db.createRole({
  role: "myrole",
  privileges: [
    { resource: { db: "mydb", collection: "mycollection" }, actions: ["read", "insert"] }
  ]
})
```

2. **Присвоить роль `myrole` пользователю `myuser`:**

```javascript
use admin
db.grantRolesToUser("myuser", "myrole")
```

**Важно!**

*  При настройке системы аутентификации и авторизации необходимо тщательно продумать иерархию ролей и назначить пользователям только необходимые привилегии.
*  В более крупных системах рекомендуется использовать несколько ролей, чтобы разграничить права доступа разных пользователей.
*  Включайте аутентификацию и авторизацию во всех проектах MongoDB, где требуется защитить данные.

### Заключение

Аутентификация и авторизация в MongoDB — ключевые элементы безопасности, которые позволяют обеспечить защиту данных от несанкционированного доступа.  Настройка этих механизмов является важной частью разработки любого приложения, использующего MongoDB. 
