## Основы безопасности

MongoDB, будучи мощной NoSQL базой данных, также требует комплексного подхода к безопасности для защиты данных от несанкционированного доступа и атак. В этом разделе мы рассмотрим основные концепции безопасности MongoDB, которые помогут вам защитить данные вашей базы данных.

###  Аутентификация

Аутентификация - это процесс проверки личности пользователя перед предоставлением доступа к ресурсам. MongoDB предлагает различные механизмы аутентификации, которые можно использовать для ограничения доступа к данным:

####  Аутентификация на уровне базы данных

  - **Использование `mongod`:**  
  В версии 7.0 и выше по умолчанию включена аутентификация, при которой все подключения к серверу `mongod` должны быть авторизованы. 
  - **Настройка аутентификации:**
  Для включения аутентификации необходимо создать файл конфигурации `mongod.conf` с параметром `security.authorization` установленным в `enabled`. 
  
  Пример конфигурационного файла:
  
  ```json
  {
    "net": {
      "bindIp": "127.0.0.1"
    },
    "security": {
      "authorization": "enabled"
    }
  }
  ```

  - **Создание пользователей:**
  Для работы с MongoDB требуется создать пользователей с определенными правами доступа. 
  
  Пример создания пользователя `admin` с правами администратора:
  
  ```javascript
  use admin
  db.createUser({
    user: "admin",
    pwd: "password",
    roles: [{role: "root", db: "admin"}]
  })
  ```

  - **Вход в систему:**
  При попытке подключения к серверу `mongod` вам будет предложено пройти аутентификацию. 

  Пример подключения к серверу `mongod`:
  
  ```javascript
  mongo "mongodb://username:password@localhost:27017/databaseName"
  ```


####  Аутентификация на уровне коллекции

  - **Создание ролей:**
  Для более детального управления доступом можно создавать роли с определенными правами.
  
  Пример создания роли `reader` с правами только на чтение коллекции `myCollection`:
  
  ```javascript
  use databaseName
  db.createRole("reader", {
    privileges: [
      {resource: {db: "databaseName", collection: "myCollection"}, actions: ["find"]}
    ],
    roles: []
  })
  ```

  - **Назначение ролей пользователям:**
  После создания роли можно назначить ее пользователям, чтобы предоставить им соответствующие права.
  
  Пример назначения роли `reader` пользователю `user`:
  
  ```javascript
  use databaseName
  db.grantRolesToUser("user", ["reader"])
  ```

###  Авторизация

Авторизация – это процесс определения того, какие действия пользователь может выполнять с ресурсами, к которым у него есть доступ. В MongoDB авторизация основана на системе ролей и привилегий. 

- **Роли:**  представляют собой набор прав, которые определяют, какие действия пользователь может выполнять с определенными ресурсами.
- **Привилегии:**  определяют конкретные операции, которые пользователь может выполнять с ресурсом.
- **Ресурсы:**  могут быть базами данных, коллекциями, документами или отдельными полями в документах.

####  Типы привилегий

В MongoDB доступны следующие типы привилегий:

| Привилегия | Описание |
|---|---|
| `find` | Чтение данных |
| `insert` | Вставка данных |
| `update` | Обновление данных |
| `delete` | Удаление данных |
| `drop` | Удаление объектов |
| `aggregate` | Выполнение агрегирующих запросов |
| `count` | Подсчет документов в коллекции |

####  Примеры авторизации

- **Доступ к конкретной коллекции:**
  
  ```javascript
  db.createRole("reader", {
    privileges: [
      {resource: {db: "databaseName", collection: "myCollection"}, actions: ["find"]}
    ],
    roles: []
  })
  ```
  
  Эта роль позволяет пользователю только читать данные из коллекции `myCollection`.

- **Доступ ко всем базам данных:**
  
  ```javascript
  db.createRole("admin", {
    privileges: [
      {resource: {db: "*", collection: "*"}, actions: ["*"]}
    ],
    roles: []
  })
  ```
  
  Эта роль предоставляет пользователю полный доступ ко всем базам данных.

- **Доступ к конкретным полям в документах:**
  
  ```javascript
  db.createRole("editor", {
    privileges: [
      {resource: {db: "databaseName", collection: "myCollection", filter: {fieldName: 1}}, actions: ["find", "update", "insert"]}
    ],
    roles: []
  })
  ```
  
  Эта роль позволяет пользователю читать, обновлять и вставлять документы, но только те, которые имеют поле `fieldName` с значением `1`.

###  Безопасность сети

####  Firewall

Для защиты от атак извне рекомендуется использовать брандмауэр, который блокирует нежелательный трафик к серверу `mongod`. Брандмауэр может быть реализован как аппаратное или программное обеспечение.

####  SSL/TLS

HTTPS - это протокол, который обеспечивает безопасное соединение между клиентом и сервером, шифруя данные, передаваемые по сети. 
SSL/TLS использует сертификаты для аутентификации сервера и для шифрования данных между клиентом и сервером.
Для включения SSL/TLS в MongoDB необходимо сгенерировать сертификат и настроить сервер `mongod` для использования этого сертификата.

####  Безопасность со стороны клиента

Для защиты от несанкционированного доступа к данным важно обеспечить безопасность на стороне клиента,  например, используя:

- **SSL/TLS:**  При подключении к серверу `mongod`  используйте SSL/TLS, чтобы защитить данные от перехвата.
- **Использование `mongosh`:**  `mongosh` - это официальный клиент командной строки MongoDB, который поддерживает  SSL/TLS.
- **Безопасность приложений:**  Проверьте, что код приложения, который взаимодействует с MongoDB, не содержит уязвимостей, которые могут привести к утечке данных.
- **Проверка входных данных:**  Важно проверять данные, которые поступают от клиента, чтобы предотвратить SQL-инъекции и другие атаки.

###  Контроль доступа

- **ACL (Access Control List):**  Это список, который хранит разрешения на доступ к ресурсам для каждого пользователя. ACL могут быть использованы для ограничения доступа к ресурсам в зависимости от роли пользователя, его группы или других факторов.
- **RBAC (Role-Based Access Control):**  Это модель управления доступом, которая основана на ролях пользователей. В RBAC каждая роль имеет определенный набор прав, которые определяют, какие действия пользователь может выполнять с ресурсами.
- **ABAC (Attribute-Based Access Control):**  Это модель управления доступом, которая основана на атрибутах пользователей и ресурсов. ABAC позволяет устанавливать более гибкие политики доступа, которые учитывают контекст запроса, например, время суток, местоположение пользователя и т.д.

###  Другие меры безопасности

- **Шифрование данных:**  Шифрование данных помогает защитить данные от несанкционированного доступа, даже если злоумышленник получит доступ к данным на диске.
- **Логирование:**  Ведение логов поможет отслеживать  активность пользователей, что полезно для выявления подозрительных действий. 
- **Аудит:**  Регулярно проводите аудит системы безопасности, чтобы выявить и исправить уязвимости.
- **Обновления:**  Регулярно обновляйте MongoDB и все связанные программные компоненты, чтобы исправить уязвимости безопасности.

###  Рекомендации

- **Используйте  сильные пароли:**  Пароли должны быть  сложными и непредсказуемыми.
- **Не храните пароли в явном виде:**  Используйте механизмы шифрования или хэширования паролей.
- **Не используйте имя пользователя `admin` для обычных пользователей:**  Создайте отдельные роли с необходимыми правами доступа.
- **Используйте принцип наименьших привилегий:**  Предоставьте пользователям только те права, которые им необходимы для выполнения своей работы.
- **Регулярно проверяйте настройки безопасности:**  Используйте инструменты для проверки безопасности MongoDB.
- **Следите за обновлениями безопасности:**  Регулярно обновляйте MongoDB и все связанные программные компоненты.

###  Заключение

Обеспечение безопасности MongoDB  – это многогранный процесс, который требует комплексного подхода. 
Помните, что безопасность - это непрерывный процесс, который требует постоянного внимания и обновления. 
Следуйте принципам безопасности и рекомендациям, приведенным в этом разделе, чтобы защитить данные вашей базы данных от несанкционированного доступа и атак.
