## Группировка данных (GROUP BY) в SQLite

Оператор `GROUP BY` в SQLite позволяет группировать строки с одинаковыми значениями в одной или нескольких колонках. Это особенно полезно при выполнении агрегатных функций, таких как `COUNT`, `SUM`, `AVG`, `MIN` или `MAX`, над каждой группой данных. 

### Основы GROUP BY

Для использования `GROUP BY` необходимо указать колонку или список колонок, по которым будут сгруппированы данные, после предложения `FROM`.  Рассмотрим пример:

```sql
-- Вывести количество заказов для каждого клиента
SELECT customer_id, COUNT(*) AS order_count
FROM orders
GROUP BY customer_id;
```

В этом примере мы группируем строки в таблице `orders` по колонке `customer_id`. Затем для каждой группы (`customer_id`) мы используем агрегатную функцию `COUNT(*)`, чтобы посчитать количество заказов (`order_count`). 

**Важно:** 
* Колонки, указанные в предложении `SELECT`, должны быть либо агрегатными функциями, либо колонками, указанными в `GROUP BY`.
* Если колонка, по которой производится группировка, содержит `NULL` значения, они будут сгруппированы в одну группу.

### Фильтрация групп с помощью HAVING

Предложение `HAVING` используется для фильтрации результатов после группировки данных. Оно работает аналогично предложению `WHERE`, но применяется к результатам `GROUP BY`. Например, чтобы вывести только тех клиентов, у которых более 2 заказов:

```sql
-- Вывести клиентов, у которых более 2 заказов
SELECT customer_id, COUNT(*) AS order_count
FROM orders
GROUP BY customer_id
HAVING order_count > 2;
```

В этом примере мы используем `HAVING` для фильтрации результатов `GROUP BY`, чтобы показать только те группы, где количество заказов (`order_count`) больше 2.

### Группировка по нескольким колонкам

Вы также можете группировать данные по нескольким колонкам. Например, чтобы узнать количество заказов для каждого клиента в каждом месяце:

```sql
-- Вывести количество заказов для каждого клиента в каждом месяце
SELECT customer_id, strftime('%Y-%m', order_date) AS month, COUNT(*) AS order_count
FROM orders
GROUP BY customer_id, month;
```

В этом примере мы группируем данные по двум колонкам: `customer_id` и `month`, где `month` формируется из даты заказа (`order_date`) с помощью функции `strftime('%Y-%m')`. Это позволит получить агрегированные данные по каждому клиенту и каждому месяцу.

### Использование GROUP BY с другими операторами

`GROUP BY` можно использовать с другими операторами SQL, такими как `ORDER BY` и `LIMIT`, для дальнейшей обработки и ограничения результатов.

**Пример:**

```sql
-- Вывести 10 клиентов с наибольшим количеством заказов
SELECT customer_id, COUNT(*) AS order_count
FROM orders
GROUP BY customer_id
ORDER BY order_count DESC
LIMIT 10;
```

В этом примере мы сначала группируем заказы по `customer_id`, затем сортируем результаты по убыванию количества заказов (`order_count DESC`) и, наконец, ограничиваем вывод первыми 10 строками с помощью `LIMIT 10`. 

### Заключение

Оператор `GROUP BY` является мощным инструментом в SQLite, позволяющим анализировать и агрегировать данные по группам. Используя `GROUP BY` вместе с агрегатными функциями, предложением `HAVING` и другими операторами SQL, можно получать ценную информацию из ваших данных.
