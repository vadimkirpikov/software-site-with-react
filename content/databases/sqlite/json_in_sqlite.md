## Работа с JSON в SQLite

Начиная с версии 3.38, SQLite предоставляет встроенную поддержку JSON. Это означает, что вы можете хранить, извлекать и запрашивать данные в формате JSON непосредственно в базе данных SQLite, без необходимости преобразования их в другие форматы.

### Создание таблицы с JSON

Для хранения JSON-данных в SQLite достаточно создать обычную таблицу с типом данных `TEXT`:

```sql
CREATE TABLE products (
    id INTEGER PRIMARY KEY,
    data TEXT
);
```

В этой таблице мы будем хранить JSON-документы в столбце `data`.

### Вставка JSON-данных

Для вставки JSON-данных в таблицу, достаточно использовать обычный оператор `INSERT`:

```sql
INSERT INTO products (data) VALUES
('{
    "name": "Ноутбук",
    "brand": "Asus",
    "price": 700,
    "specifications": {
        "cpu": "Intel Core i5",
        "ram": 8,
        "storage": "512GB SSD"
    }
}');
```

В этом примере мы вставляем JSON-документ, содержащий информацию о ноутбуке.

### Извлечение JSON-данных

Извлекать данные можно с помощью оператора `SELECT`:

```sql
SELECT data FROM products WHERE id = 1;
```

Этот запрос вернет JSON-документ, хранящийся в строке с `id = 1`.

### Запросы к JSON-данным

SQLite предоставляет несколько функций для работы с JSON-данными:

- `json_extract(json, path)`: извлекает значение по указанному пути в JSON-документе.
- `json_type(json, path)`: возвращает тип данных значения по указанному пути.
- `json_valid(json)`: проверяет, является ли строка валидным JSON-документом.
- `json_array(value1, value2, ...)`: создает новый JSON-массив.
- `json_object(key1, value1, key2, value2, ...)`: создает новый JSON-объект.

#### Примеры использования функций JSON

**1. Получение значения по ключу:**

```sql
SELECT json_extract(data, '$.name') AS product_name 
FROM products 
WHERE id = 1;
```

Этот запрос вернет значение ключа `name` ("Ноутбук") из JSON-документа в строке с `id = 1`.

**2. Получение значения из вложенного объекта:**

```sql
SELECT json_extract(data, '$.specifications.cpu') AS cpu_model 
FROM products 
WHERE id = 1;
```

Этот запрос вернет значение ключа `cpu` ("Intel Core i5") из вложенного объекта `specifications`.

**3. Фильтрация данных по значению в JSON:**

```sql
SELECT * FROM products 
WHERE json_extract(data, '$.brand') = 'Asus' AND json_extract(data, '$.price') < 800;
```

Этот запрос вернет все продукты бренда "Asus" с ценой меньше 800.

**4. Проверка типа данных:**

```sql
SELECT json_type(data, '$.price') 
FROM products 
WHERE id = 1;
```

Этот запрос вернет тип данных значения ключа `price` ("integer").

**5. Создание JSON-объекта:**

```sql
SELECT json_object('name', 'Новый продукт', 'price', 900) AS new_product;
```

Этот запрос создаст новый JSON-объект с ключами `name` и `price`.

### Обновление JSON-данных

Обновлять отдельные значения в JSON-документах можно с помощью функции `json_set()`:

```sql
UPDATE products
SET data = json_set(data, '$.price', 750)
WHERE id = 1;
```

Этот запрос обновит значение ключа `price` на 750 в JSON-документе строки с `id = 1`.

### Удаление JSON-данных

Удалять JSON-данные можно с помощью обычного оператора `DELETE`:

```sql
DELETE FROM products WHERE id = 1;
```

Этот запрос удалит строку с `id = 1`, включая JSON-документ в столбце `data`.

### Преимущества использования JSON в SQLite

- **Гибкость:** Хранение данных в формате JSON позволяет легко добавлять новые поля и изменять структуру данных без необходимости изменять схему таблицы.
- **Удобство:** Работа с JSON-данными в SQLite не требует дополнительных библиотек или инструментов.
- **Производительность:** Встроенные функции JSON в SQLite оптимизированы для высокой производительности.

### Ограничения 

- Отсутствие индексации внутри JSON-документов:  SQLite не поддерживает индексацию отдельных ключей или значений внутри JSON-документа. Это может сказаться на производительности при поиске по большим наборам данных.

Несмотря на ограничения, встроенная поддержка JSON в SQLite делает ее мощным инструментом для работы с данными в формате JSON. 
