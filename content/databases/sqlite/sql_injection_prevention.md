## Защита от SQL-инъекций в SQLite

SQL-инъекция - это распространенная уязвимость, которая позволяет злоумышленникам внедрять вредоносный код SQL в ваши запросы к базе данных. Это может привести к утечке данных, изменению данных или даже полному захвату вашей базы данных.

SQLite, как и любая другая реляционная база данных, подвержена атакам с использованием SQL-инъекций.  Однако, используя правильные методы и инструменты, вы можете значительно снизить риски.

###  Использование параметризованных запросов

Параметризованные запросы - это самый эффективный способ предотвращения SQL-инъекций. Вместо того, чтобы конструировать SQL-запросы путем объединения строк, вы используете параметризованные запросы, где данные и команды SQL обрабатываются отдельно.

**Пример:**

Предположим, у вас есть таблица `users` со следующей структурой:

| Столбец | Тип данных |
|---|---|
| id | INTEGER |
| username | TEXT |
| password | TEXT |

И вы хотите получить информацию о пользователе с заданным именем пользователя.

**Небезопасный способ (уязвим к SQL-инъекциям):**

```python
username = input("Введите имя пользователя: ")
query = "SELECT * FROM users WHERE username = '" + username + "'"
cursor.execute(query)
```

В этом примере, если пользователь введет `admin'--`, за запрос будет выполнен следующий SQL-код:

```sql
SELECT * FROM users WHERE username = 'admin'--'
```

Этот запрос вернет информацию о пользователе "admin" без проверки пароля.

**Безопасный способ (использует параметризованные запросы):**

```python
username = input("Введите имя пользователя: ")
query = "SELECT * FROM users WHERE username = ?"
cursor.execute(query, (username,)) 
```

В этом примере, `?` - это заполнитель для параметра. SQLite автоматически экранирует значение переменной `username` перед тем, как подставить его в запрос. Это предотвращает возможность SQL-инъекции.

### Валидация и экранирование данных

Хотя параметризованные запросы являются наиболее эффективным способом защиты, в некоторых случаях может потребоваться валидация и экранирование данных.

**Валидация данных** подразумевает проверку данных на соответствие ожидаемым форматам и значениям. 

**Экранирование данных** - это процесс преобразования специальных символов в SQL-запросе, чтобы они интерпретировались как часть данных, а не как часть команды SQL.

**Пример:**

```python
def escape_string(value):
  """ Экранирует специальные символы в строке для безопасного использования в SQL запросе."""
  return value.replace("'", "''")

username = escape_string(input("Введите имя пользователя: "))
query = f"SELECT * FROM users WHERE username = '{username}'" 
cursor.execute(query)
```

В этом примере функция `escape_string` заменяет все одиночные кавычки (`'`) на две одиночные кавычки (`''`), что является способом экранирования в SQLite.

**Важно:**

* Всегда используйте параметризованные запросы, когда это возможно.
* Валидируйте данные со стороны приложения, чтобы убедиться, что они соответствуют ожидаемым форматам.
* Будьте осторожны при использовании функций динамического построения запросов, таких как `exec()` или `eval()`, и избегайте их использования, если это возможно.
* Регулярно обновляйте SQLite до последней версии, чтобы использовать преимущества последних исправлений безопасности. 

Используя эти рекомендации, вы можете сделать ваши приложения, работающие с SQLite, более безопасными и защищенными от SQL-инъекций. 
