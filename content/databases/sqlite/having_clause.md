## Фильтрация групп (HAVING) в SQLite

В SQLite, предложения `GROUP BY` используются для группировки строк с одинаковыми значениями в одной или нескольких колонках.  Однако, что делать, если вы хотите отфильтровать не отдельные строки, а целые группы? В этом случае на помощь приходит предложение `HAVING`.

Предложение `HAVING` работает аналогично `WHERE`, но применяется не к отдельным строкам, а к сгруппированным результатам. Другими словами, `HAVING` фильтрует группы, созданные предложением `GROUP BY`, по заданному условию.

### Синтаксис HAVING

```sql
SELECT column1, column2, ...
FROM table_name
WHERE condition
GROUP BY column1, column2, ...
HAVING condition;
```

### Как работает HAVING

1. Сначала база данных выполняет поиск данных, соответствующих условию в предложении `WHERE` (если оно присутствует).
2. Затем результаты группируются на основе значений в колонках, указанных в предложении `GROUP BY`.
3. Наконец, предложение `HAVING` фильтрует полученные группы, оставляя только те, которые удовлетворяют заданному в нем условию.

### Пример использования HAVING

Допустим, у нас есть таблица `products` со следующими данными:

| ProductName | Category    | Price |
|------------|-------------|-------|
| Apple      | Fruit       | 1.5   |
| Banana     | Fruit       | 0.75  |
| Orange     | Fruit       | 1.2   |
| Milk       | Dairy       | 2.5   |
| Cheese     | Dairy       | 4.0   |
| Bread      | Bakery      | 2.0   |

**Задача:** Вывести категории товаров, средняя цена которых превышает 2.0.

**Решение:**

```sql
SELECT Category, AVG(Price) AS AveragePrice
FROM products
GROUP BY Category
HAVING AVG(Price) > 2.0;
```

**Пояснение:**

1. `SELECT Category, AVG(Price) AS AveragePrice`: Выбираем колонки `Category` и среднюю цену (`AVG(Price)`) с алиасом `AveragePrice`.
2. `FROM products`: Указываем таблицу `products` как источник данных.
3. `GROUP BY Category`: Группируем строки по колонке `Category`.
4. `HAVING AVG(Price) > 2.0`:  Фильтруем группы, оставляя только те, где средняя цена (`AVG(Price)`) больше 2.0.

**Результат:**

| Category | AveragePrice |
|----------|-------------|
| Dairy     | 3.25        |

### Важные моменты:

- Предложение `HAVING` всегда используется с `GROUP BY`.
-  `WHERE` фильтрует строки *до* группировки, а `HAVING` - *после*.
- Внутри `HAVING` можно использовать агрегатные функции (например, `AVG`, `SUM`, `COUNT`, `MAX`, `MIN`), так как они работают с группами строк.

### Заключение

Предложение `HAVING` в SQLite предоставляет мощный инструмент для фильтрации сгруппированных данных. Оно позволяет гибко управлять выборкой информации из базы данных, фокусируясь на агрегированных характеристиках групп, а не отдельных строк.
