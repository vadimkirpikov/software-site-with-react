## Самосоединение таблицы в SQLite

Самосоединение (self-join) – это операция в SQL, которая позволяет объединить таблицу саму с собой.  Другими словами, мы можем рассматривать одну и ту же таблицу как две отдельные, но связанные, таблицы. Это может быть полезно для поиска взаимосвязей внутри данных одной таблицы.

### Зачем использовать самосоединение?

Представьте, у вас есть таблица сотрудников, где хранится информация о каждом сотруднике, включая его ID и ID руководителя:

| ID | Имя     | Должность    | ID Руководителя |
| -- | -------- | ------------ | --------------- |
| 1  | Иванов   | Директор     | NULL            |
| 2  | Петров   | Менеджер    | 1              |
| 3  | Сидоров  | Аналитик   | 2              |
| 4  | Кузнецов | Разработчик | 2              |

Если вы хотите вывести список сотрудников и имена их руководителей, вам понадобится использовать самосоединение.

### Как выполнить самосоединение

1. **Создайте два псевдонима для одной и той же таблицы:**  В запросе с самосоединением нужно указать два разных псевдонима для одной таблицы. Это позволит обращаться к одной и той же таблице как к двум разным объектам.

2. **Определите условие соединения:** Укажите условие, по которому будут соединяться строки из "двух" таблиц (на самом деле одной). Это обычно делается с помощью оператора `JOIN` и условия `ON`, которое связывает столбец из одного экземпляра таблицы со столбцом из другого экземпляра.

3. **Выберите нужные столбцы:**  В разделе `SELECT` укажите столбцы, которые вы хотите получить в результате, используя псевдонимы таблиц для уточнения, из какого экземпляра таблицы брать столбец.

### Пример самосоединения

Вернемся к примеру с таблицей сотрудников. Чтобы получить список сотрудников и имена их руководителей, используйте следующий SQL-запрос:

```sql
SELECT 
    e1.Имя AS ИмяСотрудника, 
    e2.Имя AS ИмяРуководителя
FROM 
    Сотрудники e1
LEFT JOIN 
    Сотрудники e2 ON e1.ID_Руководителя = e2.ID;
```

**Пояснение:**

1. `e1` и `e2` - это псевдонимы для таблицы `Сотрудники`.

2. `LEFT JOIN` используется для того, чтобы включить в результат всех сотрудников, даже если у них нет руководителя (значение `ID_Руководителя` равно NULL).

3.  Условие `e1.ID_Руководителя = e2.ID` связывает строки из "двух" таблиц: для каждой строки в `e1` (сотрудник) ищется соответствующая строка в `e2` (руководитель), где `ID_Руководителя` из `e1` равен `ID` из `e2`.

4. `SELECT` указывает, какие столбцы нужно вывести: имя сотрудника (`e1.Имя`) и имя его руководителя (`e2.Имя`).

**Результат:**

| ИмяСотрудника | ИмяРуководителя |
| -------------- | --------------- |
| Иванов        | NULL            |
| Петров        | Иванов          |
| Сидоров       | Петров          |
| Кузнецов      | Петров          |

Как видите, самосоединение позволило нам получить информацию о руководителях из той же таблицы, где хранится информация о сотрудниках.

### Заключение

Самосоединение - мощный инструмент для анализа данных, который позволяет находить взаимосвязи внутри одной таблицы.  Понимание принципов работы самосоединения поможет вам эффективнее использовать SQL для решения различных задач. 
