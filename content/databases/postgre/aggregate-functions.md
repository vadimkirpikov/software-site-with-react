## Функции агрегации (SUM, AVG, COUNT, MIN, MAX) в PostgreSQL

Функции агрегации в PostgreSQL позволяют производить вычисления над наборами строк и возвращать единственное значение. Это мощный инструмент для анализа данных, предоставляющий возможность получать суммарные, средние, минимальные, максимальные значения, а также количество записей, удовлетворяющих определенным условиям. 

### SUM

Функция `SUM()` используется для получения суммы значений в определенном столбце.

**Синтаксис:**

```sql
SUM(выражение)
```

где *выражение* - столбец или выражение, возвращающее числовой тип данных.

**Пример:**

Допустим, у нас есть таблица `orders` со столбцами `order_id` и `total_amount`. Чтобы получить общую сумму всех заказов, используем следующий запрос:

```sql
SELECT SUM(total_amount) AS total_revenue FROM orders;
```

В данном примере `total_revenue` - это алиас, присвоенный результирующему значению.

### AVG

Функция `AVG()` используется для получения среднего значения числового столбца.

**Синтаксис:**

```sql
AVG(выражение)
```

где *выражение* - столбец или выражение, возвращающее числовой тип данных.

**Пример:**

Чтобы получить среднюю сумму заказа в таблице `orders`, используем следующий запрос:

```sql
SELECT AVG(total_amount) AS average_order_amount FROM orders;
```

### COUNT

Функция `COUNT()` используется для подсчета количества строк, удовлетворяющих определенным условиям.

**Синтаксис:**

```sql
COUNT(выражение)
```

где *выражение* может быть:

* `*`: Подсчитывает все строки, включая строки с null-значениями.
* `столбец`: Подсчитывает количество строк с не null-значениями в указанном столбце.
* `DISTINCT столбец`: Подсчитывает количество уникальных не null-значений в указанном столбце.

**Примеры:**

* Подсчет всех заказов:

```sql
SELECT COUNT(*) AS total_orders FROM orders;
```

* Подсчет заказов с не null-значением в столбце `customer_id`:

```sql
SELECT COUNT(customer_id) AS orders_with_customers FROM orders;
```

* Подсчет количества уникальных значений в столбце `customer_id`:

```sql
SELECT COUNT(DISTINCT customer_id) AS unique_customers FROM orders;
```

### MIN и MAX

Функции `MIN()` и `MAX()` используются для нахождения минимального и максимального значений соответственно.

**Синтаксис:**

```sql
MIN(выражение)
MAX(выражение)
```

где *выражение* - столбец, по которому нужно найти минимальное или максимальное значение.

**Примеры:**

* Нахождение минимальной и максимальной суммы заказа:

```sql
SELECT 
    MIN(total_amount) AS min_order_amount,
    MAX(total_amount) AS max_order_amount
FROM orders;
```

### Использование функций агрегации с GROUP BY

Функции агрегации становятся особенно полезными при использовании с предложением `GROUP BY`. Это позволяет выполнять агрегацию не по всей таблице, а по группам строк.

**Пример:**

Допустим, мы хотим узнать количество заказов и общую сумму по каждому клиенту. Для этого сгруппируем данные по столбцу `customer_id`:

```sql
SELECT 
    customer_id, 
    COUNT(*) AS total_orders, 
    SUM(total_amount) AS total_spent
FROM orders
GROUP BY customer_id;
```

В данном примере для каждой группы `customer_id` будут подсчитаны общее количество заказов (`total_orders`) и общая сумма покупок (`total_spent`).

### Заключение

Функции агрегации - это мощный инструмент для анализа данных в PostgreSQL. Они позволяют получать суммарную информацию из таблиц, что делает их незаменимыми для создания отчетов, анализа трендов и получения общей картины данных. 
