## Настройка PostgreSQL после установки

Поздравляем! Вы успешно установили PostgreSQL 16. Но перед тем, как погрузиться в мир реляционных баз данных, необходимо выполнить несколько важных настроек для оптимизации производительности и безопасности.

### 1. Настройка файла postgresql.conf

Файл `postgresql.conf` - это основной конфигурационный файл PostgreSQL, который содержит множество параметров, влияющих на работу сервера. Давайте настроим некоторые из них.

1. **Найдите файл `postgresql.conf`.**  Обычно он расположен в директории `$PGDATA/`, которая по умолчанию находится в `/var/lib/postgresql/data` для Linux или `C:\Program Files\PostgreSQL\16\data` для Windows.

2. **Откройте файл `postgresql.conf` в текстовом редакторе с правами администратора.**

3. **Найдите и измените следующие параметры:**

   | Параметр                  | Описание                                                         | Рекомендованное значение                       |
   |--------------------------|-------------------------------------------------------------------|---------------------------------------------|
   | `listen_addresses`        | Адреса, на которых сервер будет прослушивать соединения.        | `'*'` (для прослушивания на всех адресах)   |
   | `port`                   | Порт, на котором сервер будет прослушивать соединения.          | `5432` (порт по умолчанию)                 |
   | `max_connections`        | Максимальное количество одновременных подключений к серверу. | 100 (зависит от ресурсов сервера)          |
   | `shared_buffers`         | Объем памяти, выделяемый для буферизации данных.                | 1/4 от объема оперативной памяти сервера  |
   | `effective_cache_size`    | Общий объем памяти, доступный для кэширования данных.          | 1/2 от объема оперативной памяти сервера  |
   | `work_mem`                | Объем памяти, используемый для выполнения запросов.             | 4 МБ (зависит от сложности запросов)      |
   | `maintenance_work_mem`    | Объем памяти, используемый для операций обслуживания.           | 64 МБ (зависит от объема базы данных)        |
   | `log_destination`       | Куда записывать логи PostgreSQL.                                 | `'csvlog'` (для удобного анализа)        |
   | `logging_collector`      | Включить или отключить сбор логов.                               | `on` (рекомендуется для отладки)            |
   | `log_filename`          | Формат имени файла журнала.                                     | `'%a.%H%M%S'` (например,  `Tue.103000`)    |
   | `log_directory`         | Директория для хранения логов.                                | `'log'` (относительно `$PGDATA`)             |
   | `log_min_duration_statement` | Минимальная длительность запроса для записи в лог.             | `2000` (2 секунды, для отладки)           |

   **Важно:** Не забудьте раскомментировать строки с параметрами перед их изменением (удалить символ `#` в начале строки). Значения параметров в примере даны для ознакомления, рекомендуется подбирать их индивидуально под ваши нужды и ресурсы сервера.

4. **Сохраните изменения и перезапустите сервер PostgreSQL:**

   ```bash
   sudo systemctl restart postgresql
   ```

### 2. Настройка аутентификации

   Файл `pg_hba.conf` отвечает за настройку аутентификации пользователей PostgreSQL.

1. **Найдите файл `pg_hba.conf`.** Он находится в той же директории, что и `postgresql.conf`.

2. **Откройте файл `pg_hba.conf` в текстовом редакторе с правами администратора.**

3. **Добавьте или измените строки, определяющие методы аутентификации.** Пример настройки для локальных подключений с парольной аутентификацией:

   ```
   # TYPE  DATABASE        USER            ADDRESS          METHOD

   # Локальные подключения, аутентификация по паролю
   local   all             all             127.0.0.1/32    md5
   local   all             all             ::1/128         md5
   ```

   **Важно:** Строки в файле `pg_hba.conf` обрабатываются сверху вниз. Первое подходящее правило определяет метод аутентификации. Не забудьте перезапустить сервер PostgreSQL после внесения изменений.

### 3. Создание пользователей и баз данных

   После настройки аутентификации можно создавать пользователей и базы данных.

1. **Подключитесь к серверу PostgreSQL:**

   ```bash
   psql -U postgres
   ```

2. **Создайте нового пользователя:**

   ```sql
   CREATE USER new_user WITH PASSWORD 'strong_password';
   ```

   **Важно:** Замените `new_user` и `strong_password` на желаемые имя пользователя и пароль.

3. **Создайте новую базу данных:**

   ```sql
   CREATE DATABASE new_database;
   ```

   **Важно:** Замените `new_database` на желаемое имя базы данных.

4. **Предоставьте новому пользователю права на созданную базу данных:**

   ```sql
   GRANT ALL PRIVILEGES ON DATABASE new_database TO new_user;
   ```

5. **Выйдите из `psql`:**

   ```sql
   \q
   ```

### Заключение

   В этом разделе мы рассмотрели основные настройки PostgreSQL 16 после установки. Вы настроили файл `postgresql.conf`, настроили аутентификацию в `pg_hba.conf`, создали нового пользователя и базу данных. Это базовые настройки, необходимые для начала работы. Более подробно о настройке PostgreSQL вы узнаете в следующих разделах руководства.
