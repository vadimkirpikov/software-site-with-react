## Группировка данных (GROUP BY) в MySQL

Оператор `GROUP BY` в MySQL используется для группировки строк с одинаковыми значениями в одной или нескольких колонках. Это позволяет выполнять агрегатные функции (например, `SUM`, `COUNT`, `AVG`) над каждой группой, а не над всей таблицей.

### Синтаксис

Общий синтаксис оператора `GROUP BY` выглядит следующим образом:

```sql
SELECT columnA, columnB, aggregate_function(columnC)
FROM table_name
WHERE condition
GROUP BY columnA, columnB
ORDER BY columnA, columnB;
```

Разберем каждый элемент:

* `SELECT columnA, columnB, aggregate_function(columnC)`:  определяет колонки, которые будут возвращены запросом. Это могут быть как колонки, используемые для группировки (`columnA`, `columnB`), так и результат агрегатной функции, примененной к другой колонке (`aggregate_function(columnC)`).
* `FROM table_name`: указывает таблицу, из которой выбираются данные.
* `WHERE condition`:  необязательный оператор, используемый для фильтрации строк перед группировкой.
* `GROUP BY columnA, columnB`: группирует строки по указанным колонкам (`columnA`, `columnB`). Строки с одинаковыми значениями в этих колонках будут объединены в одну группу.
* `ORDER BY columnA, columnB`:  необязательный оператор, используемый для сортировки результатов по указанным колонкам.

### Пример

Рассмотрим пример. Предположим, у нас есть таблица `orders` со следующими данными:

| order_id | customer_id | order_date  | total_amount |
|---|---|---|---|
| 1        | 1           | 2023-03-01 | 100         |
| 2        | 2           | 2023-03-02 | 200         |
| 3        | 1           | 2023-03-03 | 150         |
| 4        | 3           | 2023-03-04 | 300         |
| 5        | 2           | 2023-03-05 | 100         |

Мы хотим узнать, сколько заказов сделал каждый покупатель (`customer_id`) и какова общая сумма их заказов. Для этого можно использовать следующий запрос:

```sql
SELECT 
    customer_id,  -- Выбираем колонку с идентификатором покупателя
    COUNT(*) AS total_orders,  -- Считаем количество заказов для каждого покупателя
    SUM(total_amount) AS total_amount -- Считаем сумму заказов для каждого покупателя
FROM 
    orders -- Указываем таблицу 'orders'
GROUP BY 
    customer_id  -- Группируем по колонке 'customer_id'
ORDER BY 
    customer_id;  -- Сортируем по колонке 'customer_id'
```

Результат запроса:

| customer_id | total_orders | total_amount |
|---|---|---|
| 1           | 2           | 250         |
| 2           | 2           | 300         |
| 3           | 1           | 300         |

### Агрегатные функции с GROUP BY

`GROUP BY` часто используется с агрегатными функциями для вычисления различных показателей по каждой группе. Некоторые из наиболее часто используемых агрегатных функций:

* `AVG()`: возвращает среднее значение
* `COUNT()`: возвращает количество строк
* `MAX()`: возвращает максимальное значение
* `MIN()`: возвращает минимальное значение
* `SUM()`: возвращает сумму значений

### HAVING

Оператор `HAVING` используется для фильтрации результатов после группировки. В отличие от оператора `WHERE`, который фильтрует строки **до** группировки, `HAVING` фильтрует **группы** на основе результатов агрегатных функций.

**Пример:**

Вернемся к таблице `orders`. Найдем покупателей, сделавших заказов на сумму более 200. 

```sql
SELECT 
    customer_id, 
    SUM(total_amount) AS total_spent
FROM 
    orders
GROUP BY 
    customer_id
HAVING 
    total_spent > 200;
```

Результат:

| customer_id | total_spent |
|---|---|
| 1           | 250         |
| 2           | 300         |
| 3           | 300         |

### Заключение

`GROUP BY` - это мощный инструмент для анализа данных в MySQL. Он позволяет группировать данные по различным критериям и выполнять агрегатные функции над каждой группой, что дает возможность получать ценную информацию и выявлять закономерности. Сочетание `GROUP BY` с операторами `WHERE` и `HAVING` обеспечивает гибкость и точность при обработке данных.
