## Создание и вызов хранимых процедур в MySQL

Хранимые процедуры - это набор SQL-запросов, которые хранятся и выполняются непосредственно на сервере базы данных. Они позволяют инкапсулировать логику приложения, повысить производительность и упростить обслуживание.

### Создание хранимых процедур

Для создания хранимой процедуры используется оператор `CREATE PROCEDURE`, за которым следует имя процедуры, список параметров (опционально) и тело процедуры, заключенное в блок `BEGIN` и `END`.

**Синтаксис:**

```sql
CREATE PROCEDURE имя_процедуры ( [параметры] )
BEGIN
  -- Тело процедуры
END;
```

**Параметры:**

Параметры хранимой процедуры объявляются в скобках после имени процедуры. Каждый параметр имеет имя, тип данных и направление передачи (IN, OUT или INOUT).

* **IN**: Параметр передается в процедуру, его значение можно использовать внутри процедуры, но нельзя изменить.
* **OUT**: Значение параметра устанавливается внутри процедуры и возвращается вызывающему коду.
* **INOUT**: Параметр передается в процедуру, его значение можно использовать и изменять внутри процедуры, а изменения будут видны вызывающему коду.

**Пример:**

```sql
-- Создание процедуры для добавления нового пользователя
CREATE PROCEDURE AddNewUser (
    IN p_username VARCHAR(50),
    IN p_password VARCHAR(255)
)
BEGIN
    INSERT INTO Users (username, password) VALUES (p_username, p_password);
END;
```

### Вызов хранимых процедур

Для вызова хранимой процедуры используется оператор `CALL`, за которым следует имя процедуры и список аргументов (если они есть) в скобках.

**Синтаксис:**

```sql
CALL имя_процедуры( [аргументы] );
```

**Пример:**

```sql
-- Вызов процедуры для добавления нового пользователя
CALL AddNewUser('johndoe', 'password123');
```

### Пример использования хранимой процедуры

Предположим, у нас есть таблица `Products` со следующей структурой:

| Столбец | Тип данных |
|---|---|
| product_id | INT |
| product_name | VARCHAR(255) |
| price | DECIMAL(10,2) |

Создадим хранимую процедуру для увеличения цены на все продукты в определенной категории на заданный процент:

```sql
CREATE PROCEDURE IncreasePriceByCategory (
    IN p_category_name VARCHAR(255),
    IN p_percentage INT
)
BEGIN
    UPDATE Products
    SET price = price * (1 + p_percentage / 100)
    WHERE product_name LIKE CONCAT(p_category_name, '%');
END;
```

**Описание:**

* Процедура принимает два параметра: `p_category_name` (название категории) и `p_percentage` (процент увеличения).
* Внутри процедуры выполняется запрос `UPDATE`, который увеличивает цену на `p_percentage` процентов для всех продуктов, чье название начинается с `p_category_name`.

**Вызов процедуры:**

```sql
-- Увеличить цену на все продукты в категории "Electronics" на 10%
CALL IncreasePriceByCategory('Electronics', 10);
```

### Преимущества использования хранимых процедур

* **Повышение производительности**: Хранимые процедуры компилируются один раз и хранятся в кеше сервера, что сокращает время выполнения повторных вызовов.
* **Снижение сетевого трафика**: Вместо отправки нескольких SQL-запросов клиентом на сервер отправляется только один вызов хранимой процедуры.
* **Повышение безопасности**: Хранимые процедуры могут помочь предотвратить SQL-инъекции, ограничивая доступ к данным.
* **Упрощение обслуживания**: Логика приложения инкапсулируется в хранимых процедурах, что упрощает их изменение и обновление.
* **Повторное использование кода**: Хранимые процедуры можно вызывать из разных частей приложения или другими хранимыми процедурами.

### Заключение

Хранимые процедуры являются мощным инструментом для разработки приложений баз данных. Они позволяют инкапсулировать логику приложения, повысить производительность, безопасность и упростить обслуживание.
