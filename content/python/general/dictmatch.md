## Сопоставление с образцом для словарей в Python

Python 3.10 представил мощный инструмент - сопоставление с образцом (pattern matching). Эта функциональность позволяет сравнивать объекты с различными шаблонами и выполнять соответствующие действия в зависимости от совпадения. В этой статье мы рассмотрим, как применять сопоставление с образцом  специально для работы со словарями.

### Основы сопоставления с образцом в словарях

Для проверки наличия ключей и значений в словаре,  используйте оператор `case` в сочетании с оператором `in`:

```python
def process_data(data):
    match data:
        case {"status": "ok"}:
            print("Данные успешно обработаны")
        case {"status": "error", "message": message}:
            print(f"Произошла ошибка: {message}")
        case _:
            print("Неизвестный статус данных")

process_data({"status": "ok"})  # Вывод: Данные успешно обработаны
process_data({"status": "error", "message": "Ошибка валидации"})  # Вывод: Произошла ошибка: Ошибка валидации
process_data({"data": [1, 2, 3]})  # Вывод: Неизвестный статус данных
```

В этом примере функция `process_data` принимает словарь `data`. В блоке `match` проверяются различные шаблоны:

-  `{"status": "ok"}`: Проверяет, содержит ли словарь ключ `"status"` со значением `"ok"`.
-  `{"status": "error", "message": message}`: Проверяет наличие ключа `"status"` со значением `"error"` и ключа `"message"`. Если совпадение найдено, значение ключа `"message"` присваивается переменной `message`.
-  `_`:  Служит подстановочным знаком и соответствует любому значению, если ни один из предыдущих шаблонов не подошел.

### Извлечение значений из словаря

Вы можете извлекать значения из словаря, используя сопоставление с образцом. Для этого укажите имя переменной после ключа в шаблоне:

```python
def get_user_info(user):
    match user:
        case {"name": name, "age": age}:
            print(f"Имя: {name}, Возраст: {age}")
        case _:
            print("Некорректные данные пользователя")

get_user_info({"name": "Иван", "age": 30})  # Вывод: Имя: Иван, Возраст: 30
```

### Комбинирование шаблонов

Вы можете комбинировать различные шаблоны, используя оператор `|` (или):

```python
def handle_event(event):
    match event:
        case {"type": "click", "x": x, "y": y} | {"type": "touch", "x": x, "y": y}:
            print(f"Координаты: x={x}, y={y}")
        case {"type": "scroll", "direction": direction}:
            print(f"Прокрутка: {direction}")
        case _:
            print("Неизвестное событие")

handle_event({"type": "click", "x": 100, "y": 200})  # Вывод: Координаты: x=100, y=200
handle_event({"type": "scroll", "direction": "вниз"})  # Вывод: Прокрутка: вниз
```

В этом примере функция `handle_event` обрабатывает события типа "click", "touch" и "scroll". Обратите внимание на использование `|` для объединения шаблонов с одинаковой логикой обработки координат.

### Дополнительные возможности

Сопоставление с образцом для словарей предоставляет и другие полезные возможности:

- Использование подстановочного знака `**rest` для захвата остальных элементов словаря:

```python
data = {"name": "Алиса", "age": 25, "city": "Москва"}
match data:
    case {"name": name, **rest}:
        print(f"Имя: {name}, Остальные данные: {rest}")
```

- Применение guards - условий, которые должны выполняться для успешного сопоставления:

```python
def check_age(user):
    match user:
        case {"age": age} if age >= 18:
            print("Доступ разрешен")
        case _:
            print("Доступ запрещен")

check_age({"age": 20})  # Вывод: Доступ разрешен
check_age({"age": 15})  # Вывод: Доступ запрещен
```

Сопоставление с образцом для словарей - мощный инструмент, упрощающий обработку данных. Используйте его для создания более чистого и выразительного кода при работе со словарями в Python. 
