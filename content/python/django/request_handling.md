## Обработка запросов и возврат ответов

Django построен на основе архитектурного паттерна Model-View-Template (MVT), который определяет, как ваше приложение Django обрабатывает запросы и генерирует ответы. В этом разделе мы рассмотрим, как Django принимает HTTP-запросы от браузера пользователя и возвращает HTTP-ответы с соответствующим контентом.

### Вью-функции: Мозг приложения

Вью-функция — это Python-функция, которая принимает HTTP-запрос в качестве аргумента и возвращает HTTP-ответ. Она отвечает за обработку запроса, взаимодействие с моделью для получения или изменения данных, а затем формирование ответа, который будет отправлен обратно пользователю. 

Простейшая вью-функция может выглядеть следующим образом:

```python
from django.http import HttpResponse

def hello_world(request):
  """Вью-функция, возвращающая "Hello, world!" """
  return HttpResponse("Hello, world!")
```

Эта функция просто возвращает объект `HttpResponse` с текстом "Hello, world!". 

### Маршрутизация: Связь URL-адресов с вью-функциями

Чтобы Django мог определить, какую вью-функцию вызывать при получении запроса, необходимо настроить маршруты. Маршруты — это сопоставления между URL-адресами и соответствующими им вью-функциями. 

Создание маршрутов осуществляется в файле `urls.py` вашего приложения. Откройте файл `urls.py` вашего приложения и добавьте следующий код:

```python
from django.urls import path
from . import views

urlpatterns = [
    path('hello/', views.hello_world, name='hello_world'),
]
```

В этом примере мы создаем маршрут, который связывает URL-адрес `/hello/` с вью-функцией `hello_world`. Аргумент `name` присваивает маршруту имя, которое можно использовать для создания URL-адресов в шаблонах и коде Python.

### Объект запроса (`HttpRequest`)

Каждый раз, когда Django получает HTTP-запрос, он создает объект `HttpRequest`, содержащий информацию о запросе. Этот объект передается в качестве первого аргумента вашей вью-функции.

`HttpRequest` содержит множество полезных атрибутов, например:

* **method**: HTTP-метод запроса (GET, POST, PUT, DELETE и т. д.).
* **path**: Путь запрошенного URL-адреса.
* **GET**: Словарь, содержащий параметры GET-запроса.
* **POST**: Словарь, содержащий параметры POST-запроса.
* **COOKIES**: Словарь, содержащий куки запроса.
* **FILES**: Словарь, содержащий загруженные файлы.

### Объект ответа (`HttpResponse`)

Вью-функция должна вернуть объект `HttpResponse` (или его подкласс), содержащий сгенерированный ответ для браузера. 

`HttpResponse` принимает следующие аргументы:

* **content**: Содержимое ответа (строка, байты или объект, который можно преобразовать в строку).
* **content_type**: MIME-тип содержимого ответа (например, 'text/html', 'application/json').
* **status_code**: HTTP-код состояния ответа (например, 200 OK, 404 Not Found).

Пример создания объекта `HttpResponse`:

```python
from django.http import HttpResponse

def my_view(request):
  # ... логика обработки запроса ...

  return HttpResponse("<h1>Это мой ответ</h1>", content_type="text/html")
```

### Подклассы `HttpResponse`

Django предоставляет несколько подклассов `HttpResponse`, которые упрощают возврат распространенных типов ответов:

| Подкласс                | Описание                                                                         |
|-------------------------|-----------------------------------------------------------------------------------|
| `HttpResponseRedirect`  | Перенаправляет пользователя на другой URL-адрес.                                  |
| `HttpResponseNotFound`   | Возвращает страницу с ошибкой "404 Not Found".                                 |
| `HttpResponseBadRequest` | Возвращает страницу с ошибкой "400 Bad Request".                                |
| `JsonResponse`          | Возвращает ответ в формате JSON.                                                |
| `TemplateResponse`      | Используется для рендеринга шаблона Django и возврата HTML-страницы.           |


### Пример: Обработка формы

Рассмотрим пример обработки данных формы, отправленной методом POST:

```python
from django.shortcuts import render
from django.http import HttpResponseRedirect

def contact_form(request):
  """Обрабатывает отправку контактной формы"""
  if request.method == 'POST':
    name = request.POST.get('name')
    email = request.POST.get('email')
    message = request.POST.get('message')

    # ... логика обработки данных формы (например, отправка email) ...

    return HttpResponseRedirect('/thanks/')
  else:
    return render(request, 'contact.html')
```

В этом примере:

1. Мы проверяем, был ли запрос отправлен методом POST.
2. Если да, то извлекаем данные формы из объекта `request.POST`.
3. Выполняем обработку данных (например, отправляем email).
4. Перенаправляем пользователя на страницу благодарности.
5. Если запрос был отправлен не методом POST, то отображаем страницу с контактной формой.

Это лишь базовые примеры обработки запросов и возврата ответов в Django. Django предоставляет множество инструментов и возможностей для создания сложных веб-приложений.
