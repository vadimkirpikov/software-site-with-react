## Настройка переводов и локалей в Django

Интернационализация и локализация — важные аспекты веб-разработки, позволяющие адаптировать ваше приложение Django для пользователей из разных стран и культур. 

**Интернационализация** (i18n) — это процесс разработки, подготавливающий приложение к поддержке разных языков и региональных особенностей. 

**Локализация** (l10n) — это адаптация приложения для конкретного региона или языка, включая перевод текста, форматирование дат, времени, чисел и валют.

Django предоставляет мощную встроенную систему интернационализации и локализации. Давайте рассмотрим, как настроить ваше приложение для работы с переводами и локализациями.

### 1. Активация локализации

Для начала, убедитесь, что локализация включена в настройках Django. Откройте файл `settings.py` вашего проекта и проверьте следующие параметры:

```python
USE_I18N = True
USE_L10N = True
USE_TZ = True 

LANGUAGE_CODE = 'ru-RU'  # Язык по умолчанию

TIME_ZONE = 'Europe/Moscow' # Временная зона по умолчанию
```

* `USE_I18N = True`:  включает систему интернационализации Django.
* `USE_L10N = True`: активирует  форматирование дат, времени и чисел в соответствии с локалью пользователя.
* `USE_TZ = True`: включает поддержку часовых поясов. 
* `LANGUAGE_CODE`:  указывает язык по умолчанию для вашего приложения.
* `TIME_ZONE`: задает временную зону по умолчанию.

### 2. Установка языковых пакетов

Django использует файлы перевода gettext (.po). Вам необходимо установить соответствующие языковые пакеты для языка, который вы хотите поддерживать. Для русского языка выполните следующую команду:

```bash
python -m django-admin makemessages -l ru
```

Эта команда создаст файл `django.po` в директории `locale/ru/LC_MESSAGES/` вашего приложения.

### 3. Перевод текста

Откройте файл `django.po` и найдите строки, помеченные как `msgstr ""`. Замените пустые кавычки переводом соответствующего текста. Например:

```po
msgid "Welcome to my site."
msgstr "Добро пожаловать на мой сайт."
```

### 4. Компиляция переводов

После завершения перевода, скомпилируйте файлы `.po` в бинарные файлы `.mo`, которые Django будет использовать для отображения переведенного текста:

```bash
python -m django-admin compilemessages
```

### 5. Использование переводов в шаблонах

Django предоставляет несколько тегов шаблонов для работы с переводами:

* **`{% trans %}`**:  переводит статический текст внутри тега.

    ```html
    {% load i18n %}
    <p>{% trans "Hello, world!" %}</p> 
    ```

* **`{% blocktrans %}`**:  переводит блоки текста с переменными.

    ```html
    {% load i18n %}
    {% blocktrans with name=user.username %}
        Hello, {{ name }}!
    {% endblocktrans %}
    ```

* **`{{ value|date }}`**:  форматирует дату в соответствии с локалью пользователя.

    ```html
    <p>Дата регистрации: {{ user.date_joined|date }}</p>
    ```

### 6. Определение языка пользователя

Django может автоматически определять язык пользователя на основе настроек браузера. Вы также можете предоставить пользователям возможность выбирать язык вручную, используя языковой переключатель. 

Для создания простого переключателя языков:

1. Создайте представление, которое будет устанавливать куки с выбранным языком.
2. Добавьте ссылки на это представление с различными языковыми кодами в ваш шаблон.

**Пример представления:**

```python
from django.shortcuts import redirect
from django.utils.translation import activate

def set_language(request, language):
    activate(language)
    response = redirect(request.META.get('HTTP_REFERER', '/'))
    response.set_cookie(settings.LANGUAGE_COOKIE_NAME, language)
    return response
```

### Заключение

Система интернационализации и локализации Django предоставляет все необходимые инструменты для создания многоязычных приложений. Следуя описанным выше шагам, вы можете легко переводить текст, форматировать даты, время и числа, а также предоставлять пользователям возможность выбирать предпочтительный язык.
