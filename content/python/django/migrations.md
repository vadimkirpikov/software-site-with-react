## Миграции: Создание и применение (makemigrations, migrate)

Django предоставляет мощный механизм миграций, который позволяет отслеживать изменения в моделях и применять эти изменения к базе данных. Это избавляет от необходимости вручную писать SQL-запросы для обновления структуры базы данных при каждом изменении модели.

### Создание миграций

Для начала работы с миграциями необходимо убедиться, что приложение, в котором определены модели, добавлено в `INSTALLED_APPS` в файле настроек проекта `settings.py`. 

Предположим, у нас есть простое приложение `blog` со следующей моделью:

```python
# blog/models.py

from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    pub_date = models.DateTimeField(auto_now_add=True)
```

Для создания миграции, отражающей текущее состояние модели, выполните команду:

```bash
python manage.py makemigrations blog
```

Эта команда проанализирует изменения в модели `Post` и создаст новый файл миграции в папке `blog/migrations/`.  Имя файла будет содержать временную метку и краткое описание изменений.

Файл миграции - это обычный Python-файл, содержащий инструкции для Django о том, как применить и отменить изменения в базе данных. 

### Применение миграций

После создания файла миграции его необходимо применить к базе данных. Для этого используйте команду:

```bash
python manage.py migrate
```

Django выполнит все не примененные миграции, включая только что созданную. После успешного выполнения команды структура базы данных будет соответствовать модели `Post`.

### Изменение модели и создание новой миграции

Допустим, мы решили добавить новое поле `author` к модели `Post`:

```python
# blog/models.py

from django.db import models
from django.contrib.auth.models import User

class Post(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    pub_date = models.DateTimeField(auto_now_add=True)
    author = models.ForeignKey(User, on_delete=models.CASCADE)
```

После изменения модели снова выполните команду `makemigrations`:

```bash
python manage.py makemigrations blog
```

Django обнаружит изменение в модели `Post` и создаст новую миграцию. 

**Важно:** При каждом изменении моделей необходимо создавать новую миграцию. 

### Применение новой миграции

Для применения новой миграции и обновления структуры базы данных выполните команду `migrate`:

```bash
python manage.py migrate
```

Django применит только новую миграцию, так как предыдущие уже были применены ранее.

### Просмотр списка миграций

Для просмотра списка всех миграций в проекте выполните команду:

```bash
python manage.py showmigrations
```

В выводе команды вы увидите список всех приложений в проекте и список миграций для каждого приложения. 

### Отмена миграций

Django позволяет откатить миграции, если это необходимо. 

Для отката последней примененной миграции выполните команду:

```bash
python manage.py migrate blog <название_миграции>
```

`<название_миграции>` - это имя файла миграции без расширения `.py`. 

**Внимание:** Откат миграций может привести к потере данных. Перед откатом миграций рекомендуется создать резервную копию базы данных.

### Заключение

Миграции - это мощный инструмент Django, который упрощает управление структурой базы данных.  С помощью миграций вы можете легко изменять модели и синхронизировать эти изменения с базой данных без необходимости писать SQL-запросы вручную. 
