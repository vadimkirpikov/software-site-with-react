## Отправка электронной почты

В веб-приложениях часто возникает необходимость отправки электронной почты пользователям. Например, для подтверждения регистрации, отправки уведомлений или сброса пароля. В Flask есть несколько способов реализации отправки email, и в этой статье мы рассмотрим один из самых популярных и удобных - использование библиотеки Flask-Mail.

### Flask-Mail: установка и настройка

Flask-Mail – это расширение Flask, которое значительно упрощает отправку электронных писем из приложения. Flask-Mail основан на библиотеке Python `smtplib` и позволяет легко интегрировать отправку email в ваше приложение Flask.

**1. Установка Flask-Mail:**

```bash
pip install Flask-Mail
```

**2. Настройка Flask-Mail:**

Прежде чем вы сможете отправлять электронные письма, вам необходимо настроить Flask-Mail, указав данные для подключения к SMTP-серверу. 

Добавьте следующий код в ваш файл приложения Flask, заменив примеры ваших данных на реальные:

```python
from flask import Flask
from flask_mail import Mail, Message

app = Flask(__name__)

app.config['MAIL_SERVER'] = 'smtp.example.com'  # Адрес SMTP-сервера
app.config['MAIL_PORT'] = 465  # Порт SMTP-сервера
app.config['MAIL_USE_TLS'] = False  # Использовать ли TLS
app.config['MAIL_USE_SSL'] = True  # Использовать ли SSL
app.config['MAIL_USERNAME'] = 'your_username'  # Имя пользователя
app.config['MAIL_PASSWORD'] = 'your_password'  # Пароль

mail = Mail(app)
```

В этом коде:

*  `MAIL_SERVER` и `MAIL_PORT` указывают адрес и порт вашего SMTP-сервера.
*  `MAIL_USE_TLS` и `MAIL_USE_SSL`  определяют, следует ли использовать TLS или SSL для шифрования соединения. Обратите внимание, что не следует использовать TLS и SSL одновременно.
*  `MAIL_USERNAME` и `MAIL_PASSWORD` - это ваши учетные данные для аутентификации на SMTP-сервере. 

**Важно:** Никогда не храните пароли в открытом виде непосредственно в коде. Используйте переменные окружения или специальные менеджеры секретов для безопасного хранения конфиденциальных данных. 

### Отправка простого текстового письма

Теперь, когда Flask-Mail настроен, вы можете начать отправлять электронные письма. 

```python
@app.route('/send_email')
def send_email():
    msg = Message('Тема письма', sender='отправитель@example.com', recipients=['получатель@example.com'])
    msg.body = 'Текст письма'
    mail.send(msg)
    return 'Письмо отправлено!'
```

В этом примере:

*  Создается объект `Message` с темой письма, адресом отправителя и списком получателей.
*  `msg.body` содержит текст письма.
*  `mail.send(msg)` отправляет письмо.

### Отправка HTML письма

Flask-Mail также позволяет отправлять HTML письма, что дает больше возможностей для форматирования и дизайна.

```python
@app.route('/send_html_email')
def send_html_email():
    msg = Message('Тема HTML письма', sender='отправитель@example.com', recipients=['получатель@example.com'])
    msg.html = '<h1>Заголовок письма</h1><p>Текст письма</p>'
    mail.send(msg)
    return 'HTML письмо отправлено!'
```

В этом примере используется атрибут `msg.html` вместо `msg.body` для указания HTML-содержимого письма.

### Отправка письма с вложениями

Чтобы отправить письмо с вложением, используйте метод `add_attachment()` объекта `Message`.

```python
@app.route('/send_email_with_attachment')
def send_email_with_attachment():
    msg = Message('Тема письма с вложением', sender='отправитель@example.com', recipients=['получатель@example.com'])
    msg.body = 'Письмо с вложением'

    with app.open_resource('путь/к/файлу.txt') as fp:
        msg.attach('файл.txt', 'text/plain', fp.read())

    mail.send(msg)
    return 'Письмо с вложением отправлено!'
```

В этом примере:

*  `app.open_resource()` открывает файл для чтения.
*  `msg.attach()` добавляет вложение к письму, указывая имя файла, тип содержимого и сами данные файла.

###  Дополнительные возможности Flask-Mail

Flask-Mail предоставляет множество дополнительных функций, таких как:

*   Отправка писем с использованием разных SMTP-серверов.
*   Использование шаблонов Jinja2 для создания писем.
*   Отправка асинхронных писем.
*   Обработка ошибок отправки.

Более подробную информацию о Flask-Mail вы найдете в официальной документации: [https://pythonhosted.org/Flask-Mail/](https://pythonhosted.org/Flask-Mail/)

**Заключение**

В этом материале мы рассмотрели основы работы с Flask-Mail для отправки электронных писем из приложений Flask. Вы научились настраивать Flask-Mail, отправлять простые текстовые и HTML письма, а также добавлять вложения.  Используя полученные знания и документацию Flask-Mail, вы сможете легко интегрировать функциональность отправки email в ваше веб-приложение. 
