## Подключение к базам данных: SQLAlchemy, SQLite

Веб-приложения часто нуждаются в хранении данных за пределами оперативной памяти. Для этого используются базы данных. Flask, будучи легковесным фреймворком, не привязан к какой-либо конкретной СУБД и предоставляет свободу выбора.

В этой статье мы рассмотрим подключение к базе данных SQLite с помощью библиотеки SQLAlchemy, популярного инструмента для работы с базами данных в Python. SQLite отлично подходит для небольших проектов и прототипирования благодаря своей простоте и отсутствию необходимости в настройке сервера.

### Установка необходимых библиотек

Перед началом работы убедитесь, что у вас установлены необходимые библиотеки. Вы можете установить их с помощью pip:

```bash
pip install Flask SQLAlchemy
```

### Создание приложения и подключение к базе данных

Начнем с создания простого Flask приложения и настройки подключения к базе данных SQLite. 

```python
from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///mydatabase.db' 
# Настройка URI для подключения к базе данных
db = SQLAlchemy(app) 
# Создание экземпляра SQLAlchemy и привязка к приложению

# Определение модели данных позже
# ...

if __name__ == '__main__':
    db.create_all()  # Создание таблиц базы данных
    app.run(debug=True)
```

В этом примере мы:

1.  Импортировали необходимые классы `Flask` и `SQLAlchemy`.
2.  Создали экземпляр Flask приложения.
3.  Настроили URI для подключения к базе данных SQLite. В данном случае база данных будет храниться в файле `mydatabase.db` в корне проекта.
4.  Создали экземпляр SQLAlchemy и передали ему наше приложение.
5.  Вызвали `db.create_all()` перед запуском приложения. Эта команда создаст таблицы в базе данных, основанные на определенных нами моделях. Определение моделей мы рассмотрим далее.

### Определение моделей данных

Модели данных - это классы Python, которые отображаются на таблицы в базе данных. SQLAlchemy использует декларативный подход, при котором мы определяем структуру таблицы, а SQLAlchemy берет на себя заботу о создании и взаимодействии с ней.

```python
class User(db.Model): 
# Наследуемся от db.Model для создания модели SQLAlchemy
    id = db.Column(db.Integer, primary_key=True) # Столбец ID, первичный ключ
    username = db.Column(db.String(80), unique=True, nullable=False) # Столбец имени пользователя
    email = db.Column(db.String(120), unique=True, nullable=False) # Столбец адреса электронной почты

    def __repr__(self):
        return '<User %r>' % self.username 
        # Строковое представление объекта User
```

В этом примере мы определили модель `User`, которая будет представлена таблицей "user" в базе данных. 

*   `id` - это первичный ключ, который автоматически увеличивается.
*   `username` - строка длиной до 80 символов, должна быть уникальной и не может быть пустой.
*   `email` - строка длиной до 120 символов, также должна быть уникальной и не может быть пустой.

### Работа с данными

Теперь, когда мы определили модель данных, мы можем создавать, читать, обновлять и удалять записи в базе данных.

#### Создание записи:

```python
new_user = User(username='johndoe', email='johndoe@example.com')
db.session.add(new_user)
db.session.commit()
```

#### Чтение записей:

```python
all_users = User.query.all()
# Получение всех пользователей

user = User.query.filter_by(username='johndoe').first() 
# Получение пользователя по имени пользователя
```

#### Обновление записи:

```python
user = User.query.filter_by(username='johndoe').first()
user.email = 'newemail@example.com'
db.session.commit()
```

#### Удаление записи:

```python
user = User.query.filter_by(username='johndoe').first()
db.session.delete(user)
db.session.commit()
```

### Заключение

В этой статье мы рассмотрели основы подключения к базе данных SQLite с помощью SQLAlchemy в Flask приложении. Мы научились настраивать подключение, определять модели данных и выполнять базовые операции CRUD (создание, чтение, обновление, удаление).

SQLAlchemy предоставляет гораздо больше возможностей для работы с базами данных, таких как отношения между таблицами, миграции схемы, и многое другое. 

Изучив основы, вы можете двигаться дальше, применяя эти знания в своих проектах.
