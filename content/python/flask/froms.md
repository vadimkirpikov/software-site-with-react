## Работа с формами: получение и обработка данных от пользователя

Формы - неотъемлемая часть большинства веб-приложений. Они предоставляют пользователям удобный способ взаимодействия с приложением, отправляя данные на сервер. В этом разделе мы рассмотрим, как работать с формами в Flask, получая и обрабатывая данные, отправленные пользователем.

### Flask-WTF: упрощение работы с формами

Flask сам по себе не предоставляет специальных инструментов для работы с формами. Однако существует расширение Flask-WTF, которое значительно упрощает этот процесс. Flask-WTF  базируется на популярной библиотеке WTForms и предоставляет интеграцию с Flask, делая работу с формами более удобной и безопасной.

### Установка Flask-WTF

Для начала установим Flask-WTF:

```bash
pip install Flask-WTF
```

### Создание простой формы

Создадим простую форму регистрации, содержащую поля для имени пользователя и адреса электронной почты. 

```python
from flask_wtf import FlaskForm
from wtforms import StringField, SubmitField
from wtforms.validators import DataRequired, Email

class RegistrationForm(FlaskForm):
    username = StringField('Имя пользователя:', validators=[DataRequired()])
    email = StringField('Адрес электронной почты:', validators=[DataRequired(), Email()])
    submit = SubmitField('Зарегистрироваться')
```

Разберем код:

- Мы импортируем необходимые классы из `flask_wtf` и `wtforms`.
- Класс `RegistrationForm` наследуется от `FlaskForm`.
- Каждое поле формы представлено экземпляром класса из `wtforms` (например, `StringField` для текстового поля).
- Аргумент `validators` позволяет задать список валидаторов для поля. В данном случае мы используем валидаторы `DataRequired` (поле обязательно для заполнения) и `Email` (проверка на корректность адреса электронной почты).
- Поле `submit` типа `SubmitField` создаст кнопку отправки формы.

### Отображение формы в шаблоне

Теперь добавим форму в шаблон HTML. Предположим, у нас есть файл шаблона `register.html`:

```html
<!DOCTYPE html>
<html>
<head>
    <title>Регистрация</title>
</head>
<body>
    <h1>Регистрация</h1>
    <form method="POST">
        {{ form.hidden_tag() }}
        <div>
            {{ form.username.label }}
            {{ form.username }}
        </div>
        <div>
            {{ form.email.label }}
            {{ form.email }}
        </div>
        <div>
            {{ form.submit }}
        </div>
    </form>
</body>
</html>
```

Обратите внимание на следующие моменты:

- Мы используем тег `<form>` с атрибутом `method="POST"`. Это важно, так как данные формы должны отправляться на сервер методом POST.
- Строка `{{ form.hidden_tag() }}` генерирует скрытый input-элемент с CSRF-токеном. CSRF-токен используется для защиты от кросс-сайтовой подделки запросов. 
- Мы используем `{{ form.username.label }}` и `{{ form.username }}`, чтобы отобразить label и input-элемент для поля `username`. Аналогично для поля `email`.

### Обработка данных формы на сервере

Осталось обработать данные формы, отправленные пользователем. Дополним наш код Python:

```python
from flask import Flask, render_template, request
from app.forms import RegistrationForm

app = Flask(__name__)
app.config['SECRET_KEY'] = 'your_secret_key'

@app.route('/register', methods=['GET', 'POST'])
def register():
    form = RegistrationForm()
    if form.validate_on_submit():
        username = form.username.data
        email = form.email.data
        # Здесь вы можете сохранить данные пользователя в базе данных, 
        # отправить email или выполнить другие действия.
        return f'Спасибо за регистрацию, {username}!'
    return render_template('register.html', form=form)

if __name__ == '__main__':
    app.run(debug=True)
```

Разберем код:

- Мы импортируем необходимые классы и создаем экземпляр приложения Flask.
- Мы устанавливаем секретный ключ для приложения. Секретный ключ используется для подписи данных, в том числе и CSRF-токена.
- В обработчике маршрута `/register` мы создаем экземпляр формы `RegistrationForm()`.
-  Мы используем метод `form.validate_on_submit()`. Этот метод проверяет, была ли форма отправлена методом POST и прошли ли все валидаторы. 
- Если форма отправлена и валидна, мы получаем данные из полей формы, используя `form.username.data` и `form.email.data`.
- В данном примере мы просто выводим сообщение с именем пользователя, но вы можете сохранить данные в базу данных или выполнить другие действия.
- Если форма не была отправлена или не прошла валидацию, мы просто отображаем шаблон `register.html`, передавая в него экземпляр формы.


### Заключение

В этом разделе мы рассмотрели основы работы с формами в Flask, используя расширение Flask-WTF. Вы научились создавать простые формы, отображать их в шаблонах и обрабатывать отправленные данные на сервере. 

В следующих разделах мы рассмотрим более сложные сценарии работы с формами, такие как: валидация данных, динамические формы, загрузка файлов и т.д.
